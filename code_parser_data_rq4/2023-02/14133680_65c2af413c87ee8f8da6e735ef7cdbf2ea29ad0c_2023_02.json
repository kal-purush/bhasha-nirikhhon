{
    "identifiers": [
        "Collections",
        "Generic",
        "ComponentModel",
        "Diagnostics",
        "IO",
        "Linq",
        "Windows",
        "Forms",
        "Xml",
        "Bloom",
        "Api",
        "Bloom",
        "Book",
        "Bloom",
        "Properties",
        "DesktopAnalytics",
        "L10NSharp",
        "SIL",
        "IO",
        "SIL",
        "Reporting",
        "Application",
        "Windows",
        "Forms",
        "Application",
        "Bloom",
        "Publish",
        "PDF",
        "CurrentBook",
        "GetLayout",
        "Layout",
        "A5Portrait",
        "PublishModel",
        "BookletPortions",
        "BookSelection",
        "selection",
        "CurrentEditableCollectionSelection",
        "currentBookCollectionSelection",
        "BookServer",
        "bookServer",
        "PdfMaker",
        "pdfMaker",
        "BloomWebSocketServer",
        "webSocketServer",
        "_bookSelection",
        "selection",
        "_currentBookCollectionSelection",
        "currentBookCollectionSelection",
        "_bookServer",
        "bookServer",
        "_pdfMaker",
        "pdfMaker",
        "_webSocketServer",
        "webSocketServer",
        "BloomApiHandler",
        "apiHandler",
        "apiHandler",
        "RegisterEndpointHandler",
        "kApiUrlPart",
        "HandleCreateSimplePdf",
        "apiHandler",
        "RegisterEndpointHandler",
        "kApiUrlPart",
        "HandleCreateCoverPdf",
        "apiHandler",
        "RegisterEndpointHandler",
        "kApiUrlPart",
        "HandleCreatePagesPdf",
        "apiHandler",
        "RegisterEndpointHandler",
        "kApiUrlPart",
        "HandlePrintSettingsPath",
        "apiHandler",
        "RegisterEndpointHandler",
        "kApiUrlPart",
        "HandleSavePdf",
        "apiHandler",
        "RegisterBooleanEndpointHandler",
        "kApiUrlPart",
        "AllowPdfBooklet",
        "apiHandler",
        "RegisterBooleanEndpointHandler",
        "kApiUrlPart",
        "CurrentBook",
        "FullBleed",
        "apiHandler",
        "RegisterEndpointHandler",
        "kApiUrlPart",
        "HandlePrintAnalytics",
        "apiHandler",
        "RegisterBooleanEndpointHandler",
        "kApiUrlPart",
        "CurrentBook",
        "FullBleed",
        "CurrentBook",
        "UserPrefs",
        "FullBleed",
        "writeRequest",
        "value",
        "CurrentBook",
        "CurrentBook",
        "UserPrefs",
        "FullBleed",
        "value",
        "apiHandler",
        "RegisterBooleanEndpointHandler",
        "kApiUrlPart",
        "CurrentBook",
        "UserPrefs",
        "CmykPdf",
        "writeRequest",
        "value",
        "CurrentBook",
        "CurrentBook",
        "UserPrefs",
        "CmykPdf",
        "value",
        "apiHandler",
        "RegisterBooleanEndpointHandler",
        "kApiUrlPart",
        "Settings",
        "Default",
        "DontShowPrintNotification",
        "writeRequest",
        "value",
        "Settings",
        "Default",
        "DontShowPrintNotification",
        "value",
        "Settings",
        "Default",
        "Save",
        "ApiRequest",
        "request",
        "SavePdf",
        "request",
        "PostSucceeded",
        "IsNullOrEmpty",
        "_lastDirectory",
        "Directory",
        "Exists",
        "_lastDirectory",
        "SIL",
        "UsbDrive",
        "UsbDriveInfo",
        "GetDrives",
        "drives",
        "drives",
        "Count",
        "_lastDirectory",
        "drives",
        "RootDirectory",
        "FullName",
        "err",
        "SIL",
        "Reporting",
        "Logger",
        "WriteError",
        "err",
        "BookletPortion",
        "PublishModel",
        "BookletPortions",
        "Debug",
        "Fail",
        "PublishModel",
        "BookletPortions",
        "AllPagesNoBooklet",
        "portion",
        "PublishModel",
        "BookletPortions",
        "BookletCover",
        "portion",
        "PublishModel",
        "BookletPortions",
        "BookletPages",
        "portion",
        "ArgumentOutOfRangeException",
        "CurrentBook",
        "UserPrefs",
        "CmykPdf",
        "CurrentBook",
        "UserPrefs",
        "FullBleed",
        "Format",
        "Path",
        "GetFileName",
        "CurrentBook",
        "FolderPath",
        "CurrentBook",
        "GetFilesafeLanguage1Name",
        "portion",
        "forPrintShop",
        "L10NSharp",
        "LocalizationManager",
        "GetString",
        "pdfFileLabel",
        "pdfFileLabel",
        "Replace",
        "Format",
        "pdfFileLabel",
        "IsNullOrEmpty",
        "_lastDirectory",
        "Directory",
        "Exists",
        "_lastDirectory",
        "_lastDirectory",
        "Environment",
        "GetFolderPath",
        "Environment",
        "SpecialFolder",
        "MyDocuments",
        "Path",
        "Combine",
        "startingFolder",
        "suggestedName",
        "Utils",
        "MiscUtils",
        "GetOutputFilePathOutsideCollectionFolder",
        "initialPath",
        "pdfFilter",
        "IsNullOrEmpty",
        "destFileName",
        "_lastDirectory",
        "Path",
        "GetDirectoryName",
        "destFileName",
        "CurrentBook",
        "UserPrefs",
        "CmykPdf",
        "PublishModel",
        "ProcessPdfFurtherAndSave",
        "PdfFilePath",
        "ProcessPdfWithGhostscript",
        "OutputType",
        "Printshop",
        "destFileName",
        "RobustFile",
        "Copy",
        "PdfFilePath",
        "destFileName",
        "Analytics",
        "Track",
        "Enum",
        "GetName",
        "PublishModel",
        "BookletPortions",
        "BookletPortion",
        "PageLayout",
        "ToString",
        "CurrentBook",
        "ID",
        "CurrentBook",
        "CollectionSettings",
        "Country",
        "CurrentBook",
        "ReportSimplisticFontAnalytics",
        "FontAnalytics",
        "FontEventType",
        "PublishPdf",
        "err",
        "SIL",
        "Reporting",
        "ErrorReport",
        "NotifyUserOfProblem",
        "err",
        "err",
        "Message",
        "ApiRequest",
        "request",
        "FileLocationUtilities",
        "GetDirectoryDistributedWithApplication",
        "Path",
        "Combine",
        "printSettingsPreviewFolder",
        "PageLayout",
        "SizeAndOrientation",
        "isBooklet",
        "printSettingsSampleName",
        "RobustFile",
        "Exists",
        "printSettingsSampleName",
        "printSettingsSampleName",
        "printSettingsSamplePrefix",
        "LocalizationManager",
        "UILanguageId",
        "RobustFile",
        "Exists",
        "printSettingsSampleName",
        "printSettingsSampleName",
        "printSettingsSamplePrefix",
        "Settings",
        "Default",
        "DontShowPrintNotification",
        "RobustFile",
        "Exists",
        "printSettingsSampleName",
        "printSettingsSampleName",
        "printSettingsSampleName",
        "printSettingsSampleName",
        "ToLocalhost",
        "request",
        "ReplyWithText",
        "printSettingsSampleName",
        "ApiRequest",
        "request",
        "Analytics",
        "Track",
        "CurrentBook",
        "ID",
        "CurrentBook",
        "CollectionSettings",
        "Country",
        "CurrentBook",
        "ReportSimplisticFontAnalytics",
        "FontAnalytics",
        "FontEventType",
        "PublishPdf",
        "request",
        "PostSucceeded",
        "BookletPortion",
        "PublishModel",
        "BookletPortions",
        "BookletCover",
        "BookletPortion",
        "PublishModel",
        "BookletPortions",
        "BookletPages",
        "ApiRequest",
        "request",
        "BookletPortion",
        "PublishModel",
        "BookletPortions",
        "BookletPages",
        "MakePdf",
        "request",
        "PostSucceeded",
        "ApiRequest",
        "request",
        "BookletPortion",
        "PublishModel",
        "BookletPortions",
        "BookletCover",
        "MakePdf",
        "request",
        "PostSucceeded",
        "ApiRequest",
        "request",
        "BookletPortion",
        "PublishModel",
        "BookletPortions",
        "AllPagesNoBooklet",
        "MakePdf",
        "request",
        "PostSucceeded",
        "Book",
        "Book",
        "_bookSelection",
        "CurrentSelection",
        "PageLayout",
        "SizeAndOrientation",
        "PageSizeName",
        "CurrentBook",
        "BookInfo",
        "BookletMakingIsAppropriate",
        "size",
        "size",
        "size",
        "size",
        "size",
        "Application",
        "OpenForms",
        "Cast",
        "Form",
        "FirstOrDefault",
        "f",
        "Shell",
        "BackgroundWorker",
        "worker",
        "WorkerReportsProgress",
        "worker",
        "WorkerSupportsCancellation",
        "worker",
        "DoWork",
        "ComponentModel",
        "DoWorkEventHandler",
        "sender",
        "doWorkEventArgs",
        "doWorkEventArgs",
        "Result",
        "BookletPortion",
        "MakeFinalHtmlForPdfMaker",
        "PublishModel",
        "BookletLayoutMethod",
        "GetBookletLayoutMethod",
        "Bloom",
        "Utils",
        "MemoryManagement",
        "CheckMemory",
        "_pdfMaker",
        "MakePdf",
        "PdfMakingSpecs",
        "InputHtmlPath",
        "tempHtml",
        "Key",
        "OutputPdfPath",
        "PdfFilePath",
        "PaperSizeName",
        "PageLayout",
        "SizeAndOrientation",
        "PageSizeName",
        "Landscape",
        "PageLayout",
        "SizeAndOrientation",
        "IsLandScape",
        "SaveMemoryMode",
        "CurrentBook",
        "UserPrefs",
        "ReducePdfMemoryUse",
        "LayoutPagesForRightToLeft",
        "LayoutPagesForRightToLeft",
        "BooketLayoutMethod",
        "layoutMethod",
        "BookletPortion",
        "BookletPortion",
        "BookIsFullBleed",
        "CurrentBook",
        "FullBleed",
        "PrintWithFullBleed",
        "GetPrintingWithFullBleed",
        "Cmyk",
        "CurrentBook",
        "UserPrefs",
        "CmykPdf",
        "worker",
        "doWorkEventArgs",
        "shell",
        "DynamicJson",
        "messageBundle",
        "path",
        "PdfFilePath",
        "ToLocalhost",
        "_webSocketServer",
        "SendBundle",
        "messageBundle",
        "Bloom",
        "Utils",
        "MemoryManagement",
        "CheckMemory",
        "e",
        "doWorkEventArgs",
        "Result",
        "e",
        "worker",
        "RunWorkerAsync",
        "PdfFilePath",
        "GetPdfPath",
        "Path",
        "GetFileName",
        "CurrentBook",
        "FolderPath",
        "CurrentBook",
        "GetDomForPrinting",
        "BookletPortion",
        "_currentBookCollectionSelection",
        "CurrentSelection",
        "_bookServer",
        "orientationChanging",
        "PageLayout",
        "AddStylesheetClasses",
        "dom",
        "RawDom",
        "HtmlDom",
        "AddClassToBody",
        "dom",
        "RawDom",
        "PageLayout",
        "UpdatePageSplitMode",
        "dom",
        "RawDom",
        "CurrentBook",
        "FullBleed",
        "GetPrintingWithFullBleed",
        "ClipBookToRemoveFullBleed",
        "dom",
        "XmlHtmlConverter",
        "MakeXmlishTagsSafeForInterpretationAsHtml",
        "dom",
        "RawDom",
        "dom",
        "UseOriginalImages",
        "BloomServer",
        "MakeSimulatedPageFileInBookFolder",
        "dom",
        "source",
        "BloomServer",
        "SimulatedPageFileSource",
        "Pub",
        "fname",
        "BookStorage",
        "SanitizeNameForFileSystem",
        "fname",
        "i",
        "i",
        "path",
        "Path",
        "Combine",
        "Path",
        "GetTempPath",
        "Format",
        "fileName",
        "i",
        "path",
        "_lastPath",
        "File",
        "Exists",
        "path",
        "RobustFile",
        "Delete",
        "path",
        "RobustFile",
        "Exists",
        "path",
        "RobustFile",
        "Delete",
        "path",
        "_lastPath",
        "path",
        "path",
        "XmlDocument",
        "dom",
        "GetPrintingWithFullBleed",
        "HtmlDom",
        "AddClassToBody",
        "dom",
        "HtmlDom",
        "AddClassToBody",
        "dom",
        "HtmlDom",
        "AddPublishClassToBody",
        "dom",
        "LayoutPagesForRightToLeft",
        "HtmlDom",
        "AddRightToLeftClassToBody",
        "dom",
        "HtmlDom",
        "AddHidePlaceHoldersClassToBody",
        "dom",
        "CurrentBook",
        "GetDefaultBookletLayoutMethod",
        "PublishModel",
        "BookletLayoutMethod",
        "Calendar",
        "HtmlDom",
        "AddCalendarFoldClassToBody",
        "dom",
        "CurrentBook",
        "BookData",
        "Language1",
        "IsRightToLeft",
        "CurrentBook",
        "FullBleed",
        "GetBookletLayoutMethod",
        "PublishModel",
        "BookletLayoutMethod",
        "NoBooklet",
        "CurrentBook",
        "UserPrefs",
        "FullBleed",
        "PublishModel",
        "BookletLayoutMethod",
        "PublishModel",
        "BookletLayoutMethod",
        "BookletPortion",
        "PublishModel",
        "BookletPortions",
        "AllPagesNoBooklet",
        "layoutMethod",
        "PublishModel",
        "BookletLayoutMethod",
        "NoBooklet",
        "layoutMethod",
        "CurrentBook",
        "GetBookletLayoutMethod",
        "PageLayout",
        "layoutMethod",
        "HtmlDom",
        "dom",
        "page",
        "dom",
        "SafeSelectNodes",
        "Cast",
        "XmlElement",
        "page",
        "SetAttribute"
    ],
    "literals": [
        "\"publish/pdf/\"",
        "\"simple\"",
        "\"cover\"",
        "\"pages\"",
        "\"printSettingsPath\"",
        "\"save\"",
        "\"allowBooklet\"",
        "\"allowFullBleed\"",
        "\"printAnalytics\"",
        "\"fullBleed\"",
        "\"cmyk\"",
        "\"dontShowSamplePrint\"",
        "\"Bloom encountered an error while getting list of USB drives.\"",
        "\"\"",
        "\"Save should not be enabled\"",
        "\"Pages\"",
        "\"Cover\"",
        "\"Inside\"",
        "\"-printshop\"",
        "\"\"",
        "\"en\"",
        "\"PDF File\"",
        "\"|\"",
        "\"\"",
        "\"{0}|*.pdf\"",
        "\"Save PDF\"",
        "\"Portion\"",
        "\"Layout\"",
        "\"BookId\"",
        "\"Country\"",
        "\"Save PDF\"",
        "\"Bloom was not able to save the PDF.  {0}\"",
        "\"printer settings images\"",
        "\"-\"",
        "\"Booklet-\"",
        "\"\"",
        "\".png\"",
        "\"en\"",
        "\".png\"",
        "\"\"",
        "\"Print PDF\"",
        "\"BookId\"",
        "\"Country\"",
        "\"Print PDF\"",
        "\"A4\"",
        "\"A3\"",
        "\"B5\"",
        "\"Letter\"",
        "\"Device16x9\"",
        "\"about to create PDF file\"",
        "\"publish\"",
        "\"pdfReady\"",
        "\"finished creating PDF file\"",
        "\"pdfPublishMode\"",
        "\"{0}-{1}.pdf\"",
        "\"publishingWithFullBleed\"",
        "\"publishingWithoutFullBleed\"",
        "\"//div[contains(@class, 'bloom-page')]\"",
        "\"style\"",
        "\"margin-left: -3mm; margin-top: -3mm;\""
    ],
    "variables": [
        "BookSelection",
        "_bookSelection",
        "CurrentEditableCollectionSelection",
        "_currentBookCollectionSelection",
        "BookServer",
        "_bookServer",
        "PdfMaker",
        "_pdfMaker",
        "BloomWebSocketServer",
        "_webSocketServer",
        "PdfFilePath",
        "Layout",
        "PageLayout",
        "BookletPortion",
        "kApiUrlPart",
        "_lastDirectory",
        "drives",
        "portion",
        "forPrintShop",
        "suggestedName",
        "pdfFileLabel",
        "pdfFilter",
        "startingFolder",
        "initialPath",
        "destFileName",
        "printSettingsPreviewFolder",
        "printSettingsSamplePrefix",
        "printSettingsSampleName",
        "CurrentBook",
        "AllowPdfBooklet",
        "size",
        "shell",
        "worker",
        "tempHtml",
        "layoutMethod",
        "dynamic",
        "messageBundle",
        "orientationChanging",
        "dom",
        "_lastPath",
        "path",
        "fileName",
        "i",
        "LayoutPagesForRightToLeft",
        "layoutMethod"
    ],
    "comments": [
        "This is to support orientation/page size changing during publishing, but we're not doing",
        "that yet, so just defer to the current book.",
        "Adapted from PublishModel.Save()",
        "Give a slight preference to USB keys, though if they used a different directory last time, we favor that.",
        "If an error occurs while trying to get the USB drive info,",
        "it's not a big deal and doesn't need to terminate the save operation.",
        "Let's just log it and fall through to the rest of the Save() function",
        "PDF for Printshop (CMYK US Web Coated V2)",
        "we want the simple PDF we already made.",
        "Gets the url of the image we should show (if any) to help the user configure",
        "the printer to correctly print a booklet.",
        "</summary>",
        "Is it reasonable to make a booklet out of the current book with the current settings?",
        "Roughly duplicates a method of PublishModel, though that includes a concept of",
        "AllowPdf which returns CanPublish which is derived from DeterminePublishability.",
        "(But that has to do with whether the book can be published at all, not whether",
        "it can be published as a booklet.)",
        "</summary>",
        "Large page sizes can't make booklets.  See http://issues.bloomlibrary.org/youtrack/issue/BL-4155.",
        "Adapted from PublishModel.DeterminePublishability. Not sure if we will need it here.",
        "private bool BookIsPublishable",
        "{",
        "get",
        "{",
        "// At this point (5.1), this should only be false iff:",
        "// - User is not in Enterprise mode AND",
        "// - Book contains overlay elements AND",
        "// - Book is not a translated shell",
        "var overlayElementNodes =",
        "CurrentBook?.RawDom.SelectNodes(\"//div[contains(@class, 'bloom-textOverPicture')]\");",
        "var bookContainsOverlayElements = (overlayElementNodes?.Count ?? 0) > 0;",
        "var bookIsTranslatedFromShell = CurrentBook?.BookData?.BookIsDerivative() ?? false;",
        "return (CurrentBook?.CollectionSettings?.HaveEnterpriseFeatures ?? false) ||",
        "!bookContainsOverlayElements || bookIsTranslatedFromShell;",
        "}",
        "}",
        "Make the actual PDF file with current settings. Slightly adapted from PublishModel.LoadBook.",
        "cf PublishView._makePdfBackgroundWorker_DoWork",
        "if (doWorkEventArgs.Cancel)",
        "return;",
        "Check memory for the benefit of developers.  The user won't see anything.",
        "Todo: what should clean up this file when??",
        "Warn the user if we're starting to use too much memory.",
        "we can't safely do any ui-related work from this thread, like putting up a dialog",
        "SIL.Reporting.ErrorReport.NotifyUserOfProblem(e, \"There was a problem creating a PDF from this book.\");",
        "SetDisplayMode(DisplayModes.WaitForUserToChooseSomething);",
        "return;",
        "Slightly adapted from the same method in PublishModel.",
        "var orientationChanging = CurrentBook.GetLayout().SizeAndOrientation.IsLandScape !=",
        "PageLayout.SizeAndOrientation.IsLandScape;",
        "don't want low-res images or transparency in PDF.",
        "Copied from PublishModel",
        "Sanitize fileName first",
        "don't use the same path twice in a row; react-pdf won't realize it's a new file",
        "and won't update, and other render effects don't happen because it hasn't changed.",
        "But it's pretty surely one of ours, so try to clean it up.",
        "(It doesn't matter if we use the same name in two different runs of Bloom. This is mainly",
        "about switching between cover and inside pages or simple.)",
        "couldn't delete it? then increment the suffix and try again",
        "example: A5 book is full bleed. What the user saw and configured in Edit mode is RA5 paper, 3mm larger on each side.",
        "But we're not printing for full bleed. We will create an A5 page with no inset trim box.",
        "We want it to hold the trim box part of the RA5 page.",
        "to do this, we simply need to move the bloom-page element up and left by 3mm. Clipping to the page will do the rest.",
        "It would be more elegant to do this by introducing a CSS rule involving .bloom-page, but to introduce a new stylesheet",
        "we have to make it findable in the book folder, which is messy. Or, we could add a stylesheet element to the DOM;",
        "but that's messy, too, we need stuff like /*<![CDATA[*/ to make the content survive the trip from XML to HTML.",
        "So it's easiest just to stick it in the style attribute of each page."
    ],
    "docstrings": [
        "<summary>",
        "<summary>"
    ],
    "functions": [
        "PublishPdfApi",
        "RegisterWithApiHandler",
        "HandleSavePdf",
        "SavePdf",
        "HandlePrintSettingsPath",
        "HandlePrintAnalytics",
        "isBooklet",
        "HandleCreatePagesPdf",
        "HandleCreateCoverPdf",
        "HandleCreateSimplePdf",
        "MakePdf",
        "SimulatedPageFile",
        "MakeFinalHtmlForPdfMaker",
        "GetPdfPath",
        "AddStylesheetClasses",
        "GetPrintingWithFullBleed",
        "GetBookletLayoutMethod",
        "ClipBookToRemoveFullBleed"
    ],
    "classes": [
        "PublishPdfApi"
    ]
}