{
    "identifiers": [
        "MySQLdb",
        "argparse",
        "sys",
        "datetime",
        "datetime",
        "bantype",
        "job",
        "bantype",
        "job",
        "job_name_fixes",
        "job_name_fixes",
        "job",
        "job",
        "keep_job_names",
        "job",
        "job",
        "job",
        "title",
        "role",
        "bantype",
        "bantype",
        "bantype",
        "expiration_time",
        "bantype",
        "expiration_time",
        "expiration_time",
        "expiration_time",
        "field",
        "field",
        "field",
        "field",
        "field",
        "field",
        "field",
        "sys",
        "version_info",
        "argparse",
        "ArgumentParser",
        "parser",
        "add_argument",
        "help",
        "parser",
        "add_argument",
        "help",
        "parser",
        "add_argument",
        "help",
        "parser",
        "add_argument",
        "help",
        "parser",
        "add_argument",
        "help",
        "parser",
        "add_argument",
        "help",
        "parser",
        "parse_args",
        "MySQLdb",
        "connect",
        "host",
        "args",
        "address",
        "user",
        "args",
        "username",
        "passwd",
        "args",
        "password",
        "db",
        "args",
        "database",
        "db",
        "cursor",
        "args",
        "curtable",
        "args",
        "newtable",
        "cursor",
        "execute",
        "current_table",
        "cursor",
        "fetchall",
        "datetime",
        "now",
        "format",
        "start_time",
        "strftime",
        "current_id",
        "id_list",
        "current_id",
        "datetime",
        "now",
        "format",
        "current_id",
        "cur_time",
        "start_time",
        "cursor",
        "execute",
        "current_table",
        "current_id",
        "cursor",
        "fetchone",
        "query_row",
        "query_row",
        "query_row",
        "query_row",
        "query_row",
        "query_row",
        "parse_admin",
        "query_row",
        "query_row",
        "parse_role",
        "query_row",
        "query_row",
        "parse_datetime",
        "query_row",
        "query_row",
        "parse_for_empty",
        "query_row",
        "parse_for_empty",
        "query_row",
        "parse_for_empty",
        "query_row",
        "parse_not_null",
        "query_row",
        "parse_not_null",
        "query_row",
        "parse_not_null",
        "query_row",
        "query_row",
        "query_row",
        "parse_for_empty",
        "query_row",
        "parse_datetime",
        "query_row",
        "parse_for_empty",
        "query_row",
        "parse_for_empty",
        "query_row",
        "parse_for_empty",
        "query_row",
        "cursor",
        "execute",
        "new_table",
        "bantime",
        "server_ip",
        "server_port",
        "round_id",
        "role",
        "expiration_time",
        "applies_to_admins",
        "reason",
        "ckey",
        "ip",
        "computerid",
        "a_ckey",
        "a_ip",
        "a_computerid",
        "who",
        "adminwho",
        "edits",
        "unbanned_datetime",
        "unbanned_ckey",
        "unbanned_ip",
        "unbanned_computerid",
        "db",
        "commit",
        "datetime",
        "now",
        "format",
        "datetime",
        "now",
        "strftime",
        "format",
        "end_time",
        "start_time",
        "e",
        "datetime",
        "now",
        "format",
        "current_id",
        "datetime",
        "now",
        "strftime",
        "format",
        "end_time",
        "start_time",
        "cursor",
        "execute",
        "format",
        "new_table",
        "e",
        "cursor",
        "close"
    ],
    "literals": [
        "\"PERMABAN\"",
        "\"TEMPBAN\"",
        "\"ADMIN_PERMABAN\"",
        "\"ADMIN_TEMPBAN\"",
        "\"Server\"",
        "\"A\"",
        "\"AI\"",
        "\"Captai\"",
        "\"Captain\"",
        "\"Cargo Technicia\"",
        "\"Cargo Technician\"",
        "\"Chaplai\"",
        "\"Chaplain\"",
        "\"Che\"",
        "\"Chef\"",
        "\"Chemis\"",
        "\"Chemist\"",
        "\"Chief Enginee\"",
        "\"Chief Engineer\"",
        "\"Chief Medical Office\"",
        "\"Chief Medical Officer\"",
        "\"Cybor\"",
        "\"Cyborg\"",
        "\"Detectiv\"",
        "\"Detective\"",
        "\"Head of Personne\"",
        "\"Head of Personnel\"",
        "\"Head of Securit\"",
        "\"Head of Security\"",
        "\"Mim\"",
        "\"Mime\"",
        "\"pA\"",
        "\"pAI\"",
        "\"Quartermaste\"",
        "\"Quartermaster\"",
        "\"Research Directo\"",
        "\"Research Director\"",
        "\"Scientis\"",
        "\"Scientist\"",
        "\"Security Office\"",
        "\"Security Officer\"",
        "\"Station Enginee\"",
        "\"Station Engineer\"",
        "\"Syndicat\"",
        "\"Syndicate\"",
        "\"Warde\"",
        "\"Warden\"",
        "\"AI\"",
        "\"Head of Personnel\"",
        "\"Head of Security\"",
        "\"OOC\"",
        "\"pAI\"",
        "\"servant of Ratvar\"",
        "\"Servant of Ratvar\"",
        "\"ADMIN_PERMABAN\"",
        "\"ADMIN_TEMPBAN\"",
        "\"PERMABAN\"",
        "\"JOB_PERMABAN\"",
        "\"ADMIN_PERMABAN\"",
        "\"0000-00-00 00:00:00\"",
        "\"BLANK CKEY ERROR\"",
        "\"Python must be at least version 3 for this script.\"",
        "\"address\"",
        "\"MySQL server address (use localhost for the current computer)\"",
        "\"username\"",
        "\"MySQL login username\"",
        "\"password\"",
        "\"MySQL login username\"",
        "\"database\"",
        "\"Database name\"",
        "\"curtable\"",
        "\"Name of the current ban table (remember prefixes if you use them)\"",
        "\"newtable\"",
        "\"Name of the new table to insert to, can't be same as the source table (remember prefixes)\"",
        "\"SELECT id FROM \"",
        "\" ORDER BY bantime ASC\"",
        "\"Beginning conversion at {0}\"",
        "\"%Y-%m-%d %H:%M:%S\"",
        "\"Reached row ID {0} Duration: {1}\"",
        "\"SELECT * FROM \"",
        "\" WHERE id = %s\"",
        "\"INSERT INTO \"",
        "\" (bantime, server_ip, server_port, round_id, role, expiration_time, applies_to_admins, reason, ckey, ip, computerid, a_ckey, a_ip, a_computerid, who, adminwho, edits, unbanned_datetime, unbanned_ckey, unbanned_ip, unbanned_computerid) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)\"",
        "\"Conversion completed at {0}\"",
        "\"%Y-%m-%d %H:%M:%S\"",
        "\"Script duration: {0}\"",
        "\"Error encountered on row ID {0} at {1}\"",
        "\"%Y-%m-%d %H:%M:%S\"",
        "\"Script duration: {0}\"",
        "\"TRUNCATE {0} \""
    ],
    "variables": [
        "role",
        "job_name_fixes",
        "keep_job_names",
        "role",
        "role",
        "role",
        "role",
        "expiration_time",
        "expiration_time",
        "expiration_time",
        "field",
        "field",
        "field",
        "current_round",
        "parser",
        "args",
        "db",
        "cursor",
        "current_table",
        "new_table",
        "id_list",
        "start_time",
        "cur_time",
        "query_row",
        "bantime",
        "server_ip",
        "server_port",
        "round_id",
        "applies_to_admins",
        "reason",
        "role",
        "expiration_time",
        "ckey",
        "computerid",
        "ip",
        "a_ckey",
        "a_computerid",
        "a_ip",
        "who",
        "adminwho",
        "edits",
        "unbanned_datetime",
        "unbanned_ckey",
        "unbanned_computerid",
        "unbanned_ip",
        "end_time",
        "end_time"
    ],
    "comments": [
        "Python 3+ Script for converting ban table format as of 2018-10-28 made by Jordie0608",
        "",
        "Before starting ensure you have installed the mysqlclient package https://github.com/PyMySQL/mysqlclient-python",
        "It can be downloaded from command line with pip:",
        "pip install mysqlclient",
        "",
        "You will also have to create a new ban table for inserting converted data to per the schema:",
        "CREATE TABLE `ban` (",
        "`id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,",
        "`bantime` DATETIME NOT NULL,",
        "`server_ip` INT(10) UNSIGNED NOT NULL,",
        "`server_port` SMALLINT(5) UNSIGNED NOT NULL,",
        "`round_id` INT(11) UNSIGNED NOT NULL,",
        "`role` VARCHAR(32) NULL DEFAULT NULL,",
        "`expiration_time` DATETIME NULL DEFAULT NULL,",
        "`applies_to_admins` TINYINT(1) UNSIGNED NOT NULL DEFAULT '0',",
        "`reason` VARCHAR(2048) NOT NULL,",
        "`ckey` VARCHAR(32) NULL DEFAULT NULL,",
        "`ip` INT(10) UNSIGNED NULL DEFAULT NULL,",
        "`computerid` VARCHAR(32) NULL DEFAULT NULL,",
        "`a_ckey` VARCHAR(32) NOT NULL,",
        "`a_ip` INT(10) UNSIGNED NOT NULL,",
        "`a_computerid` VARCHAR(32) NOT NULL,",
        "`who` VARCHAR(2048) NOT NULL,",
        "`adminwho` VARCHAR(2048) NOT NULL,",
        "`edits` TEXT NULL DEFAULT NULL,",
        "`unbanned_datetime` DATETIME NULL DEFAULT NULL,",
        "`unbanned_ckey` VARCHAR(32) NULL DEFAULT NULL,",
        "`unbanned_ip` INT(10) UNSIGNED NULL DEFAULT NULL,",
        "`unbanned_computerid` VARCHAR(32) NULL DEFAULT NULL,",
        "`unbanned_round_id` INT(11) UNSIGNED NULL DEFAULT NULL,",
        "PRIMARY KEY (`id`),",
        "KEY `idx_ban_isbanned` (`ckey`,`role`,`unbanned_datetime`,`expiration_time`),",
        "KEY `idx_ban_isbanned_details` (`ckey`,`ip`,`computerid`,`role`,`unbanned_datetime`,`expiration_time`),",
        "KEY `idx_ban_count` (`bantime`,`a_ckey`,`applies_to_admins`,`unbanned_datetime`,`expiration_time`)",
        ") ENGINE=InnoDB DEFAULT CHARSET=latin1;",
        "This is to prevent the destruction of existing data and allow rollbacks to be performed in the event of an error during conversion",
        "Once conversion is complete remember to rename the old and new ban tables; it's up to you if you want to keep the old table",
        "",
        "To view the parameters for this script, execute it with the argument --help",
        "All the positional arguments are required, remember to include prefixes in your table names if you use them",
        "An example of the command used to execute this script from powershell:",
        "python ban_conversion_2018-10-28.py \"localhost\" \"root\" \"password\" \"feedback\" \"SS13_ban\" \"SS13_ban_new\"",
        "I found that this script would complete conversion of 35000 rows in approximately 20 seconds, results will depend on the size of your ban table and computer used",
        "",
        "The script has been tested to complete with tgstation's ban table as of 2018-09-02 02:19:56",
        "In the event of an error the new ban table is automatically truncated",
        "The source table is never modified so you don't have to worry about losing any data due to errors",
        "Some additional error correction is performed to fix problems specific to legacy and invalid data in tgstation's ban table, these operations are tagged with a 'TG:' comment",
        "Even if you don't have any of these specific problems in your ban table the operations won't have matter as they have an insignificant effect on runtime",
        "",
        "While this script is safe to run with your game server(s) active, any bans created after the script has started won't be converted",
        "You will also have to ensure that the code and table names are updated between rounds as neither will be compatible",
        "TG: Some legacy jobbans are missing the last character from their job string.",
        "Some job names we want to keep the same as .title() would return a different string.",
        "And then there's this asshole.",
        "TG: two bans with an invalid expiration_time due to admins setting the duration to approx. 19 billion years, I'm going to count them as permabans.",
        "TG: Several bans from 2012, probably from clients disconnecting while a ban was being made.",
        "TG: Due to deleted rows and a legacy ban import being inserted from id 3140 id order is not contiguous or in line with date order. While technically valid, it's confusing and I don't like that.",
        "TG: So instead of just running through to MAX(id) we're going to reorder the records by bantime as we go.",
        "TG: bans with an empty reason which were somehow created with almost every field being null or empty, we can't do much but skip this"
    ],
    "docstrings": [],
    "functions": [
        "parse_role",
        "parse_admin",
        "parse_datetime",
        "parse_not_null",
        "parse_for_empty"
    ],
    "classes": []
}