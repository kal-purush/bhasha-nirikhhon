{
    "identifiers": [
        "logging",
        "json",
        "db",
        "models",
        "api",
        "aws",
        "handlers",
        "sts",
        "SessionHelper",
        "aws",
        "handlers",
        "s3",
        "S3",
        "aws",
        "handlers",
        "kms",
        "KMS",
        "aws",
        "handlers",
        "iam",
        "IAM",
        "utils",
        "alarm_service",
        "AlarmService",
        "logging",
        "getLogger",
        "session",
        "dataset",
        "models",
        "Dataset",
        "share",
        "models",
        "ShareObject",
        "target_folder",
        "models",
        "DatasetStorageLocation",
        "source_environment",
        "models",
        "Environment",
        "target_environment",
        "models",
        "Environment",
        "source_env_group",
        "models",
        "EnvironmentGroup",
        "env_group",
        "models",
        "EnvironmentGroup",
        "session",
        "source_env_group",
        "env_group",
        "dataset",
        "share",
        "target_folder",
        "source_environment",
        "target_environment",
        "api",
        "ShareObject",
        "find_share_item_by_folder",
        "session",
        "share",
        "target_folder",
        "share_item",
        "S3AccessPointName",
        "dataset",
        "AwsAccountId",
        "target_environment",
        "AwsAccountId",
        "source_env_group",
        "environmentIAMRoleArn",
        "env_group",
        "environmentIAMRoleName",
        "target_folder",
        "S3BucketName",
        "dataset",
        "IAMDatasetAdminRoleArn",
        "dataset",
        "AwsAccountId",
        "dataset",
        "region",
        "target_folder",
        "S3Prefix",
        "json",
        "loads",
        "S3",
        "get_bucket_policy",
        "source_account_id",
        "bucket_name",
        "statement",
        "bucket_policy",
        "statement",
        "get",
        "item",
        "item",
        "SessionHelper",
        "get_role_ids",
        "source_account_id",
        "dataset_admin",
        "source_env_admin",
        "SessionHelper",
        "get_delegation_role_arn",
        "source_account_id",
        "bucket_name",
        "bucket_name",
        "exceptions_roleId",
        "bucket_name",
        "bucket_name",
        "source_account_id",
        "bucket_policy",
        "append",
        "allow_owner_access",
        "bucket_policy",
        "append",
        "delegated_to_accesspoint",
        "S3",
        "create_bucket_policy",
        "source_account_id",
        "bucket_name",
        "json",
        "dumps",
        "bucket_policy",
        "IAM",
        "get_role_policy",
        "target_account_id",
        "target_env_admin",
        "existing_policy",
        "bucket_name",
        "join",
        "existing_policy",
        "bucket_name",
        "bucket_name",
        "dataset_region",
        "dataset_account_id",
        "access_point_name",
        "dataset_region",
        "dataset_account_id",
        "access_point_name",
        "existing_policy",
        "extend",
        "target_resources",
        "bucket_name",
        "bucket_name",
        "dataset_region",
        "dataset_account_id",
        "access_point_name",
        "dataset_region",
        "dataset_account_id",
        "access_point_name",
        "IAM",
        "update_role_policy",
        "target_account_id",
        "target_env_admin",
        "json",
        "dumps",
        "policy",
        "S3",
        "get_bucket_access_point_arn",
        "source_account_id",
        "access_point_name",
        "access_point_arn",
        "S3",
        "create_bucket_access_point",
        "source_account_id",
        "bucket_name",
        "access_point_name",
        "S3",
        "get_access_point_policy",
        "source_account_id",
        "access_point_name",
        "SessionHelper",
        "get_role_id",
        "target_account_id",
        "target_env_admin",
        "existing_policy",
        "json",
        "loads",
        "existing_policy",
        "item",
        "item",
        "item",
        "existing_policy",
        "target_env_admin_id",
        "statements",
        "keys",
        "statements",
        "target_env_admin_id",
        "isinstance",
        "prefix_list",
        "prefix_list",
        "s3_prefix",
        "prefix_list",
        "prefix_list",
        "append",
        "s3_prefix",
        "statements",
        "target_env_admin_id",
        "prefix_list",
        "statements",
        "target_env_admin_id",
        "isinstance",
        "resource_list",
        "resource_list",
        "access_point_arn",
        "s3_prefix",
        "resource_list",
        "resource_list",
        "append",
        "access_point_arn",
        "s3_prefix",
        "statements",
        "target_env_admin_id",
        "resource_list",
        "statements",
        "values",
        "S3",
        "generate_access_point_policy_template",
        "target_env_admin_id",
        "access_point_arn",
        "s3_prefix",
        "existing_policy",
        "extend",
        "additional_policy",
        "existing_policy",
        "S3",
        "generate_access_point_policy_template",
        "target_env_admin_id",
        "access_point_arn",
        "s3_prefix",
        "item",
        "item",
        "SessionHelper",
        "get_role_ids",
        "source_account_id",
        "dataset_admin",
        "source_env_admin",
        "SessionHelper",
        "get_delegation_role_arn",
        "source_account_id",
        "access_point_arn",
        "exceptions_roleId",
        "access_point_policy",
        "append",
        "admin_statement",
        "S3",
        "attach_access_point_policy",
        "source_account_id",
        "access_point_name",
        "json",
        "dumps",
        "access_point_policy",
        "dataset",
        "KmsAlias",
        "KMS",
        "get_key_id",
        "source_account_id",
        "key_alias",
        "KMS",
        "get_key_policy",
        "source_account_id",
        "kms_keyId",
        "SessionHelper",
        "get_role_id",
        "target_account_id",
        "target_env_admin",
        "existing_policy",
        "target_env_admin_id",
        "existing_policy",
        "json",
        "loads",
        "existing_policy",
        "policy",
        "append",
        "target_env_admin_id",
        "target_env_admin_id",
        "KMS",
        "put_key_policy",
        "source_account_id",
        "kms_keyId",
        "json",
        "dumps",
        "policy",
        "json",
        "loads",
        "S3",
        "get_access_point_policy",
        "source_account_id",
        "access_point_name",
        "S3",
        "get_bucket_access_point_arn",
        "source_account_id",
        "access_point_name",
        "SessionHelper",
        "get_role_id",
        "target_account_id",
        "target_env_admin",
        "item",
        "item",
        "item",
        "access_point_policy",
        "target_env_admin_id",
        "statements",
        "keys",
        "statements",
        "target_env_admin_id",
        "isinstance",
        "prefix_list",
        "s3_prefix",
        "prefix_list",
        "prefix_list",
        "remove",
        "s3_prefix",
        "statements",
        "target_env_admin_id",
        "remove",
        "access_point_arn",
        "s3_prefix",
        "statements",
        "values",
        "access_point_policy",
        "remove",
        "statements",
        "target_env_admin_id",
        "access_point_policy",
        "remove",
        "statements",
        "target_env_admin_id",
        "S3",
        "attach_access_point_policy",
        "source_account_id",
        "access_point_name",
        "json",
        "dumps",
        "access_point_policy",
        "json",
        "loads",
        "S3",
        "get_access_point_policy",
        "source_account_id",
        "access_point_name",
        "len",
        "access_point_policy",
        "S3",
        "delete_bucket_access_point",
        "source_account_id",
        "access_point_name",
        "IAM",
        "get_role_policy",
        "target_account_id",
        "target_env_admin",
        "existing_policy",
        "bucket_name",
        "join",
        "existing_policy",
        "bucket_name",
        "bucket_name",
        "dataset_region",
        "dataset_account_id",
        "access_point_name",
        "dataset_region",
        "dataset_account_id",
        "access_point_name",
        "item",
        "target_resources",
        "existing_policy",
        "remove",
        "item",
        "existing_policy",
        "IAM",
        "delete_role_policy",
        "target_account_id",
        "target_env_admin",
        "IAM",
        "update_role_policy",
        "target_account_id",
        "target_env_admin",
        "json",
        "dumps",
        "existing_policy",
        "dataset",
        "KmsAlias",
        "KMS",
        "get_key_id",
        "source_account_id",
        "key_alias",
        "KMS",
        "get_key_policy",
        "source_account_id",
        "kms_keyId",
        "SessionHelper",
        "get_role_id",
        "target_account_id",
        "target_env_admin",
        "existing_policy",
        "target_env_admin_id",
        "existing_policy",
        "json",
        "loads",
        "existing_policy",
        "item",
        "item",
        "policy",
        "item",
        "target_env_admin_id",
        "KMS",
        "put_key_policy",
        "source_account_id",
        "kms_keyId",
        "json",
        "dumps",
        "policy",
        "error",
        "logging",
        "error",
        "s3_prefix",
        "source_environment",
        "AwsAccountId",
        "source_environment",
        "region",
        "target_environment",
        "AwsAccountId",
        "target_environment",
        "region",
        "error",
        "api",
        "ShareObject",
        "update_share_item_status",
        "session",
        "share_item",
        "models",
        "ShareObjectStatus",
        "Share_Failed",
        "value",
        "AlarmService",
        "trigger_folder_sharing_failure_alarm",
        "target_folder",
        "share",
        "target_environment",
        "error",
        "logging",
        "error",
        "s3_prefix",
        "source_environment",
        "AwsAccountId",
        "source_environment",
        "region",
        "target_environment",
        "AwsAccountId",
        "target_environment",
        "region",
        "error",
        "api",
        "ShareObject",
        "update_share_item_status",
        "session",
        "share_item",
        "models",
        "ShareObjectStatus",
        "Revoke_Share_Failed",
        "value",
        "AlarmService",
        "trigger_revoke_folder_sharing_failure_alarm",
        "target_folder",
        "share",
        "target_environment"
    ],
    "literals": [
        "\"Statement\"",
        "\"Sid\"",
        "\"AllowAllToAdmin\"",
        "\"DelegateAccessToAccessPoint\"",
        "f'{item}:*'",
        "\"Sid\"",
        "\"AllowAllToAdmin\"",
        "\"Effect\"",
        "\"Allow\"",
        "\"Principal\"",
        "\"*\"",
        "\"Action\"",
        "\"s3:*\"",
        "\"Resource\"",
        "f\"arn:aws:s3:::{self.bucket_name}\"",
        "f\"arn:aws:s3:::{self.bucket_name}/*\"",
        "\"Condition\"",
        "\"StringLike\"",
        "\"aws:userId\"",
        "\"Sid\"",
        "\"DelegateAccessToAccessPoint\"",
        "\"Effect\"",
        "\"Allow\"",
        "\"Principal\"",
        "\"*\"",
        "\"Action\"",
        "\"s3:*\"",
        "\"Resource\"",
        "f\"arn:aws:s3:::{self.bucket_name}\"",
        "f\"arn:aws:s3:::{self.bucket_name}/*\"",
        "\"Condition\"",
        "\"StringEquals\"",
        "\"s3:DataAccessPointAccount\"",
        "f\"{self.source_account_id}\"",
        "\"Statement\"",
        "\"Statement\"",
        "\"targetDatasetAccessControlPolicy\"",
        "\",\"",
        "\"Statement\"",
        "\"Resource\"",
        "f\"arn:aws:s3:::{self.bucket_name}\"",
        "f\"arn:aws:s3:::{self.bucket_name}/*\"",
        "f\"arn:aws:s3:{self.dataset_region}:{self.dataset_account_id}:accesspoint/{self.access_point_name}\"",
        "f\"arn:aws:s3:{self.dataset_region}:{self.dataset_account_id}:accesspoint/{self.access_point_name}/*\"",
        "\"Statement\"",
        "\"Resource\"",
        "\"Version\"",
        "\"2012-10-17\"",
        "\"Statement\"",
        "\"Effect\"",
        "\"Allow\"",
        "\"Action\"",
        "\"s3:*\"",
        "\"Resource\"",
        "f\"arn:aws:s3:::{self.bucket_name}\"",
        "f\"arn:aws:s3:::{self.bucket_name}/*\"",
        "f\"arn:aws:s3:{self.dataset_region}:{self.dataset_account_id}:accesspoint/{self.access_point_name}\"",
        "f\"arn:aws:s3:{self.dataset_region}:{self.dataset_account_id}:accesspoint/{self.access_point_name}/*\"",
        "\"targetDatasetAccessControlPolicy\"",
        "\"Sid\"",
        "\"Statement\"",
        "f\"{target_env_admin_id}0\"",
        "f\"{target_env_admin_id}0\"",
        "\"Condition\"",
        "\"StringLike\"",
        "\"s3:prefix\"",
        "f\"{self.s3_prefix}/*\"",
        "f\"{self.s3_prefix}/*\"",
        "f\"{target_env_admin_id}0\"",
        "\"Condition\"",
        "\"StringLike\"",
        "\"s3:prefix\"",
        "f\"{target_env_admin_id}1\"",
        "\"Resource\"",
        "f\"{access_point_arn}/object/{self.s3_prefix}/*\"",
        "f\"{access_point_arn}/object/{self.s3_prefix}/*\"",
        "f\"{target_env_admin_id}1\"",
        "\"Resource\"",
        "\"Statement\"",
        "\"Statement\"",
        "\"Statement\"",
        "f'{item}:*'",
        "\"Sid\"",
        "\"AllowAllToAdmin\"",
        "\"Effect\"",
        "\"Allow\"",
        "\"Principal\"",
        "\"*\"",
        "\"Action\"",
        "\"s3:*\"",
        "\"Resource\"",
        "f\"{access_point_arn}\"",
        "\"Condition\"",
        "\"StringLike\"",
        "\"aws:userId\"",
        "\"Statement\"",
        "f\"alias/{self.dataset.KmsAlias}\"",
        "\"default\"",
        "f'{target_env_admin_id}:*'",
        "\"Statement\"",
        "\"Sid\"",
        "f\"{target_env_admin_id}\"",
        "\"Effect\"",
        "\"Allow\"",
        "\"Principal\"",
        "\"AWS\"",
        "\"*\"",
        "\"Action\"",
        "\"kms:Decrypt\"",
        "\"Resource\"",
        "\"*\"",
        "\"Condition\"",
        "\"StringLike\"",
        "\"aws:userId\"",
        "f\"{target_env_admin_id}:*\"",
        "\"default\"",
        "\"Sid\"",
        "\"Statement\"",
        "f\"{target_env_admin_id}0\"",
        "f\"{target_env_admin_id}0\"",
        "\"Condition\"",
        "\"StringLike\"",
        "\"s3:prefix\"",
        "f\"{self.s3_prefix}/*\"",
        "f\"{self.s3_prefix}/*\"",
        "f\"{target_env_admin_id}1\"",
        "\"Resource\"",
        "f\"{access_point_arn}/object/{self.s3_prefix}/*\"",
        "\"Statement\"",
        "\"Statement\"",
        "f\"{target_env_admin_id}0\"",
        "\"Statement\"",
        "f\"{target_env_admin_id}1\"",
        "\"Statement\"",
        "\"targetDatasetAccessControlPolicy\"",
        "\",\"",
        "\"Statement\"",
        "\"Resource\"",
        "f\"arn:aws:s3:::{self.bucket_name}\"",
        "f\"arn:aws:s3:::{self.bucket_name}/*\"",
        "f\"arn:aws:s3:{self.dataset_region}:{self.dataset_account_id}:accesspoint/{self.access_point_name}\"",
        "f\"arn:aws:s3:{self.dataset_region}:{self.dataset_account_id}:accesspoint/{self.access_point_name}/*\"",
        "\"Statement\"",
        "\"Resource\"",
        "\"Statement\"",
        "\"Resource\"",
        "\"targetDatasetAccessControlPolicy\"",
        "\"targetDatasetAccessControlPolicy\"",
        "f\"alias/{self.dataset.KmsAlias}\"",
        "\"default\"",
        "f'{target_env_admin_id}:*'",
        "\"Statement\"",
        "\"Statement\"",
        "\"Sid\"",
        "f\"{target_env_admin_id}\"",
        "\"default\"",
        "f'Failed to share folder {self.s3_prefix} '",
        "f'from source account {self.source_environment.AwsAccountId}//{self.source_environment.region} '",
        "f'with target account {self.target_environment.AwsAccountId}/{self.target_environment.region}'",
        "f'due to: {error}'",
        "f'Failed to revoke S3 permissions to folder {self.s3_prefix} '",
        "f'from source account {self.source_environment.AwsAccountId}//{self.source_environment.region} '",
        "f'with target account {self.target_environment.AwsAccountId}/{self.target_environment.region}'",
        "f'due to: {error}'"
    ],
    "variables": [
        "log",
        "session",
        "source_env_group",
        "env_group",
        "dataset",
        "share",
        "target_folder",
        "source_environment",
        "target_environment",
        "share_item",
        "access_point_name",
        "source_account_id",
        "target_account_id",
        "source_env_admin",
        "target_env_admin",
        "bucket_name",
        "dataset_admin",
        "dataset_account_id",
        "dataset_region",
        "s3_prefix",
        "bucket_policy",
        "exceptions_roleId",
        "allow_owner_access",
        "delegated_to_accesspoint",
        "existing_policy",
        "target_resources",
        "policy",
        "policy",
        "access_point_arn",
        "access_point_arn",
        "existing_policy",
        "target_env_admin_id",
        "existing_policy",
        "statements",
        "prefix_list",
        "prefix_list",
        "resource_list",
        "resource_list",
        "existing_policy",
        "additional_policy",
        "access_point_policy",
        "access_point_policy",
        "exceptions_roleId",
        "admin_statement",
        "key_alias",
        "kms_keyId",
        "existing_policy",
        "target_env_admin_id",
        "policy",
        "access_point_policy",
        "access_point_arn",
        "target_env_admin_id",
        "statements",
        "prefix_list",
        "access_point_policy",
        "access_point_policy",
        "existing_policy",
        "target_resources",
        "key_alias",
        "kms_keyId",
        "existing_policy",
        "target_env_admin_id",
        "policy",
        "policy"
    ],
    "comments": [
        "type dict",
        "requester will use this role to access resources",
        "Update existing access point policy",
        "First time to create access point policy",
        "At least we have the 'AllowAllToAdmin' statement"
    ],
    "docstrings": [
        "\"\"\"\n        This function will manage bucket policy by grant admin access to dataset admin, pivot role\n        and environment admin. All of the policies will only be added once.\n        :return:\n        \"\"\"",
        "\"\"\"\n        Updates requester IAM role policy to include requested S3 bucket and access point\n        :return:\n        \"\"\"",
        "\"\"\"\n        :return:\n        \"\"\"",
        "\"\"\"\n        Handles share failure by raising an alarm to alarmsTopic\n        Returns\n        -------\n        True if alarm published successfully\n        \"\"\"",
        "\"\"\"\n        Handles share failure by raising an alarm to alarmsTopic\n        Returns\n        -------\n        True if alarm published successfully\n        \"\"\""
    ],
    "functions": [
        "manage_bucket_policy",
        "grant_target_role_access_policy",
        "manage_access_point_and_policy",
        "update_dataset_bucket_key_policy",
        "delete_access_point_policy",
        "delete_access_point",
        "delete_target_role_access_policy",
        "delete_dataset_bucket_key_policy",
        "handle_share_failure",
        "handle_revoke_failure"
    ],
    "classes": [
        "S3ShareManager"
    ]
}