{
    "identifiers": [
        "os",
        "csv",
        "json",
        "scraperwiki",
        "ckanapi",
        "urllib",
        "requests",
        "sys",
        "hashlib",
        "sys",
        "argv",
        "sys",
        "argv",
        "ckanapi",
        "RemoteCKAN",
        "apikey",
        "API_KEY",
        "p",
        "p",
        "resources",
        "filename",
        "resource_id",
        "apikey",
        "resource_id",
        "apikey",
        "requests",
        "get",
        "url",
        "headers",
        "headers",
        "r",
        "json",
        "doc",
        "requests",
        "get",
        "fileUrl",
        "stream",
        "headers",
        "headers",
        "open",
        "filename",
        "f",
        "chunk",
        "r",
        "iter_content",
        "chunk_size",
        "chunk",
        "f",
        "write",
        "chunk",
        "f",
        "flush",
        "e",
        "e",
        "filename",
        "first_run",
        "resource_id",
        "hashlib",
        "sha1",
        "open",
        "filename",
        "afile",
        "afile",
        "read",
        "hasher",
        "update",
        "buf",
        "hasher",
        "hexdigest",
        "first_run",
        "scraperwiki",
        "sqlite",
        "save_var",
        "new_hash",
        "scraperwiki",
        "sqlite",
        "get_var",
        "scraperwiki",
        "sqlite",
        "save_var",
        "new_hash",
        "old_hash",
        "new_hash",
        "new_data",
        "filename",
        "resource_id",
        "resource",
        "apikey",
        "checkHash",
        "filename",
        "filename",
        "first_run",
        "resource_id",
        "resource_id",
        "update_data",
        "ckan_resource_id",
        "resource",
        "apikey",
        "ckan",
        "action",
        "datastore_delete",
        "resource_id",
        "ckan_resource_id",
        "force",
        "apikey",
        "apikey",
        "ckan",
        "action",
        "datastore_create",
        "apikey",
        "apikey",
        "resource_id",
        "ckan_resource_id",
        "force",
        "fields",
        "resource",
        "primary_key",
        "resource",
        "get",
        "indexes",
        "resource",
        "csv",
        "DictReader",
        "open",
        "resource",
        "row",
        "row",
        "reader",
        "resource",
        "offset",
        "len",
        "rows",
        "rows",
        "offset",
        "offset",
        "chunksize",
        "ckan",
        "action",
        "datastore_upsert",
        "resource_id",
        "ckan_resource_id",
        "force",
        "method",
        "records",
        "rowset",
        "offset",
        "chunksize",
        "offset",
        "len",
        "rows",
        "complete",
        "upload_data_to_datastore",
        "resource_id",
        "resource",
        "apikey",
        "p",
        "getResources",
        "p",
        "i",
        "len",
        "resources",
        "resources",
        "i",
        "resource",
        "resource_id",
        "downloadResource",
        "p",
        "resource_id",
        "API_KEY",
        "updateDatastore",
        "p",
        "resource_id",
        "resource",
        "API_KEY",
        "runEverything",
        "FILE_PATH",
        "scraperwiki",
        "status",
        "e",
        "e",
        "scraperwiki",
        "status",
        "os",
        "system"
    ],
    "literals": [
        "'http://test-data.hdx.rwlabs.org'",
        "'resource_id'",
        "'c68fc09f-198c-4978-9fbe-b79dd5ba4658'",
        "'path'",
        "'schema'",
        "\"fields\"",
        "\"id\"",
        "\"code\"",
        "\"type\"",
        "\"text\"",
        "\"id\"",
        "\"title\"",
        "\"type\"",
        "\"text\"",
        "\"id\"",
        "\"value\"",
        "\"type\"",
        "\"float\"",
        "\"id\"",
        "\"latest_date\"",
        "\"type\"",
        "\"timestamp\"",
        "\"id\"",
        "\"source\"",
        "\"type\"",
        "\"text\"",
        "\"id\"",
        "\"source_link\"",
        "\"type\"",
        "\"text\"",
        "\"id\"",
        "\"notes\"",
        "\"type\"",
        "\"text\"",
        "\"id\"",
        "\"explore\"",
        "\"type\"",
        "\"text\"",
        "\"id\"",
        "\"units\"",
        "\"type\"",
        "\"text\"",
        "'indexes'",
        "\"code\"",
        "\"primary_key\"",
        "\"code\"",
        "'https://data.hdx.rwlabs.org/api/action/resource_show?id='",
        "'Authorization'",
        "\"result\"",
        "\"url\"",
        "'wb'",
        "'There was an error downlaoding the file.'",
        "'rb'",
        "'stag'",
        "'stag'",
        "'stag'",
        "\"DataStore Status: No new data. Not updating datastore.\"",
        "\"DataStore Status: New data. Updating datastore.\"",
        "'schema'",
        "'fields'",
        "'schema'",
        "'primary_key'",
        "'indexes'",
        "'path'",
        "'Uploading data for file: %s'",
        "'path'",
        "'insert'",
        "\"%\"",
        "'Update successful: %s completed'",
        "'-------------------------------------'",
        "'resource_id'",
        "\"Reading resource id: \"",
        "'-------------------------------------'",
        "'Done.'",
        "'-------------------------------------'",
        "\"ScraperWiki Status: Everything seems to be just fine.\"",
        "'ok'",
        "'error'",
        "'Creating datastore failed'",
        "\"mail -s 'SNGO Topline: creating datastore failed.' luiscape@gmail.com\""
    ],
    "variables": [
        "API_KEY",
        "FILE_PATH",
        "ckan",
        "resources",
        "url",
        "headers",
        "r",
        "doc",
        "fileUrl",
        "r",
        "hasher",
        "buf",
        "new_hash",
        "new_data",
        "old_hash",
        "new_data",
        "update_data",
        "reader",
        "rows",
        "chunksize",
        "offset",
        "rowset",
        "complete",
        "resources",
        "resource",
        "resource_id"
    ],
    "comments": [
        "!/usr/bin/python",
        "-*- coding: utf-8 -*-",
        "Dependencies",
        "Collecting configuration variables",
        "configuring the remote CKAN instance",
        "This is where the resources are declared. For now,",
        "they are declared as a Python list.",
        "This is a skeleton of a function that",
        "should fetch those schemas using other",
        "more refined methods.",
        "Function to download a resource from CKAN.",
        "Querying",
        "Downloading",
        "filter out keep-alive new chunks",
        "Function that checks for old SHA hash",
        "and stores as a SW variable the new hash",
        "if they differ. If this function returns true,",
        "then the datastore is created.",
        "checking if the files are identical or if",
        "they have changed",
        "returning a boolean",
        "",
        "Checking if there is new data",
        "Let's delete any existing data before we upload again",
        "Running the upload function",
        "updating the UI timestamp",
        "updateTimestamp(resource_id, apikey)",
        "Wrapper call for all functions",
        "fetch the resources list",
        "iterating through the provided list of resources",
        "getting the right resource",
        "getting the resource_id",
        "Error handler for running the entire script",
        "if everything ok"
    ],
    "docstrings": [],
    "functions": [
        "getResources",
        "downloadResource",
        "checkHash",
        "updateDatastore",
        "upload_data_to_datastore",
        "runEverything"
    ],
    "classes": []
}