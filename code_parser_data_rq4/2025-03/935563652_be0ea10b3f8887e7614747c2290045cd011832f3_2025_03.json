{
    "identifiers": [
        "json",
        "pandas",
        "pd",
        "numpy",
        "np",
        "pathlib",
        "Path",
        "logging",
        "datetime",
        "datetime",
        "timedelta",
        "logging",
        "basicConfig",
        "level",
        "logging",
        "INFO",
        "format",
        "logging",
        "getLogger",
        "market",
        "market",
        "upper",
        "Path",
        "parent",
        "data_dir",
        "market",
        "lower",
        "market_dir",
        "prediction_history_file",
        "exists",
        "logger",
        "error",
        "prediction_history_file",
        "open",
        "prediction_history_file",
        "f",
        "json",
        "load",
        "f",
        "isinstance",
        "history",
        "logger",
        "warning",
        "history",
        "e",
        "logger",
        "error",
        "e",
        "market_dir",
        "historical_cache_file",
        "exists",
        "logger",
        "error",
        "historical_cache_file",
        "open",
        "historical_cache_file",
        "f",
        "json",
        "load",
        "f",
        "chunk_file",
        "index",
        "values",
        "market_dir",
        "chunk_file",
        "chunk_path",
        "exists",
        "open",
        "chunk_path",
        "f",
        "json",
        "load",
        "f",
        "symbol",
        "data",
        "chunk_data",
        "items",
        "pd",
        "DataFrame",
        "data",
        "df",
        "columns",
        "df",
        "set_index",
        "inplace",
        "pd",
        "to_datetime",
        "df",
        "index",
        "df",
        "columns",
        "symbol",
        "df",
        "columns",
        "data",
        "data",
        "df",
        "columns",
        "df",
        "e",
        "logger",
        "error",
        "symbol",
        "e",
        "data_dict",
        "e",
        "logger",
        "error",
        "e",
        "evaluation_date",
        "days_forward",
        "load_prediction_history",
        "prediction_history",
        "logger",
        "error",
        "evaluation_date",
        "datetime",
        "now",
        "strftime",
        "datetime",
        "strptime",
        "evaluation_date",
        "prediction_history",
        "sort",
        "key",
        "x",
        "x",
        "get",
        "reverse",
        "record",
        "prediction_history",
        "datetime",
        "strptime",
        "record",
        "record_date",
        "eval_date",
        "record",
        "prediction_record",
        "logger",
        "error",
        "evaluation_date",
        "prediction_record",
        "logger",
        "info",
        "prediction_date",
        "evaluation_date",
        "logger",
        "info",
        "prediction_date",
        "load_historical_data",
        "historical_data",
        "logger",
        "error",
        "datetime",
        "strptime",
        "prediction_date",
        "datetime",
        "strptime",
        "evaluation_date",
        "logger",
        "info",
        "evaluation_date",
        "symbol",
        "data",
        "historical_data",
        "items",
        "eval_date_obj",
        "data",
        "index",
        "has_evaluation_data",
        "logger",
        "error",
        "evaluation_date",
        "prediction_date",
        "evaluation_date",
        "market",
        "stock",
        "prediction_record",
        "stock",
        "stock",
        "symbol",
        "historical_data",
        "logger",
        "warning",
        "symbol",
        "historical_data",
        "symbol",
        "stock",
        "eval_date_obj",
        "stock_data",
        "index",
        "stock_data",
        "columns",
        "stock_data",
        "loc",
        "eval_date_obj",
        "stock_data",
        "columns",
        "stock_data",
        "loc",
        "eval_date_obj",
        "col",
        "col",
        "stock_data",
        "columns",
        "col",
        "lower",
        "col",
        "lower",
        "price_columns",
        "stock_data",
        "loc",
        "eval_date_obj",
        "price_columns",
        "logger",
        "info",
        "price_columns",
        "symbol",
        "logger",
        "warning",
        "symbol",
        "evaluation_date",
        "e",
        "logger",
        "warning",
        "symbol",
        "evaluation_date",
        "e",
        "has_actual_data",
        "actual_price",
        "symbol",
        "actual_price",
        "current_price",
        "actual_price",
        "current_price",
        "current_price",
        "logger",
        "warning",
        "symbol",
        "evaluation_date_str",
        "predicted_return_percent",
        "predicted_return_percent",
        "actual_return_percent",
        "actual_return_percent",
        "predicted_direction",
        "actual_direction",
        "direction_correct",
        "correct_direction",
        "actual_returns",
        "append",
        "actual_return_percent",
        "predicted_returns",
        "append",
        "predicted_return_percent",
        "total_stocks",
        "symbol",
        "stock",
        "predicted_return_percent",
        "round",
        "actual_return_percent",
        "round",
        "abs",
        "predicted_return_percent",
        "actual_return_percent",
        "direction_correct",
        "prediction_date",
        "evaluation_date",
        "evaluation_results",
        "append",
        "stock_result",
        "total_stocks",
        "np",
        "array",
        "actual_returns",
        "np",
        "array",
        "predicted_returns",
        "np",
        "mean",
        "np",
        "abs",
        "predicted_returns",
        "actual_returns",
        "np",
        "sqrt",
        "np",
        "mean",
        "predicted_returns",
        "actual_returns",
        "correct_direction",
        "total_stocks",
        "round",
        "mae",
        "round",
        "rmse",
        "round",
        "direction_accuracy",
        "total_stocks",
        "evaluation_results",
        "prediction_date",
        "evaluation_date",
        "evaluation_results",
        "sort",
        "key",
        "x",
        "x",
        "reverse",
        "evaluation_results",
        "e",
        "logger",
        "error",
        "e",
        "traceback",
        "traceback",
        "print_exc",
        "PredictionEvaluator",
        "market",
        "datetime",
        "now",
        "strftime",
        "evaluator",
        "evaluate_predictions",
        "evaluation_date",
        "today",
        "results",
        "json",
        "dumps",
        "results",
        "indent",
        "main"
    ],
    "literals": [
        "'%(asctime)s - %(levelname)s - %(message)s'",
        "'UK'",
        "'data'",
        "'prediction_history.json'",
        "f\"Prediction history file not found: {self.prediction_history_file}\"",
        "'r'",
        "f\"Invalid prediction history format. Cannot evaluate.\"",
        "f\"Error loading prediction history: {str(e)}\"",
        "'historical_cache.json'",
        "f\"Historical cache file not found: {historical_cache_file}\"",
        "'r'",
        "'chunks'",
        "'r'",
        "'data'",
        "'Date'",
        "'Date'",
        "'Symbol'",
        "'Symbol'",
        "'CompanyName'",
        "'company_name'",
        "'CompanyName'",
        "'company_name'",
        "'CompanyName'",
        "'CompanyName'",
        "'Unknown'",
        "f\"Error loading data for {symbol}: {str(e)}\"",
        "f\"Error loading historical data: {str(e)}\"",
        "\"No prediction history found.\"",
        "'%Y-%m-%d'",
        "'%Y-%m-%d'",
        "'date'",
        "''",
        "'date'",
        "'%Y-%m-%d'",
        "f\"No prediction found before the evaluation date: {evaluation_date}\"",
        "'date'",
        "f\"Found prediction from {prediction_date} to evaluate against {evaluation_date}\"",
        "f\"Evaluating predictions for date: {prediction_date}\"",
        "\"No historical data found.\"",
        "'%Y-%m-%d'",
        "'%Y-%m-%d'",
        "f\"Looking for actual market data for: {evaluation_date}\"",
        "f\"No market data available for evaluation date: {evaluation_date}\"",
        "'prediction_date'",
        "'evaluation_date'",
        "'market'",
        "'stocks'",
        "'metrics'",
        "'report'",
        "'symbol'",
        "'overview'",
        "'predicted_return_percent'",
        "f\"No historical data found for {symbol}\"",
        "'overview'",
        "'current_price'",
        "'Close'",
        "'Close'",
        "'close'",
        "'close'",
        "'close'",
        "'price'",
        "f\"Using {price_columns[0]} column for {symbol} closing price\"",
        "f\"No exact data found for {symbol} on {evaluation_date}\"",
        "f\"Error getting actual price for {symbol} on {evaluation_date}: {str(e)}\"",
        "f\"DEBUG: {symbol} - actual_price: {actual_price}, current_price: {current_price}\"",
        "f\"No actual market data found for {symbol} on {evaluation_date_str}\"",
        "'symbol'",
        "'company_name'",
        "'company_name'",
        "'predicted_return_percent'",
        "'actual_return_percent'",
        "'prediction_error'",
        "'direction_correct'",
        "'note'",
        "f\"Comparing prediction from {prediction_date} with actual data from {evaluation_date}\"",
        "'stocks'",
        "'metrics'",
        "'mean_absolute_error'",
        "'root_mean_squared_error'",
        "'direction_accuracy_percent'",
        "'total_stocks_evaluated'",
        "'metrics'",
        "'note'",
        "f\"Evaluated using prediction from {prediction_date} against actual data from {evaluation_date}\"",
        "'metrics'",
        "'mean_absolute_error'",
        "'root_mean_squared_error'",
        "'direction_accuracy_percent'",
        "'total_stocks_evaluated'",
        "'error_message'",
        "'No stocks could be evaluated. Market data may not be available for the evaluation date.'",
        "'stocks'",
        "'actual_return_percent'",
        "f\"Error evaluating predictions: {str(e)}\"",
        "'UK'",
        "'%Y-%m-%d'",
        "\"Evaluation failed. Check logs for details.\"",
        "\"Note: Make sure you have a prediction from a previous day and actual market data for today.\"",
        "\"__main__\""
    ],
    "variables": [
        "logger",
        "market",
        "data_dir",
        "market_dir",
        "prediction_history_file",
        "history",
        "historical_cache_file",
        "index",
        "data_dict",
        "chunk_path",
        "chunk_data",
        "df",
        "df",
        "index",
        "df",
        "df",
        "df",
        "data_dict",
        "symbol",
        "prediction_history",
        "evaluation_date",
        "eval_date",
        "prediction_record",
        "record_date",
        "prediction_record",
        "prediction_date",
        "historical_data",
        "pred_date",
        "eval_date_obj",
        "has_evaluation_data",
        "has_evaluation_data",
        "evaluation_results",
        "actual_returns",
        "predicted_returns",
        "correct_direction",
        "total_stocks",
        "symbol",
        "predicted_return_percent",
        "stock_data",
        "current_price",
        "actual_price",
        "actual_return_percent",
        "has_actual_data",
        "actual_price",
        "has_actual_data",
        "actual_price",
        "has_actual_data",
        "price_columns",
        "actual_price",
        "has_actual_data",
        "actual_return_percent",
        "predicted_direction",
        "actual_direction",
        "direction_correct",
        "stock_result",
        "stock_result",
        "actual_returns",
        "predicted_returns",
        "mae",
        "rmse",
        "direction_accuracy",
        "evaluation_results",
        "evaluation_results",
        "evaluator",
        "today",
        "results"
    ],
    "comments": [
        "Setup logging",
        "Ensure the history is a list and has the correct structure",
        "Ensure Symbol column is present",
        "Ensure CompanyName column is present",
        "Load prediction history",
        "If no evaluation date provided, use the current date",
        "Parse evaluation date",
        "Sort prediction history by date (newest first)",
        "Find the most recent prediction before the evaluation date",
        "Find the most recent prediction BEFORE the evaluation date",
        "Load historical data",
        "Parse dates",
        "Check if we have data for the evaluation date in any of the stocks",
        "Prepare results",
        "Track metrics for overall evaluation",
        "Evaluate each stock in the prediction report",
        "Skip if we don't have historical data for this stock",
        "Get stock data",
        "Use the current price from the prediction as our baseline",
        "Try to get the actual price for the evaluation date",
        "Convert evaluation_date to the same format as the index in stock_data",
        "Try to find the exact date",
        "Check if 'Close' is a column or if we need to access it differently",
        "Try lowercase version",
        "Try to find any column that might contain closing price",
        "We won't try to find closest date as we want to evaluate on the exact date",
        "Calculate actual return if we have the data",
        "Calculate the actual return percentage",
        "Calculate actual return based on price difference",
        "Check if prediction direction was correct",
        "Add to tracking arrays for overall metrics",
        "Add stock result to evaluation",
        "Add information about the dates being compared",
        "Calculate overall metrics",
        "Convert to numpy arrays for calculations",
        "Mean Absolute Error",
        "Root Mean Squared Error",
        "Direction Accuracy",
        "Add metrics to results",
        "Add a note about the evaluation method",
        "No stocks could be evaluated",
        "Sort stocks by actual return (best performers first)",
        "Create evaluator",
        "Get today's date",
        "Evaluate the most recent prediction against today's data"
    ],
    "docstrings": [
        "\"\"\"Evaluates the accuracy of stock predictions by comparing with actual market data\"\"\"",
        "\"\"\"Load prediction history from file\"\"\"",
        "\"\"\"Load historical market data from chunks\"\"\"",
        "\"\"\"Evaluate prediction accuracy by comparing with actual market data\n        \n        Args:\n            evaluation_date (str, optional): The date to evaluate in format 'YYYY-MM-DD'.\n                                           If None, uses the current date.\n            days_forward (int, optional): DEPRECATED. This parameter is no longer used as we now\n                                         always compare the previous day's prediction with the current day's data.\n        \n        Returns:\n            dict: Evaluation results or None if evaluation fails\n        \"\"\""
    ],
    "functions": [
        "load_prediction_history",
        "load_historical_data",
        "evaluate_predictions",
        "main"
    ],
    "classes": [
        "PredictionEvaluator"
    ]
}