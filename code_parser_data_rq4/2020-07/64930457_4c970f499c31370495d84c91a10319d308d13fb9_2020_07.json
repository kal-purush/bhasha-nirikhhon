{
    "identifiers": [
        "mock",
        "nova",
        "test",
        "nova",
        "tests",
        "fixtures",
        "nova_fixtures",
        "nova",
        "tests",
        "functional",
        "integrated_helpers",
        "integrated_helpers",
        "_IntegratedTestBase",
        "setUp",
        "useFixture",
        "nova_fixtures",
        "CinderFixture",
        "_start_compute",
        "_start_compute",
        "mock",
        "patch",
        "side_effect",
        "test",
        "TestingException",
        "mock_plm",
        "nova_fixtures",
        "CinderFixture",
        "IMAGE_BACKED_VOL",
        "_build_server",
        "name",
        "image_uuid",
        "networks",
        "volume_id",
        "api",
        "post_server",
        "server",
        "_wait_for_state_change",
        "server",
        "api",
        "get_server",
        "server",
        "server",
        "assertIn",
        "volume_id",
        "cinder",
        "volume_ids_for_instance",
        "server",
        "cinder",
        "volume_to_attachment",
        "get",
        "volume_id",
        "assertEqual",
        "len",
        "attachments",
        "attachments",
        "keys",
        "_live_migrate",
        "server",
        "mock_plm",
        "assert_called_once",
        "api",
        "get_server",
        "server",
        "assertEqual",
        "src_host",
        "server",
        "cinder",
        "volume_to_attachment",
        "get",
        "volume_id",
        "assertNotIn",
        "src_attachment_id",
        "attachments",
        "keys",
        "assertEqual",
        "len",
        "attachments"
    ],
    "literals": [
        "'latest'",
        "'src'",
        "'dest'",
        "'nova.virt.fake.FakeDriver.pre_live_migration'",
        "'test_bfv_pre_live_migration_failure'",
        "''",
        "'none'",
        "'block_device_mapping_v2'",
        "'source_type'",
        "'volume'",
        "'destination_type'",
        "'volume'",
        "'boot_index'",
        "'uuid'",
        "'server'",
        "'ACTIVE'",
        "'id'",
        "'OS-EXT-SRV-ATTR:host'",
        "'id'",
        "'error'",
        "'id'",
        "'OS-EXT-SRV-ATTR:host'"
    ],
    "variables": [
        "ADMIN_API",
        "microversion",
        "cinder",
        "volume_id",
        "server",
        "server",
        "server",
        "server",
        "src_host",
        "attachments",
        "src_attachment_id",
        "server",
        "attachments"
    ],
    "comments": [
        "Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
        "not use this file except in compliance with the License. You may obtain",
        "a copy of the License at",
        "",
        "http://www.apache.org/licenses/LICENSE-2.0",
        "",
        "Unless required by applicable law or agreed to in writing, software",
        "distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
        "WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
        "License for the specific language governing permissions and limitations",
        "under the License.",
        "Default self.api to the self.admin_api as live migration is admin only",
        "Fetch the source host for use later",
        "Assert that the volume is connected to the instance",
        "Assert that we have an active attachment in the fixture",
        "Fetch the attachment_id for use later once we have migrated",
        "Migrate the instance and wait until the migration errors out thanks",
        "to our mocked version of pre_live_migration raising",
        "test.TestingException",
        "Assert that we called the fake pre_live_migration method",
        "Assert that the instance is listed on the source",
        "FIXME(lyarwood): Assert that both the src and dest attachments have",
        "been removed. Only the dest attachment should be removed during the",
        "rollback of a pre_live_migration failure."
    ],
    "docstrings": [
        "\"\"\"Regression test for bug 1889108.\n\n    This regression test asserts that the original source volume attachments\n    are incorrectly removed during the rollback from pre_live_migration\n    failures on the destination.\n    \"\"\"",
        "\"\"\"Assert that the src attachment is incorrectly removed\n\n        * Mock pre_live_migration to always fail within the virt driver\n        * Launch a boot from volume instance\n        * Assert that the volume is attached correctly to the instance.\n        * Live migrate the instance to another host invoking the mocked\n          pre_live_migration\n        * Assert that the instance is still on the source host\n        * Assert that both the original source host volume attachment and\n          new destination volume attachment have been removed\n        \"\"\""
    ],
    "functions": [
        "setUp",
        "_setup_compute_service",
        "test_vol_attachments_during_driver_pre_live_mig_failure"
    ],
    "classes": [
        "TestVolAttachmentsDuringPreLiveMigration"
    ]
}