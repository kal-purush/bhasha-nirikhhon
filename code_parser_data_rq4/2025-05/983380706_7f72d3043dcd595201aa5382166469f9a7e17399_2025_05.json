{
    "identifiers": [
        "fastapi",
        "FastAPI",
        "File",
        "UploadFile",
        "Form",
        "fastapi",
        "responses",
        "JSONResponse",
        "fastapi",
        "middleware",
        "cors",
        "CORSMiddleware",
        "insightface",
        "app",
        "FaceAnalysis",
        "numpy",
        "linalg",
        "norm",
        "numpy",
        "np",
        "PIL",
        "Image",
        "io",
        "BytesIO",
        "torch",
        "uvicorn",
        "threading",
        "pickle",
        "os",
        "asyncio",
        "typing",
        "concurrent",
        "futures",
        "ThreadPoolExecutor",
        "psutil",
        "base64",
        "fastapi",
        "HTTPException",
        "cv2",
        "proc",
        "psutil",
        "process_iter",
        "proc",
        "name",
        "lower",
        "proc",
        "kill",
        "psutil",
        "NoSuchProcess",
        "psutil",
        "AccessDenied",
        "img",
        "threshold",
        "cv2",
        "cvtColor",
        "img",
        "cv2",
        "COLOR_BGR2GRAY",
        "cv2",
        "Laplacian",
        "gray",
        "cv2",
        "CV_64F",
        "lap_var",
        "threshold",
        "image",
        "bbox",
        "margin",
        "v",
        "v",
        "bbox",
        "image",
        "shape",
        "max",
        "x1",
        "margin",
        "max",
        "y1",
        "margin",
        "min",
        "w",
        "x2",
        "margin",
        "min",
        "h",
        "y2",
        "margin",
        "image",
        "y1",
        "y2",
        "x1",
        "x2",
        "threading",
        "Lock",
        "path",
        "os",
        "path",
        "exists",
        "EMBEDDINGS_PATH",
        "open",
        "EMBEDDINGS_PATH",
        "f",
        "pickle",
        "load",
        "f",
        "FastAPI",
        "app",
        "add_middleware",
        "CORSMiddleware",
        "allow_origins",
        "allow_credentials",
        "allow_methods",
        "allow_headers",
        "torch",
        "cuda",
        "is_available",
        "FaceAnalysis",
        "name",
        "face_app",
        "prepare",
        "ctx_id",
        "ctx_id",
        "det_size",
        "ctx_id",
        "face_app",
        "models",
        "session",
        "get_providers",
        "providers",
        "face_app",
        "models",
        "session",
        "get_providers",
        "providers",
        "ThreadPoolExecutor",
        "max_workers",
        "open",
        "EMBEDDINGS_PATH",
        "f",
        "pickle",
        "dump",
        "user_embeddings",
        "f",
        "user_id",
        "content",
        "Image",
        "open",
        "BytesIO",
        "content",
        "convert",
        "np",
        "array",
        "image",
        "face_app",
        "get",
        "img",
        "torch",
        "cuda",
        "memory_allocated",
        "faces",
        "BytesIO",
        "image",
        "save",
        "buffered",
        "format",
        "base64",
        "b64encode",
        "buffered",
        "getvalue",
        "decode",
        "embedding_lock",
        "user_id",
        "user_embeddings",
        "np",
        "empty",
        "dtype",
        "np",
        "float32",
        "user_embeddings",
        "user_id",
        "face",
        "faces",
        "i",
        "i",
        "face",
        "bbox",
        "face",
        "embedding",
        "embedding",
        "norm",
        "embedding",
        "user_data",
        "shape",
        "torch",
        "tensor",
        "user_data",
        "dtype",
        "torch",
        "float32",
        "cuda",
        "torch",
        "tensor",
        "embedding",
        "dtype",
        "torch",
        "float32",
        "cuda",
        "torch",
        "nn",
        "functional",
        "cosine_similarity",
        "embeddings_tensor",
        "embedding_tensor",
        "unsqueeze",
        "cpu",
        "numpy",
        "np",
        "max",
        "sims",
        "np",
        "argmax",
        "sims",
        "max_sim",
        "COSINE_THRESHOLD",
        "user_data",
        "idx",
        "identity",
        "user_data",
        "user_data",
        "np",
        "vstack",
        "user_data",
        "embedding",
        "user_data",
        "append",
        "identity",
        "results",
        "append",
        "identity",
        "x1",
        "y1",
        "x2",
        "y2",
        "max_sim",
        "identity",
        "startswith",
        "img",
        "y1",
        "y2",
        "x1",
        "x2",
        "Image",
        "fromarray",
        "face_img",
        "BytesIO",
        "pil_crop",
        "save",
        "buffer",
        "format",
        "base64",
        "b64encode",
        "buffer",
        "getvalue",
        "decode",
        "base64_crop",
        "save_embeddings",
        "send_img",
        "results",
        "img_base64",
        "cropped_faces",
        "app",
        "post",
        "user_id",
        "Form",
        "file",
        "UploadFile",
        "File",
        "file",
        "read",
        "asyncio",
        "get_event_loop",
        "run_in_executor",
        "executor",
        "process_frame",
        "user_id",
        "content",
        "JSONResponse",
        "content",
        "result",
        "app",
        "post",
        "user_id",
        "Form",
        "oldLabel",
        "Form",
        "newLabel",
        "Form",
        "embedding_lock",
        "user_embeddings",
        "user_id",
        "newLabel",
        "label",
        "oldLabel",
        "label",
        "label",
        "labels",
        "user_embeddings",
        "user_id",
        "updated_labels",
        "save_embeddings",
        "JSONResponse",
        "content",
        "oldLabel",
        "newLabel",
        "updated_labels",
        "app",
        "post",
        "user_id",
        "Form",
        "name",
        "Form",
        "files",
        "UploadFile",
        "File",
        "file",
        "files",
        "file",
        "read",
        "Image",
        "open",
        "BytesIO",
        "content",
        "convert",
        "np",
        "array",
        "image",
        "face_app",
        "get",
        "img",
        "torch",
        "cuda",
        "memory_allocated",
        "faces",
        "file",
        "filename",
        "JSONResponse",
        "status_code",
        "content",
        "file",
        "filename",
        "faces",
        "embedding",
        "embedding",
        "np",
        "linalg",
        "norm",
        "embedding",
        "embeddings",
        "append",
        "embedding",
        "image",
        "close",
        "img",
        "e",
        "file",
        "filename",
        "e",
        "JSONResponse",
        "status_code",
        "content",
        "file",
        "filename",
        "embedding_lock",
        "embedding",
        "embeddings",
        "user_id",
        "user_embeddings",
        "np",
        "array",
        "embedding",
        "name",
        "user_embeddings",
        "user_id",
        "np",
        "vstack",
        "user_embeddings",
        "user_id",
        "embedding",
        "user_embeddings",
        "user_id",
        "append",
        "name",
        "save_embeddings",
        "len",
        "embeddings",
        "name",
        "user_id",
        "JSONResponse",
        "content",
        "len",
        "embeddings",
        "name",
        "user_id",
        "app",
        "post",
        "user_id",
        "Form",
        "name",
        "Form",
        "embedding_lock",
        "user_id",
        "user_embeddings",
        "JSONResponse",
        "status_code",
        "content",
        "user_id",
        "user_embeddings",
        "user_id",
        "user_embeddings",
        "user_id",
        "i",
        "i",
        "label",
        "labels",
        "label",
        "name",
        "len",
        "indices_to_keep",
        "len",
        "labels",
        "JSONResponse",
        "status_code",
        "content",
        "name",
        "user_id",
        "user_embeddings",
        "user_id",
        "embeddings",
        "indices_to_keep",
        "user_embeddings",
        "user_id",
        "labels",
        "i",
        "i",
        "indices_to_keep",
        "user_embeddings",
        "user_id",
        "user_embeddings",
        "user_id",
        "save_embeddings",
        "name",
        "user_id",
        "JSONResponse",
        "content",
        "name",
        "user_id",
        "kill_existing_processes",
        "ctx_id",
        "uvicorn",
        "run",
        "app",
        "host",
        "port",
        "run_server"
    ],
    "literals": [
        "\"uvicorn\"",
        "\"Cleaned previous uvicorn processes\"",
        "'./'",
        "\"user_embeddings.pkl\"",
        "\"rb\"",
        "\"*\"",
        "\"*\"",
        "\"*\"",
        "'buffalo_l'",
        "\"Using device:\"",
        "'detection'",
        "\"Detection model providers:\"",
        "'recognition'",
        "\"Recognition model providers:\"",
        "\"wb\"",
        "\"RGB\"",
        "\"MB\"",
        "\"results\"",
        "\"image_base64\"",
        "\"cropped_faces\"",
        "\"JPEG\"",
        "\"utf-8\"",
        "\"embeddings\"",
        "\"labels\"",
        "\"unknown_idx\"",
        "\"\"",
        "\"embeddings\"",
        "\"Unknown\"",
        "\"embeddings\"",
        "\"Unknown\"",
        "\"labels\"",
        "\"Unknown\"",
        "f\"Unknown {user_data['unknown_idx']}\"",
        "'unknown_idx'",
        "\"unknown_idx\"",
        "\"embeddings\"",
        "\"embeddings\"",
        "\"labels\"",
        "\"name\"",
        "\"bbox\"",
        "\"distance\"",
        "\"Unknown\"",
        "\"JPEG\"",
        "\"utf-8\"",
        "\"results\"",
        "\"image_base64\"",
        "\"cropped_faces\"",
        "\"/test-frame\"",
        "\"/update\"",
        "\"labels\"",
        "\"labels\"",
        "\"success\"",
        "\"message\"",
        "f\"Replaced all '{oldLabel}' with '{newLabel}'\"",
        "\"labels\"",
        "\"/add-face\"",
        "\"add face started\"",
        "\"RGB\"",
        "\"MB\"",
        "f\"No face detected in file: {file.filename}\"",
        "\"message\"",
        "f\"No face detected in file: {file.filename}\"",
        "f\"Error processing file {file.filename}: {e}\"",
        "\"message\"",
        "f\"Error processing image: {file.filename}\"",
        "\"embeddings\"",
        "\"labels\"",
        "\"unknown_idx\"",
        "\"embeddings\"",
        "\"embeddings\"",
        "\"labels\"",
        "f\"Added {len(embeddings)} embeddings for '{name}' under user '{user_id}'\"",
        "\"message\"",
        "f\"Added {len(embeddings)} embeddings for '{name}' under user '{user_id}'\"",
        "\"/delete-face\"",
        "\"message\"",
        "f\"User '{user_id}' not found\"",
        "\"embeddings\"",
        "\"labels\"",
        "\"message\"",
        "f\"No embeddings found for name '{name}' under user '{user_id}'\"",
        "\"embeddings\"",
        "\"labels\"",
        "\"labels\"",
        "f\"Deleted all embeddings for '{name}' under user '{user_id}'\"",
        "\"message\"",
        "f\"Deleted all embeddings for '{name}' under user '{user_id}'\"",
        "\"Server running on http://127.0.0.1:8000\"",
        "\"0.0.0.0\"",
        "\"__main__\""
    ],
    "variables": [
        "gray",
        "lap_var",
        "x1",
        "y1",
        "x2",
        "y2",
        "h",
        "w",
        "x1",
        "y1",
        "x2",
        "y2",
        "embedding_lock",
        "user_embeddings",
        "path",
        "EMBEDDINGS_PATH",
        "user_embeddings",
        "app",
        "ctx_id",
        "face_app",
        "providers",
        "providers",
        "COSINE_THRESHOLD",
        "executor",
        "image",
        "img",
        "faces",
        "results",
        "buffered",
        "img_base64",
        "send_img",
        "user_embeddings",
        "user_id",
        "user_data",
        "cropped_faces",
        "x1",
        "y1",
        "x2",
        "y2",
        "embedding",
        "embedding",
        "max_sim",
        "identity",
        "identity",
        "embeddings_tensor",
        "embedding_tensor",
        "sims",
        "max_sim",
        "idx",
        "identity",
        "send_img",
        "identity",
        "user_data",
        "send_img",
        "face_img",
        "pil_crop",
        "buffer",
        "base64_crop",
        "cropped_faces",
        "identity",
        "img_base64",
        "content",
        "result",
        "labels",
        "updated_labels",
        "embeddings",
        "content",
        "image",
        "img",
        "faces",
        "embedding",
        "embedding",
        "user_embeddings",
        "user_id",
        "embeddings",
        "labels",
        "indices_to_keep"
    ],
    "comments": [
        "import nest_asyncio",
        "Apply nest_asyncio to allow multiple event loops in Colab",
        "nest_asyncio.apply()",
        "Kill any existing processes",
        "Add margin and ensure bounds stay within the image",
        "Thread-safe embeddings store",
        "Load from disk if exists",
        "Setup FastAPI",
        "Setup InsightFace",
        "Get the ONNX backend providers used by the detection model",
        "Convert original image into base64 early",
        "Ensure user data exists",
        "Reference, safe inside lock",
        "crop the face",
        "Save only after modifying shared state",
        "Optional",
        "Optional",
        "Prediction route",
        "Replace oldLabel with newLabel",
        "Add new face (for registration)",
        "delete faces of name in user_id",
        "Find all indices where the label matches the name",
        "Filter embeddings and labels",
        "If all embeddings deleted, remove the user completely (optional)",
        "✅ Run ngrok and FastAPI server",
        "Ensure no previous FastAPI servers are running",
        "Localhost URL",
        "Run the FastAPI server directly without ngrok"
    ],
    "docstrings": [],
    "functions": [
        "kill_existing_processes",
        "is_blurry",
        "get_crop",
        "save_embeddings",
        "process_frame",
        "predict",
        "change_label",
        "add_face",
        "delete_face",
        "run_server"
    ],
    "classes": []
}