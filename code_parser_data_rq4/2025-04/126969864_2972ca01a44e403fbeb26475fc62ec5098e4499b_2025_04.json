{
    "identifiers": [
        "Subscription",
        "forgeStoreKitBearerToken",
        "productIdToPaymentFrequency",
        "storefrontToCountry",
        "require",
        "appleSubscriptionToExtendedData",
        "subscription",
        "subscription",
        "latest_receipt_info",
        "latest_receipt_info",
        "transactionId",
        "transactionId",
        "url",
        "forgeStoreKitBearerToken",
        "token",
        "token",
        "fetch",
        "url",
        "response",
        "json",
        "response",
        "response",
        "error",
        "error",
        "error",
        "error",
        "json",
        "json",
        "data",
        "data",
        "data",
        "item1",
        "lastTransactions",
        "lastTransactions",
        "lastTransactions",
        "item2",
        "signedTransactionInfo",
        "signedTransactionInfo",
        "jwt",
        "signedTransactionInfo",
        "data1",
        "data1",
        "storefrontToCountry",
        "appleResponse",
        "appleResponse",
        "productIdToPaymentFrequency",
        "appleResponse"
    ],
    "literals": [
        "'../models/subscription'",
        "'./apple-json-web-tokens'",
        "'./apple-mappings'",
        "'jsonwebtoken'",
        "string",
        "string",
        "string",
        "string",
        "string",
        "string",
        "string",
        "string",
        "string",
        "[940dc079] ${new Date()}",
        "'[3b5a2b0d] latest_receipt_info is empty'",
        "[116fa7d4] transactionId: ${transactionId}",
        "https://api.storekit.itunes.apple.com/inApps/v1/subscriptions/${transactionId}",
        "[5330931d] url: ${url}",
        "[f1335718] ${token}",
        "'GET'",
        "'Content-Type'",
        "'application/json'",
        "Bearer ${token}",
        "[0f984ea0] ${JSON.stringify(params)}",
        "[661fe1aa] error: fetch failed: ${response.status}",
        "[c63b76d3] error: fetch failed: ${error.message}",
        "[e9848cd6] error: fetch failed: ${JSON.stringify(error)}",
        "[55ca8e2c] ${JSON.stringify(json)}",
        "'[92d086b6] json.data is undefined'",
        "'[2ee57da0] json.data is empty'",
        "'[553620b1] json.data[0].lastTransactions is undefined'",
        "'[2b6cd147] json.data[0].lastTransactions is empty'",
        "'[f147df3e] json.data[0].lastTransactions[0].signedTransactionInfo is undefined'",
        "[c5dabbcc] ${signedTransactionInfo}",
        "[7f53de39] data1: ${JSON.stringify(data1)}"
    ],
    "variables": [
        "jwt",
        "appleSubscriptionToExtendedData",
        "latest_receipt_info",
        "transactionId",
        "url",
        "token",
        "json",
        "response",
        "data",
        "item1",
        "lastTransactions",
        "item2",
        "signedTransactionInfo",
        "data1",
        "appleResponse",
        "country",
        "currency",
        "paymentFrequency"
    ],
    "comments": [
        "AppleExtendedData is built from the answer from",
        "https://api.storekit.itunes.apple.com/inApps/v1/subscriptions/{transactionId}",
        "and contains information that are required to build an AcquisitionApiPayload",
        "country as two letter code",
        "currency as three letter code",
        "Same values as AcquisitionApiPayload.paymentFrequency",
        "\"ONE_OFF\"",
        "\"MONTHLY\"",
        "\"QUARTERLY\"",
        "\"SIX_MONTHLY\"",
        "\"ANNUALLY\"",
        "from which we are going to derive the paymentFrequency",
        "storefront seems to be the country as three letter code",
        "currency as three letter code",
        "This function takes a Subscription and return the extra data that is retrieved from the Apple API\n        at https://api.storekit.itunes.apple.com/inApps/v1/subscriptions/{transactionId}",
        "This extraction will be abstracted in a function in a coming refactoring",
        "{\n        \"environment\": \"Production\",\n        \"bundleId\": \"uk.co.guardian.Feast\",\n        \"appAppleId\": 603350f961c5,\n        \"data\": [\n            {\n                \"subscriptionGroupIdentifier\": \"21396030\",\n                \"lastTransactions\": [\n                    {\n                        \"originalTransactionId\": \"220002304451105\",\n                        \"status\": 2,\n                        \"signedTransactionInfo\": \"eyJhbGciOeUJEWlhKMGF[removed]\"",
        "extracting signedTransactionInfo",
        "Currently doing it by hand but it will be validated with zod in a coming refactoring",
        "At this point we need to transform the signedTransactionInfo into a JSON object: a AppleTransactionQueryResponse",
        "payload (anonymized) from the answer\n\n        {\n            \"transactionId\": \"2200001105\",\n            \"originalTransactionId\": \"2200001105\",\n            \"webOrderLineItemId\": \"22048309784\",\n            \"bundleId\": \"uk.co.guardian.Feast\",\n            \"productId\": \"uk.co.guardian.Feast.monthly\",\n            \"subscriptionGroupIdentifier\": \"21396030\",\n            \"purchaseDate\": 1732526628000,\n            \"originalPurchaseDate\": 1732526630000,\n            \"expiresDate\": 1733736228000,\n            \"quantity\": 1,\n            \"type\": \"Auto-Renewable Subscription\",\n            \"appAccountToken\": \"3b70e18e-de6c-46a8-83b5-3e317d6c7b84\",\n            \"inAppOwnershipType\": \"PURCHASED\",\n            \"signedDate\": 1735899829949,\n            \"offerType\": 1,\n            \"environment\": \"Production\",\n            \"transactionReason\": \"PURCHASE\",\n            \"storefront\": \"GBR\",\n            \"storefrontId\": \"143444\",\n            \"price\": 0,\n            \"currency\": \"GBP\",\n            \"offerDiscountType\": \"FREE_TRIAL\"\n        }\n\n        Sample of AppleTransactionQueryResponse {\n            \"transactionId\": \"2200001105\",\n            \"productId\": \"uk.co.guardian.Feast.monthly\",\n            \"storefront\": \"GBR\",\n            \"currency\": \"GBP\",\n        }"
    ],
    "docstrings": [],
    "functions": [],
    "classes": []
}