{
    "identifiers": [
        "telegram",
        "files",
        "maintains",
        "cn",
        "hutool",
        "core",
        "collection",
        "IterUtil",
        "cn",
        "hutool",
        "core",
        "MapUtil",
        "cn",
        "hutool",
        "core",
        "util",
        "StrUtil",
        "io",
        "vertx",
        "core",
        "Future",
        "io",
        "vertx",
        "core",
        "io",
        "vertx",
        "core",
        "json",
        "JsonObject",
        "io",
        "vertx",
        "sqlclient",
        "templates",
        "SqlTemplate",
        "org",
        "drinkless",
        "tdlib",
        "TdApi",
        "telegram",
        "files",
        "telegram",
        "files",
        "repository",
        "FileRecord",
        "java",
        "util",
        "java",
        "util",
        "java",
        "util",
        "Optional",
        "java",
        "util",
        "concurrent",
        "ConcurrentHashMap",
        "downloadingThumbnailUniqueIds",
        "count",
        "scanning",
        "lastDownloadingCount",
        "lastTime",
        "Override",
        "startPromise",
        "initEventConsumer",
        "start",
        "startPromise",
        "handleThumbnail",
        "vertx",
        "setPeriodic",
        "id",
        "waitForThumbnailDownload",
        "timeInterval",
        "start",
        "log",
        "info",
        "log",
        "debug",
        "fromMessageId",
        "page",
        "log",
        "debug",
        "formatted",
        "page",
        "rows",
        "Future",
        "await",
        "SqlTemplate",
        "forQuery",
        "DataVerticle",
        "pool",
        "formatted",
        "fromMessageId",
        "mapTo",
        "FileRecord",
        "ROW_MAPPER",
        "execute",
        "MapUtil",
        "of",
        "fromMessageId",
        "IterUtil",
        "toList",
        "rows",
        "isEmpty",
        "log",
        "debug",
        "fileRecord",
        "rows",
        "downloadThumbnail",
        "fileRecord",
        "count",
        "fromMessageId",
        "rows",
        "getLast",
        "messageId",
        "page",
        "log",
        "info",
        "formatted",
        "count",
        "scanning",
        "e",
        "log",
        "error",
        "e",
        "end",
        "e",
        "scanning",
        "downloadingThumbnailUniqueIds",
        "isEmpty",
        "log",
        "info",
        "end",
        "log",
        "info",
        "formatted",
        "downloadingThumbnailUniqueIds",
        "size",
        "count",
        "timeInterval",
        "intervalPretty",
        "scanning",
        "downloadingThumbnailUniqueIds",
        "size",
        "lastDownloadingCount",
        "currentTimeMillis",
        "lastTime",
        "log",
        "error",
        "formatted",
        "downloadingThumbnailUniqueIds",
        "size",
        "end",
        "scanning",
        "downloadingThumbnailUniqueIds",
        "size",
        "lastDownloadingCount",
        "lastDownloadingCount",
        "downloadingThumbnailUniqueIds",
        "size",
        "lastTime",
        "currentTimeMillis",
        "vertx",
        "eventBus",
        "consumer",
        "EventEnum",
        "TELEGRAM_EVENT",
        "address",
        "message",
        "jsonObject",
        "message",
        "body",
        "payload",
        "jsonObject",
        "getJsonObject",
        "mapTo",
        "payload",
        "payload",
        "EventPayload",
        "TYPE_FILE_STATUS",
        "payload",
        "data",
        "payload",
        "data",
        "data",
        "StrUtil",
        "isNotBlank",
        "data",
        "get",
        "downloadStatus",
        "FileRecord",
        "DownloadStatus",
        "valueOf",
        "data",
        "get",
        "downloadStatus",
        "FileRecord",
        "DownloadStatus",
        "completed",
        "thumbnailUniqueId",
        "data",
        "get",
        "downloadingThumbnailUniqueIds",
        "containsKey",
        "thumbnailUniqueId",
        "updateThumbnailUniqueId",
        "downloadingThumbnailUniqueIds",
        "get",
        "thumbnailUniqueId",
        "thumbnailUniqueId",
        "downloadingThumbnailUniqueIds",
        "remove",
        "thumbnailUniqueId",
        "fileRecord",
        "telegramVerticleOptional",
        "TelegramVerticles",
        "get",
        "fileRecord",
        "telegramId",
        "telegramVerticleOptional",
        "isEmpty",
        "log",
        "error",
        "formatted",
        "fileRecord",
        "telegramId",
        "telegramVerticle",
        "telegramVerticleOptional",
        "get",
        "message",
        "Future",
        "await",
        "telegramVerticle",
        "client",
        "execute",
        "fileRecord",
        "chatId",
        "fileRecord",
        "messageId",
        "thumbnailRecordOptional",
        "TdApiHelp",
        "getFileHandler",
        "message",
        "fileHandler",
        "fileHandler",
        "convertThumbnailRecord",
        "telegramVerticle",
        "telegramRecord",
        "id",
        "thumbnailRecordOptional",
        "isEmpty",
        "thumbnailRecord",
        "thumbnailRecordOptional",
        "get",
        "downloadingThumbnailUniqueIds",
        "put",
        "thumbnailRecord",
        "uniqueId",
        "fileRecord",
        "uniqueId",
        "download",
        "Future",
        "await",
        "telegramVerticle",
        "downloadThumbnail",
        "fileRecord",
        "chatId",
        "fileRecord",
        "messageId",
        "thumbnailRecord",
        "download",
        "downloadingThumbnailUniqueIds",
        "remove",
        "thumbnailRecord",
        "uniqueId",
        "thumbnailRecord",
        "isDownloadStatus",
        "FileRecord",
        "DownloadStatus",
        "completed",
        "updateThumbnailUniqueId",
        "fileRecord",
        "uniqueId",
        "thumbnailRecord",
        "uniqueId",
        "e",
        "log",
        "error",
        "e",
        "formatted",
        "fileRecord",
        "uniqueId",
        "uniqueId",
        "thumbnailUniqueId",
        "Future",
        "await",
        "SqlTemplate",
        "forUpdate",
        "DataVerticle",
        "pool",
        "execute",
        "MapUtil",
        "ofEntries",
        "MapUtil",
        "entry",
        "uniqueId",
        "MapUtil",
        "entry",
        "thumbnailUniqueId",
        "onFailure",
        "err",
        "log",
        "error",
        "err",
        "formatted",
        "uniqueId"
    ],
    "literals": [
        "\"ðŸ”¨ Start to handle thumbnail\"",
        "\"ðŸ”¨ 1.Scan all file records missing thumbnail and download them\"",
        "\"ðŸ”¨ Scan page %d, limit 100\"",
        "\"\"\"\n                                SELECT * FROM file_record\n                                WHERE thumbnail_unique_id is null AND type != 'thumbnail'\n                                %s\n                                ORDER BY message_id desc LIMIT 100\n                                \"\"\"",
        "\"\"",
        "\" AND message_id < #{fromMessageId}\"",
        "\"fromMessageId\"",
        "\"ðŸ”¨ No more file records found, scan finished\"",
        "\"âœ… All %d file records with missing thumbnail start to download\"",
        "\"ðŸ”¨ Failed to handle thumbnail\"",
        "\"âœ… All thumbnails downloaded successfully, finished\"",
        "\"ðŸ”¨ Processing %d thumbnails of %d. Time consumed: %s\"",
        "\"ðŸ”¨ Thumbnail download timeout, %d thumbnails are still downloading\"",
        "\"Thumbnail download timeout\"",
        "\"payload\"",
        "\"downloadStatus\"",
        "\"downloadStatus\"",
        "\"uniqueId\"",
        "\"ðŸ”¨ Telegram verticle not found for telegram id: %d\"",
        "\"ðŸ”¨ Failed to download thumbnail, file unique id: %s\"",
        "\"\"\"\n                        UPDATE file_record\n                        SET thumbnail_unique_id = #{thumbnailUniqueId}\n                        WHERE unique_id = #{uniqueId}\n                        \"\"\"",
        "\"uniqueId\"",
        "\"thumbnailUniqueId\"",
        "\"ðŸ”¨ Failed to update thumbnail unique id: %s\""
    ],
    "variables": [],
    "comments": [
        "thumbnail unique id -> file_record unique id"
    ],
    "docstrings": [
        "* This verticle is responsible for maintaining the thumbnails of the media files."
    ],
    "functions": [
        "start",
        "handleThumbnail",
        "waitForThumbnailDownload",
        "initEventConsumer",
        "downloadThumbnail",
        "updateThumbnailUniqueId"
    ],
    "classes": [
        "ThumbnailMaintainVerticle"
    ]
}