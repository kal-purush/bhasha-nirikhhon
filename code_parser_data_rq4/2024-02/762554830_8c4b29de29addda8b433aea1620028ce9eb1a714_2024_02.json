{
    "identifiers": [
        "datetime",
        "os",
        "imageio",
        "io",
        "BytesIO",
        "numpy",
        "np",
        "torch",
        "torch",
        "nn",
        "functional",
        "F",
        "umap",
        "matplotlib",
        "pyplot",
        "plt",
        "PIL",
        "Image",
        "transformers",
        "AutoModelForCausalLM",
        "AutoTokenizer",
        "AutoConfig",
        "seaborn",
        "sns",
        "torch",
        "set_default_device",
        "AutoModelForCausalLM",
        "from_pretrained",
        "torch_dtype",
        "trust_remote_code",
        "AutoTokenizer",
        "from_pretrained",
        "trust_remote_code",
        "tokenizer",
        "prompt",
        "return_tensors",
        "return_attention_mask",
        "enc",
        "to",
        "model",
        "forward",
        "input_ids",
        "output_hidden_states",
        "output",
        "output",
        "hidden_states",
        "model",
        "model",
        "final_layernorm",
        "hs",
        "squeeze",
        "hs",
        "hidden_states",
        "normed_states",
        "append",
        "hidden_states",
        "squeeze",
        "normed_states",
        "normed_states",
        "final_state",
        "top_k_indices",
        "final_state",
        "top_k_indices",
        "top_k_embeddings",
        "umap",
        "UMAP",
        "n_components",
        "metric",
        "min_dist",
        "n_neighbors",
        "forward",
        "get_normed_states",
        "output",
        "logits",
        "logprobs",
        "normed_states",
        "get_top_k_embeddings",
        "final_state_embeddings",
        "top_k_indices",
        "cpu",
        "numpy",
        "top_k_embeddings",
        "cpu",
        "detach",
        "numpy",
        "reshape",
        "top_k_embeddings",
        "size",
        "umap_reducer",
        "fit",
        "top_k_embeddings_np",
        "umap_reducer",
        "transform",
        "state",
        "cpu",
        "detach",
        "numpy",
        "state",
        "normed_states",
        "model",
        "lm_head",
        "normed_states",
        "unsqueeze",
        "F",
        "softmax",
        "logits",
        "dim",
        "torch",
        "topk",
        "probs",
        "top_k",
        "umap",
        "embeddings",
        "min",
        "embedding",
        "min",
        "embedding",
        "embeddings",
        "max",
        "embedding",
        "max",
        "embedding",
        "embeddings",
        "min",
        "embedding",
        "min",
        "embedding",
        "embeddings",
        "max",
        "embedding",
        "max",
        "embedding",
        "embeddings",
        "global_x_min",
        "buffer",
        "global_x_max",
        "buffer",
        "global_y_min",
        "buffer",
        "global_y_max",
        "buffer",
        "i",
        "embedding",
        "embeddings",
        "plt",
        "figure",
        "figsize",
        "sns",
        "kdeplot",
        "x",
        "embedding",
        "y",
        "embedding",
        "cmap",
        "levels",
        "ax",
        "set_facecolor",
        "plt",
        "gcf",
        "set_facecolor",
        "ax",
        "xaxis",
        "label",
        "set_color",
        "ax",
        "yaxis",
        "label",
        "set_color",
        "ax",
        "tick_params",
        "axis",
        "colors",
        "ax",
        "tick_params",
        "axis",
        "colors",
        "ax",
        "spines",
        "set_color",
        "ax",
        "spines",
        "set_color",
        "ax",
        "title",
        "set_color",
        "plt",
        "axis",
        "global_x_min",
        "global_x_max",
        "global_y_min",
        "global_y_max",
        "plt",
        "title",
        "i",
        "logprobs",
        "tokenizer",
        "decode",
        "idx",
        "top_probs",
        "j",
        "item",
        "j",
        "idx",
        "top_indices",
        "join",
        "repr",
        "token",
        "prob",
        "token",
        "prob",
        "top_tokens",
        "repr",
        "prompt",
        "top_k",
        "top_info",
        "plt",
        "text",
        "global_x_min",
        "global_y_min",
        "text_str",
        "verticalalignment",
        "horizontalalignment",
        "color",
        "fontsize",
        "BytesIO",
        "plt",
        "savefig",
        "buf",
        "format",
        "buf",
        "seek",
        "images",
        "append",
        "Image",
        "open",
        "buf",
        "plt",
        "close",
        "imageio",
        "mimsave",
        "images",
        "format",
        "fps",
        "Scan",
        "test"
    ],
    "literals": [
        "'cuda'",
        "'microsoft/phi-2'",
        "'auto'",
        "'microsoft/phi-2'",
        "'pt'",
        "'input_ids'",
        "'cuda'",
        "'cosine'",
        "\"mako\"",
        "'black'",
        "'black'",
        "'white'",
        "'white'",
        "'x'",
        "'white'",
        "'y'",
        "'white'",
        "'bottom'",
        "'white'",
        "'left'",
        "'white'",
        "'white'",
        "f\"layer {i}\"",
        "\", \"",
        "f\"({repr(token)}, {prob:.2f})\"",
        "f\"prompt: {repr(self.prompt)}\\ntop_k({self.top_k}): {top_info}\"",
        "'bottom'",
        "'left'",
        "'white'",
        "'png'",
        "'hidden_states.mp4'",
        "'MP4'"
    ],
    "variables": [
        "model",
        "tokenizer",
        "top_k",
        "prompt",
        "enc",
        "input_ids",
        "hidden_states",
        "normed_states",
        "normed_states",
        "top_k_embeddings",
        "umap_reducer",
        "embeddings",
        "output",
        "logits",
        "log_probs",
        "top_k_indices",
        "final_state_embeddings",
        "top_k_embeddings",
        "top_k_embeddings_np",
        "probs",
        "embeddings",
        "global_x_min",
        "global_x_max",
        "global_y_min",
        "global_y_max",
        "buffer",
        "images",
        "ax",
        "top_probs",
        "top_indices",
        "top_tokens",
        "top_info",
        "text_str",
        "buf"
    ],
    "comments": [
        "output layer is already normed",
        "Gather embeddings for top_k_indices",
        "Compute logits and select top_k logits",
        "Make sure this returns logits for the last layer",
        "Adjust to get indices of top logits",
        "Get embeddings corresponding to top_k logits from the final hidden state",
        "Final hidden state",
        "Reshape for UMAP",
        "Fit UMAP using embeddings of top_k logits"
    ],
    "docstrings": [
        "'''After losing one of my 4 gpus I have only'''",
        "\"\"\"\n        Extract embeddings corresponding to top_k logits from the final hidden state.\n        \"\"\""
    ],
    "functions": [
        "forward",
        "get_normed_states",
        "get_top_k_embeddings",
        "umap",
        "logits",
        "logprobs",
        "test"
    ],
    "classes": [
        "Scan"
    ]
}