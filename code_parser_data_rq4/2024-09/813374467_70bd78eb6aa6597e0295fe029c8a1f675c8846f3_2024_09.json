{
    "identifiers": [
        "print_function",
        "argparse",
        "json",
        "os",
        "sys",
        "time",
        "traceback",
        "threading",
        "concurrent",
        "futures",
        "logging",
        "gunicorn",
        "app",
        "flask",
        "Flask",
        "Response",
        "json",
        "make_response",
        "request",
        "prometheus_client",
        "prometheus_client",
        "CollectorRegistry",
        "Summary",
        "multiprocess",
        "Histogram",
        "ExternalServiceExecutor",
        "init_REST",
        "init_gRPC",
        "run_external_service",
        "InternalServiceExecutor",
        "InternalServiceExecutor",
        "mub_pb2_grpc",
        "pb2_grpc",
        "mub_pb2",
        "pb2",
        "grpc",
        "Flask",
        "os",
        "environ",
        "os",
        "environ",
        "os",
        "environ",
        "os",
        "environ",
        "os",
        "environ",
        "open",
        "f",
        "json",
        "load",
        "f",
        "service",
        "workmodel",
        "app",
        "logger",
        "info",
        "service",
        "service",
        "ID",
        "workmodel",
        "service",
        "workmodel",
        "service",
        "workmodel",
        "service",
        "res",
        "read_config_files",
        "globalDict",
        "ID",
        "work_model_config",
        "work_model_config",
        "globalDict",
        "ID",
        "keys",
        "globalDict",
        "ID",
        "lower",
        "CollectorRegistry",
        "multiprocess",
        "MultiProcessCollector",
        "registry",
        "Summary",
        "registry",
        "registry",
        "Summary",
        "registry",
        "registry",
        "Summary",
        "registry",
        "registry",
        "Summary",
        "registry",
        "registry",
        "Histogram",
        "registry",
        "registry",
        "buckets",
        "buckets",
        "Histogram",
        "registry",
        "registry",
        "buckets",
        "buckets",
        "Histogram",
        "registry",
        "registry",
        "buckets",
        "buckets",
        "InternalServiceExecutor",
        "internal_service_config",
        "app",
        "route",
        "globalDict",
        "ID",
        "methods",
        "work_model_config",
        "service_mesh_config",
        "internal_service_config",
        "InternalServiceExecutor",
        "time",
        "time",
        "app",
        "logger",
        "info",
        "request",
        "query_string",
        "decode",
        "request",
        "args",
        "get",
        "behaviour_id",
        "work_model_config",
        "keys",
        "behaviour_id",
        "work_model_config",
        "keys",
        "work_model_config",
        "behaviour_id",
        "keys",
        "work_model_config",
        "behaviour_id",
        "jhdr",
        "jaeger_headers_list",
        "request",
        "headers",
        "get",
        "jhdr",
        "val",
        "val",
        "request",
        "method",
        "request",
        "json",
        "len",
        "trace",
        "keys",
        "ID",
        "trace",
        "split",
        "traceEscapeString",
        "trace",
        "trace",
        "len",
        "trace",
        "len",
        "trace",
        "ID",
        "i",
        "n_groups",
        "trace",
        "ID",
        "i",
        "len",
        "group",
        "group",
        "keys",
        "service_mesh_config",
        "append",
        "group_dict",
        "behaviour_id",
        "work_model_config",
        "keys",
        "behaviour_id",
        "work_model_config",
        "keys",
        "work_model_config",
        "behaviour_id",
        "keys",
        "work_model_config",
        "behaviour_id",
        "app",
        "logger",
        "info",
        "time",
        "time",
        "internal_service_executer",
        "run_internal_service",
        "time",
        "time",
        "start_local_processing",
        "INTERNAL_PROCESSING",
        "labels",
        "ZONE",
        "K8S_APP",
        "request",
        "method",
        "request",
        "path",
        "observe",
        "local_processing_latency",
        "INTERNAL_PROCESSING_BUCKET",
        "labels",
        "ZONE",
        "K8S_APP",
        "request",
        "method",
        "request",
        "path",
        "observe",
        "local_processing_latency",
        "RESPONSE_SIZE",
        "labels",
        "ZONE",
        "K8S_APP",
        "request",
        "method",
        "request",
        "path",
        "request",
        "remote_addr",
        "ID",
        "observe",
        "len",
        "body",
        "app",
        "logger",
        "info",
        "len",
        "body",
        "app",
        "logger",
        "info",
        "time",
        "time",
        "app",
        "logger",
        "info",
        "len",
        "service_mesh_config",
        "len",
        "trace",
        "run_external_service",
        "service_mesh_config",
        "globalDict",
        "query_string",
        "trace",
        "ID",
        "app",
        "jaeger_headers",
        "run_external_service",
        "service_mesh_config",
        "globalDict",
        "query_string",
        "app",
        "jaeger_headers",
        "len",
        "service_error_dict",
        "app",
        "logger",
        "error",
        "service_error_dict",
        "app",
        "logger",
        "error",
        "app",
        "logger",
        "error",
        "service_error_dict",
        "make_response",
        "json",
        "dumps",
        "app",
        "logger",
        "info",
        "make_response",
        "body",
        "EXTERNAL_PROCESSING",
        "labels",
        "ZONE",
        "K8S_APP",
        "request",
        "method",
        "request",
        "path",
        "observe",
        "time",
        "time",
        "start_external_request_processing",
        "EXTERNAL_PROCESSING_BUCKET",
        "labels",
        "ZONE",
        "K8S_APP",
        "request",
        "method",
        "request",
        "path",
        "observe",
        "time",
        "time",
        "start_external_request_processing",
        "REQUEST_PROCESSING",
        "labels",
        "ZONE",
        "K8S_APP",
        "request",
        "method",
        "request",
        "path",
        "request",
        "remote_addr",
        "ID",
        "observe",
        "time",
        "time",
        "start_request_processing",
        "REQUEST_PROCESSING_BUCKET",
        "labels",
        "ZONE",
        "K8S_APP",
        "request",
        "method",
        "request",
        "path",
        "request",
        "remote_addr",
        "ID",
        "observe",
        "time",
        "time",
        "start_request_processing",
        "response",
        "headers",
        "update",
        "jaeger_headers",
        "response",
        "err",
        "app",
        "logger",
        "error",
        "err",
        "json",
        "dumps",
        "app",
        "route",
        "Response",
        "prometheus_client",
        "generate_latest",
        "registry",
        "mimetype",
        "CONTENT_TYPE_LATEST",
        "gunicorn",
        "app",
        "BaseApplication",
        "app",
        "options",
        "options",
        "app",
        "key",
        "value",
        "key",
        "value",
        "options",
        "items",
        "key",
        "cfg",
        "settings",
        "value",
        "key",
        "value",
        "config",
        "items",
        "cfg",
        "key",
        "lower",
        "value",
        "application",
        "pb2_grpc",
        "MicroServiceServicer",
        "grpc",
        "server",
        "futures",
        "ThreadPoolExecutor",
        "max_workers",
        "TN",
        "req",
        "context",
        "time",
        "time",
        "app",
        "logger",
        "info",
        "info",
        "req",
        "message",
        "context",
        "peer",
        "split",
        "app",
        "logger",
        "info",
        "ID",
        "message",
        "app",
        "logger",
        "info",
        "time",
        "time",
        "run_internal_service",
        "work_model_config",
        "time",
        "time",
        "start_local_processing",
        "INTERNAL_PROCESSING",
        "labels",
        "ZONE",
        "K8S_APP",
        "observe",
        "local_processing_latency",
        "RESPONSE_SIZE",
        "labels",
        "ZONE",
        "K8S_APP",
        "remote_address",
        "ID",
        "observe",
        "len",
        "body",
        "app",
        "logger",
        "info",
        "len",
        "body",
        "app",
        "logger",
        "info",
        "app",
        "logger",
        "info",
        "time",
        "time",
        "len",
        "service_mesh_config",
        "run_external_service",
        "service_mesh_config",
        "globalDict",
        "len",
        "service_error_dict",
        "app",
        "logger",
        "error",
        "service_error_dict",
        "app",
        "logger",
        "error",
        "app",
        "logger",
        "error",
        "service_error_dict",
        "pb2",
        "MessageResponse",
        "result",
        "app",
        "logger",
        "info",
        "body",
        "EXTERNAL_PROCESSING",
        "labels",
        "ZONE",
        "K8S_APP",
        "observe",
        "time",
        "time",
        "start_external_request_processing",
        "REQUEST_PROCESSING",
        "labels",
        "ZONE",
        "K8S_APP",
        "remote_address",
        "ID",
        "observe",
        "time",
        "time",
        "start_request_processing",
        "pb2",
        "MessageResponse",
        "result",
        "err",
        "app",
        "logger",
        "error",
        "err",
        "err",
        "pb2",
        "MessageResponse",
        "result",
        "pb2_grpc",
        "add_MicroServiceServicer_to_server",
        "server",
        "server",
        "add_insecure_port",
        "gRPC_port",
        "server",
        "start",
        "request_method",
        "init_REST",
        "app",
        "PN",
        "TN",
        "HttpServer",
        "app",
        "options_gunicorn",
        "run",
        "request_method",
        "globalDict",
        "ID",
        "work_model_config",
        "init_gRPC",
        "service_mesh_config",
        "globalDict",
        "gRPC_port",
        "app",
        "gRPCThread",
        "grpc_thread",
        "run",
        "app",
        "run",
        "host",
        "port",
        "threaded",
        "app",
        "logger",
        "info",
        "sys",
        "exit"
    ],
    "literals": [
        "'x-request-id'",
        "'x-b3-traceid'",
        "'x-b3-spanid'",
        "'x-b3-parentspanid'",
        "'x-b3-sampled'",
        "'x-b3-flags'",
        "'x-datadog-trace-id'",
        "'x-datadog-parent-id'",
        "'x-datadog-sampling-priority'",
        "'x-ot-span-context'",
        "'grpc-trace-bin'",
        "'traceparent'",
        "'x-cloud-trace-context'",
        "\"APP\"",
        "\"ZONE\"",
        "\"K8S_APP\"",
        "\"PN\"",
        "\"TN\"",
        "\"__\"",
        "'HealthcareWorkspace/workmodel.json'",
        "f'service: {service}'",
        "\"url\"",
        "\"url\"",
        "\"path\"",
        "\"path\"",
        "'work_model'",
        "'work_model'",
        "'external_services'",
        "'internal_service'",
        "\"request_method\"",
        "'work_model'",
        "'work_model'",
        "\"request_method\"",
        "\"rest\"",
        "'text/plain; version=0.0.4; charset=utf-8'",
        "'mub_response_size'",
        "'Response size'",
        "'zone'",
        "'app_name'",
        "'method'",
        "'endpoint'",
        "'from'",
        "'kubernetes_service'",
        "'mub_internal_processing_latency_milliseconds'",
        "'Latency of internal service'",
        "'zone'",
        "'app_name'",
        "'method'",
        "'endpoint'",
        "'mub_external_processing_latency_milliseconds'",
        "'Latency of external services'",
        "'zone'",
        "'app_name'",
        "'method'",
        "'endpoint'",
        "'mub_request_processing_latency_milliseconds'",
        "'Request latency including external and internal service'",
        "'zone'",
        "'app_name'",
        "'method'",
        "'endpoint'",
        "'from'",
        "'kubernetes_service'",
        "\"inf\"",
        "'mub_internal_processing_latency_milliseconds_bucket'",
        "'Latency of internal service'",
        "'zone'",
        "'app_name'",
        "'method'",
        "'endpoint'",
        "'mub_external_processing_latency_milliseconds_bucket'",
        "'Latency of external services'",
        "'zone'",
        "'app_name'",
        "'method'",
        "'endpoint'",
        "'mub_request_processing_latency_milliseconds_bucket'",
        "'Request latency including external and internal service'",
        "'zone'",
        "'app_name'",
        "'method'",
        "'endpoint'",
        "'from'",
        "'kubernetes_service'",
        "f\"{globalDict['work_model'][ID]['path']}\"",
        "'work_model'",
        "'path'",
        "'GET'",
        "'POST'",
        "'Request Received'",
        "'bid'",
        "'default'",
        "'default'",
        "\"alternative_behaviors\"",
        "'alternative_behaviors'",
        "\"internal_services\"",
        "'alternative_behaviors'",
        "'alternative_behaviors'",
        "'internal_service'",
        "'POST'",
        "'bad trace format'",
        "\"bad trace format, ID\"",
        "'seq_len'",
        "'services'",
        "'default'",
        "\"alternative_behaviors\"",
        "'alternative_behaviors'",
        "\"external_services\"",
        "'alternative_behaviors'",
        "'alternative_behaviors'",
        "'external_services'",
        "\"*************** INTERNAL SERVICE STARTED ***************\"",
        "\"len(body): %d\"",
        "\"############### INTERNAL SERVICE FINISHED! ###############\"",
        "\"*************** EXTERNAL SERVICES STARTED ***************\"",
        "'work_model'",
        "'work_model'",
        "\"Error in request external services\"",
        "\"message\"",
        "\"Error in external services request\"",
        "\"############### EXTERNAL SERVICES FINISHED! ###############\"",
        "\"text/plain\"",
        "\"Error in start_worker\"",
        "\"message\"",
        "\"Error\"",
        "'/metrics'",
        "'Request Received'",
        "\":\"",
        "f'I am service: {ID} and I received this message: --> \"{message}\"'",
        "\"*************** INTERNAL SERVICE STARTED ***************\"",
        "\"internal_service\"",
        "\"grpc\"",
        "\"grpc\"",
        "\"grpc\"",
        "\"grpc\"",
        "\"len(body): %d\"",
        "\"############### INTERNAL SERVICE FINISHED! ###############\"",
        "\"*************** EXTERNAL SERVICES STARTED ***************\"",
        "'work_model'",
        "\"Error in request external services\"",
        "'text'",
        "f\"Error in external services request\"",
        "'status_code'",
        "\"############### EXTERNAL SERVICES FINISHED! ###############\"",
        "'text'",
        "'status_code'",
        "\"grpc\"",
        "\"grpc\"",
        "\"grpc\"",
        "\"grpc\"",
        "\"Error: in GetMicroServiceResponse,\"",
        "'text'",
        "f\"Error: in GetMicroServiceResponse, {str(err)}\"",
        "'status_code'",
        "f'[::]:{gRPC_port}'",
        "'__main__'",
        "\"rest\"",
        "'bind'",
        "'%s:%s'",
        "'0.0.0.0'",
        "'workers'",
        "'config'",
        "\"/app/gunicorn.conf.py\"",
        "'threads'",
        "\"grpc\"",
        "'work_model'",
        "'external_services'",
        "'work_model'",
        "'0.0.0.0'",
        "\"Error: Unsupported request method\""
    ],
    "variables": [
        "jaeger_headers_list",
        "app",
        "ID",
        "ZONE",
        "K8S_APP",
        "PN",
        "TN",
        "traceEscapeString",
        "globalDict",
        "res",
        "workmodel",
        "res",
        "service",
        "res",
        "service",
        "globalDict",
        "work_model_config",
        "service_mesh_config",
        "internal_service_config",
        "request_method",
        "request_method",
        "registry",
        "CONTENT_TYPE_LATEST",
        "RESPONSE_SIZE",
        "INTERNAL_PROCESSING",
        "EXTERNAL_PROCESSING",
        "REQUEST_PROCESSING",
        "buckets",
        "INTERNAL_PROCESSING_BUCKET",
        "EXTERNAL_PROCESSING_BUCKET",
        "REQUEST_PROCESSING_BUCKET",
        "internal_service_executer",
        "start_request_processing",
        "query_string",
        "behaviour_id",
        "internal_service_config",
        "jaeger_headers",
        "val",
        "jaeger_headers",
        "jhdr",
        "trace",
        "trace",
        "trace",
        "ID",
        "n_groups",
        "service_mesh_config",
        "group",
        "group_dict",
        "group_dict",
        "group_dict",
        "service_mesh_config",
        "start_local_processing",
        "body",
        "local_processing_latency",
        "start_external_request_processing",
        "service_error_dict",
        "service_error_dict",
        "response",
        "response",
        "mimetype",
        "options",
        "application",
        "config",
        "gRPC_port",
        "server",
        "start_request_processing",
        "message",
        "remote_address",
        "start_local_processing",
        "body",
        "local_processing_latency",
        "start_external_request_processing",
        "service_error_dict",
        "result",
        "result",
        "result",
        "options_gunicorn",
        "work_model_config",
        "service_mesh_config",
        "grpc_thread"
    ],
    "comments": [
        "from multiprocessing import Array, Manager, Value",
        "Configuration of global variables",
        "Flask APP",
        "Pod Zone",
        "K8s label app",
        "Number of processes",
        "Number of thread per process",
        "globalDict=Manager().dict()",
        "shrink workmodel",
        "must be shared among processes for hot update",
        "default behaviour",
        "PROMETHEUS METRICS",
        "update internal service behaviour",
        "trace context propagation",
        "if POST check the presence of a trace",
        "sanity_check",
        "We insert 1 more key \"s0\": [value]",
        "trace-driven request",
        "update external service behaviour",
        "Execute the internal service",
        "TODO: This implementation is not supported for trace driven",
        "Execute the external services",
        "Add trace context propagation headers to the response",
        "app.logger.error(traceback.format_exc())",
        "Prometheus",
        "Custom Gunicorn application: https://docs.gunicorn.org/en/stable/custom.html",
        "GRPC (no multi-process)",
        "Execute the internal service",
        "Execute the external services",
        "初始化interal function",
        "Start Gunicorn HTTP REST Server (multi-process)",
        "Start the gRPC server",
        "Flask HTTP REST server started for Prometheus metrics and for the entry point (s0) that anyway receives REST requests from API gateway"
    ],
    "docstrings": [],
    "functions": [
        "read_config_files",
        "start_worker",
        "metrics",
        "load_config",
        "load",
        "GetMicroServiceResponse",
        "run"
    ],
    "classes": [
        "HttpServer",
        "gRPCThread"
    ]
}