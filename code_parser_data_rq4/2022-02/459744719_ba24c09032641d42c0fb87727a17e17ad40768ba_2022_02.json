{
    "identifiers": [
        "sys",
        "os",
        "logging",
        "getpass",
        "subprocess",
        "json",
        "time",
        "socket",
        "secrets",
        "ldap",
        "ESC",
        "ESC",
        "ESC",
        "MSG",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M",
        "M_WELCOME",
        "M_UNKNOWN_PASSWORD",
        "M_NOACCOUNT",
        "M_ACCOUNT_FOUND",
        "M_UNAUTHORIZED",
        "M_ACCOUNT_CREATED",
        "M_YOUR_PASSWORD",
        "M_ACCOUNT_REMOVED",
        "M_LOGIN_MESSAGE",
        "M_SELECT_EXIT",
        "M_SELECT_PASSWORD_RESET",
        "M_SELECT_DELETE_ACCOUNT",
        "M_PLEASE_SELECT",
        "M_BYE",
        "M_RESET_CONFIRM",
        "M_DELETE_WARNING",
        "M_YESNO",
        "M_ACCOUNT_GENERATION",
        "M_MAYBE_LATER",
        "M_BREAK",
        "M_NOTHING",
        "M_INCORRECT",
        "M_FAILED",
        "key",
        "key",
        "split",
        "len",
        "k",
        "k",
        "config",
        "config",
        "k",
        "key",
        "exit",
        "len",
        "k",
        "k",
        "config",
        "k",
        "MSG",
        "k",
        "config",
        "k",
        "config",
        "k",
        "config",
        "k",
        "k",
        "k",
        "MSG",
        "key",
        "msgdefaults",
        "msgdefaults",
        "key",
        "key",
        "exit",
        "key",
        "exit",
        "ldap_connection",
        "member_of",
        "group_set",
        "recurse",
        "m",
        "member_of",
        "m",
        "decode",
        "ENCODING",
        "group_set",
        "add",
        "grp",
        "recurse",
        "ldap_connection",
        "search",
        "conf",
        "ldap",
        "SCOPE_SUBTREE",
        "grp",
        "ldap_connection",
        "result",
        "result",
        "MAXSEARCH",
        "g",
        "Attributes",
        "len",
        "Attributes",
        "Attributes",
        "get_groups",
        "ldap_connection",
        "mos",
        "group_set",
        "recurse",
        "username",
        "password",
        "checkgrp",
        "time",
        "sleep",
        "conf",
        "ldap",
        "SCOPE_SUBTREE",
        "conf",
        "replace",
        "username",
        "conf",
        "Attrs",
        "append",
        "ldap",
        "initialize",
        "conf",
        "ldapconn",
        "set_option",
        "ldap",
        "OPT_REFERRALS",
        "conf",
        "ca",
        "ldapconn",
        "set_option",
        "ldap",
        "OPT_X_TLS_CACERTFILE",
        "ca",
        "ldapconn",
        "set_option",
        "ldap",
        "OPT_X_TLS_NEWCTX",
        "ldapconn",
        "simple_bind_s",
        "username",
        "Base",
        "password",
        "ldapconn",
        "search",
        "Base",
        "Scope",
        "Filter",
        "Attrs",
        "ldapconn",
        "result",
        "r",
        "MAXSEARCH",
        "user",
        "Attr",
        "conf",
        "decode",
        "ENCODING",
        "checkgrp",
        "get_groups",
        "ldapconn",
        "Attr",
        "grplist",
        "conf",
        "ldapg",
        "conf",
        "ing",
        "ldapg",
        "grplist",
        "checkgrp",
        "ing",
        "e",
        "logging",
        "error",
        "e",
        "myName",
        "authorized",
        "os",
        "path",
        "exists",
        "CONFIG_FILE",
        "CONFIG_FILE",
        "CONFIG_FILE",
        "exit",
        "config",
        "open",
        "get_config_file_name",
        "config_file",
        "json",
        "load",
        "config_file",
        "FileNotFoundError",
        "exit",
        "cmd",
        "cmdlog",
        "logging",
        "info",
        "cmdlog",
        "subprocess",
        "run",
        "cmd",
        "shell",
        "capture_output",
        "logging",
        "info",
        "r",
        "stdout",
        "decode",
        "ENCODING",
        "logging",
        "info",
        "r",
        "stderr",
        "decode",
        "ENCODING",
        "r",
        "returncode",
        "conf",
        "M_FAILED",
        "exit",
        "user",
        "passwd",
        "conf",
        "secrets",
        "token_urlsafe",
        "conf",
        "M_YOUR_PASSWORD",
        "replace",
        "passwd",
        "rcmd",
        "conf",
        "rcmd",
        "replace",
        "user",
        "replace",
        "rcmd",
        "replace",
        "user",
        "replace",
        "passwd",
        "run",
        "cmd",
        "cmdlog",
        "user",
        "gcos",
        "rcmd",
        "conf",
        "rcmd",
        "replace",
        "user",
        "replace",
        "gcos",
        "run",
        "cmd",
        "cmd",
        "conf",
        "M_ACCOUNT_CREATED",
        "replace",
        "user",
        "replace",
        "socket",
        "getfqdn",
        "user",
        "rcmd",
        "conf",
        "rcmd",
        "replace",
        "user",
        "run",
        "cmd",
        "cmd",
        "conf",
        "M_ACCOUNT_REMOVED",
        "len",
        "sys",
        "argv",
        "sys",
        "argv",
        "os",
        "path",
        "dirname",
        "os",
        "path",
        "realpath",
        "sys",
        "argv",
        "load_config",
        "logging",
        "basicConfig",
        "format",
        "level",
        "conf",
        "filename",
        "conf",
        "logging",
        "info",
        "os",
        "getenv",
        "GREEN",
        "conf",
        "M_WELCOME",
        "NO_COLOR",
        "input",
        "getpass",
        "getpass",
        "prompt",
        "config",
        "verify_password",
        "user",
        "passwd",
        "chkgrp",
        "displayname",
        "conf",
        "M_UNKNOWN_PASSWORD",
        "exit",
        "auth",
        "conf",
        "M_UNAUTHORIZED",
        "exit",
        "conf",
        "M_LOGIN_MESSAGE",
        "replace",
        "displayname",
        "os",
        "path",
        "exists",
        "user",
        "conf",
        "M_ACCOUNT_FOUND",
        "conf",
        "M_SELECT_EXIT",
        "conf",
        "M_SELECT_PASSWORD_RESET",
        "conf",
        "M_SELECT_DELETE_ACCOUNT",
        "input",
        "conf",
        "M_PLEASE_SELECT",
        "selection",
        "conf",
        "M_BYE",
        "selection",
        "conf",
        "conf",
        "M_RESET_CONFIRM",
        "set_password",
        "user",
        "passwd",
        "selection",
        "conf",
        "M_DELETE_WARNING",
        "input",
        "conf",
        "M_YESNO",
        "cf",
        "conf",
        "M_YESNO",
        "delete_user",
        "user",
        "conf",
        "M_NOTHING",
        "conf",
        "M_INCORRECT",
        "conf",
        "M_NOACCOUNT",
        "input",
        "conf",
        "M_YESNO",
        "selection",
        "conf",
        "M_YESNO",
        "create_user",
        "user",
        "displayname",
        "set_password",
        "user",
        "passwd",
        "conf",
        "M_ACCOUNT_GENERATION",
        "conf",
        "M_MAYBE_LATER",
        "KeyboardInterrupt",
        "logging",
        "info",
        "conf",
        "M_BREAK",
        "ex",
        "logging",
        "info",
        "ex",
        "args"
    ],
    "literals": [
        "\"config.json\"",
        "\"utf-8\"",
        "'\\033'",
        "'[0;31m'",
        "'[0;32m'",
        "'[0m'",
        "\"messages\"",
        "\".\"",
        "\"welcome\"",
        "\"unknownpassword\"",
        "\"noaccount\"",
        "\"accountfound\"",
        "\"unauthorized\"",
        "\"accountcreated\"",
        "\"yourpassword\"",
        "\"accountremoved\"",
        "\"loginmessage\"",
        "\"selectexit\"",
        "\"passwordreset\"",
        "\"deleteaccount\"",
        "\"pleaseselect\"",
        "\"bye\"",
        "\"reset_confirm\"",
        "\"delete_warning\"",
        "\"yesno\"",
        "\"account_generation\"",
        "\"maybe_later\"",
        "\"break\"",
        "\"nothing\"",
        "\"incorrect\"",
        "\"failed\"",
        "\"\\n\\nAccount Registration\\n\"",
        "\"Please login with your company account.\\n\"",
        "\"invalid user or password, please retry\"",
        "\"You do not have an account here yet\\ncreate one?\"",
        "\"You already have an account\\n\"",
        "\"Your account is valid but you are not authorized!\"",
        "\"You can now connect here with: ssh $1@$2\\n\"",
        "\"Have fun!\"",
        "\"Your generated password is: $1\\n\"",
        "\"Please remeber the password, I won't tell you twice\"",
        "\"Your account has been removed\"",
        "\"\\nWelcome $1\\n\"",
        "\"exit\"",
        "\"reset your password\"",
        "\"delete your account\"",
        "\"please select\"",
        "\"bye\"",
        "\"Your password has been reset\"",
        "\"Delete your account\\n\"",
        "\"This will delete all your files! proceed?\"",
        "\"yes/no\"",
        "\"generating your account\"",
        "\"ok, maybe later\"",
        "\"session terminated\"",
        "\"Nothing done, your account is still there.\"",
        "\"Incorrect selection!\"",
        "\"Sorry, something went wrong. Please contact the admins\"",
        "\".\"",
        "\"config parameter missing: \"",
        "\"config parameter missing: \"",
        "\"config key missing: \"",
        "\"ldap.root\"",
        "\"(&(objectClass=group)(distinguishedName=\"",
        "\"))\"",
        "\"memberOf\"",
        "\"memberOf\"",
        "\"ldap.base\"",
        "\"ldap.filter\"",
        "\"$1\"",
        "\"ldap.displayName\"",
        "\"memberOf\"",
        "\"ldap.host\"",
        "\"ldap.cacert\"",
        "\"\"",
        "\"\"",
        "\"cn=\"",
        "\",\"",
        "\"ldap.displayName\"",
        "\"memberOf\"",
        "\"authorize.recurse\"",
        "\"authorize.member\"",
        "\"Configfile does not exist: \"",
        "\"Config file not found\"",
        "\"execute: \"",
        "\"stdout: \"",
        "\"stderr: \"",
        "\"commands.Password\"",
        "\"copy\"",
        "\"generate\"",
        "\"$1\"",
        "\"commands.setPassword\"",
        "\"$1\"",
        "\"$2\"",
        "\"*****\"",
        "\"$1\"",
        "\"$2\"",
        "\"commands.createUser\"",
        "\"$1\"",
        "\"$2\"",
        "\"$1\"",
        "\"$2\"",
        "\"commands.deleteUser\"",
        "\"$1\"",
        "'__main__'",
        "\"/config.json\"",
        "'%(asctime)s: %(levelname)s: %(message)s'",
        "\"logging.level\"",
        "\"logging.file\"",
        "\"\"",
        "\"New connection: \"",
        "\"SSH_CONNECTION\"",
        "\"UNKNOWN\"",
        "\"Username: \"",
        "'Password: '",
        "\"authorize\"",
        "\"$1\"",
        "\"/home/\"",
        "\"0: \"",
        "\"1: \"",
        "\"2: \"",
        "\": \"",
        "\"0\"",
        "\"1\"",
        "\"commands.Password\"",
        "\"copy\"",
        "\"copy\"",
        "\"2\"",
        "\": \"",
        "\": \""
    ],
    "variables": [
        "CONFIG_FILE",
        "ENCODING",
        "MAXSEARCH",
        "ESC",
        "RED",
        "GREEN",
        "NO_COLOR",
        "MSG",
        "M",
        "M_WELCOME",
        "M_UNKNOWN_PASSWORD",
        "M_NOACCOUNT",
        "M_ACCOUNT_FOUND",
        "M_UNAUTHORIZED",
        "M_ACCOUNT_CREATED",
        "M_YOUR_PASSWORD",
        "M_ACCOUNT_REMOVED",
        "M_LOGIN_MESSAGE",
        "M_SELECT_EXIT",
        "M_SELECT_PASSWORD_RESET",
        "M_SELECT_DELETE_ACCOUNT",
        "M_PLEASE_SELECT",
        "M_BYE",
        "M_RESET_CONFIRM",
        "M_DELETE_WARNING",
        "M_YESNO",
        "M_ACCOUNT_GENERATION",
        "M_MAYBE_LATER",
        "M_BREAK",
        "M_NOTHING",
        "M_INCORRECT",
        "M_FAILED",
        "msgdefaults",
        "k",
        "grp",
        "result",
        "_",
        "g",
        "_",
        "Attributes",
        "mos",
        "Base",
        "Scope",
        "Filter",
        "Attrs",
        "ldapconn",
        "ldapconn",
        "protocol_version",
        "ca",
        "r",
        "_",
        "user",
        "_",
        "Attr",
        "myName",
        "grplist",
        "ing",
        "ing",
        "authorized",
        "myName",
        "authorized",
        "config",
        "r",
        "passwd",
        "cmdlog",
        "cmd",
        "cmd",
        "cmd",
        "CONFIG_FILE",
        "CONFIG_FILE",
        "user",
        "passwd",
        "chkgrp",
        "displayname",
        "auth",
        "selection",
        "cf",
        "selection"
    ],
    "comments": [
        "!/usr/bin/python3.8",
        "=============================================================================",
        "",
        "register.py",
        "Version 1.0",
        "",
        "Linux self service account creation",
        "",
        "Valid users are checked agains LDAP",
        "",
        "S. Traub, THU 2022",
        "",
        "=============================================================================",
        "-----------------------------------------------------------------------------",
        "-----------------------------------------------------------------------------",
        "dot replaces subobject from config file",
        "we handle one and two levels",
        "in case there is no subobject",
        "return the value",
        "or the default",
        "otherwise we must terminate because the parameter is required",
        "now handle sub objects",
        "first check config and for messages \"msgdefaults\"",
        "otherwise we must terminate",
        "because the parameter is required",
        "otherwise we must terminate because the section is required",
        "-----------------------------------------------------------------------------",
        "check all users groups",
        "decode it",
        "add it to the group set",
        "if recurse is required, we must now search the members of this group",
        "do the LDAP group search",
        "we only expect one result",
        "if the list is not empty, we must recurse",
        "-----------------------------------------------------------------------------",
        "to make brute force more difficult",
        "setup the LDAP options",
        "connect to server and search",
        "check for CA certificate, if none -> use system default",
        "get the result",
        "create an empty group list",
        "if we mut authorize, get the users groups",
        "the user is authorized if there is an empty \"authorize\" section or",
        "one of the ldap groups matches",
        "-----------------------------------------------------------------------------",
        "check if the file exists",
        "-----------------------------------------------------------------------------",
        "open the file",
        "and parse it",
        "-----------------------------------------------------------------------------",
        "log the command",
        "run the process",
        "log stdout",
        "log stderr",
        "-----------------------------------------------------------------------------",
        "execute all commands from config file",
        "-----------------------------------------------------------------------------",
        "read all command from config file",
        "-----------------------------------------------------------------------------",
        "execute all commands from config file",
        "-----------------------------------------------------------------------------",
        "the first argument, if any, is the config file",
        "the default config file is in the script direcory",
        "load the config",
        "setup logging",
        "print the welcome message",
        "get the username and password",
        "the input is truncated for security reasons",
        "mow search the user in LDAP",
        "if not found, display an errormessage",
        "if the user is not authorized, inform the user",
        "print the welcome message",
        "check if the user exists by checking the home directory",
        "i know, we should check passwd as well, but it's ok for now",
        "the user already exists",
        "this is what the user can do now",
        "read the selection",
        "the user does not exist",
        "read yes or no",
        "if yes, generate the account and set the password"
    ],
    "docstrings": [
        "\"\"\" return configuration from config file \"\"\"",
        "\"\"\" get the LDAP groups the user is member of, possible recursive\"\"\"",
        "\"\"\" Verify the users account and password using LDAP \"\"\"",
        "\"\"\" Get the name of config file \"\"\"",
        "\"\"\" load the config file \"\"\"",
        "\"\"\" run an os command and capture stdin and stderr \"\"\"",
        "\"\"\" set the users password \"\"\"",
        "\"\"\" create the user account \"\"\"",
        "\"\"\" delete the user account \"\"\""
    ],
    "functions": [
        "conf",
        "get_groups",
        "verify_password",
        "get_config_file_name",
        "load_config",
        "run",
        "set_password",
        "create_user",
        "delete_user"
    ],
    "classes": []
}