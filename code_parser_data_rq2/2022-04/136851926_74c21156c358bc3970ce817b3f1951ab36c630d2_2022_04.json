{
    "identifiers": [
        "today",
        "today",
        "today",
        "dd",
        "dd",
        "dd",
        "mm",
        "mm",
        "mm",
        "courseId",
        "getCourseId",
        "today",
        "yyyy",
        "mm",
        "dd",
        "addSubmissionUploadButton",
        "getUserSubmissionInfo",
        "courseId",
        "a",
        "a",
        "textArray",
        "fileName",
        "Blob",
        "textArray",
        "blob",
        "a",
        "url",
        "a",
        "fileName",
        "a",
        "url",
        "$",
        "$",
        "$",
        "showCommentImportForm",
        "i",
        "ajaxPool",
        "i",
        "ajaxPool",
        "i",
        "ajaxPool",
        "ajaxPool",
        "$",
        "jqXHR",
        "ajaxPool",
        "jqXHR",
        "jqXHR",
        "ajaxPool",
        "jqXHR",
        "i",
        "ajaxPool",
        "i",
        "e",
        "linkTxt",
        "linkTxt",
        "linkTxt",
        "i",
        "links",
        "i",
        "nextRegEx",
        "links",
        "i",
        "matches",
        "url",
        "matches",
        "url",
        "pending",
        "fetched",
        "aborted",
        "setupPool",
        "pending",
        "assignmentId",
        "getAssignmentId",
        "$",
        "$",
        "debug",
        "courseId",
        "assignmentId",
        "showUploadCommentForm",
        "debug",
        "courseRegex",
        "matches",
        "courseId",
        "matches",
        "e",
        "errorHandler",
        "e",
        "courseId",
        "assignmentRegex",
        "matches",
        "assignmentId",
        "matches",
        "e",
        "errorHandler",
        "e",
        "assignmentId",
        "courseId",
        "debug",
        "pending",
        "url",
        "courseId",
        "getStudents",
        "url",
        "courseId",
        "text",
        "$",
        "text",
        "$",
        "url",
        "courseId",
        "pending",
        "$",
        "url",
        "udata",
        "status",
        "jqXHR",
        "url",
        "nextURL",
        "jqXHR",
        "i",
        "udata",
        "i",
        "udata",
        "i",
        "debug",
        "section",
        "j",
        "section",
        "j",
        "section",
        "j",
        "user",
        "user",
        "splitname",
        "user",
        "splitname",
        "userData",
        "user",
        "user",
        "userDataUserId",
        "user",
        "user",
        "upiDataUserId",
        "user",
        "user",
        "studentIdArray",
        "user",
        "userIdArray",
        "user",
        "upiArray",
        "user",
        "e",
        "debug",
        "debug",
        "debug",
        "url",
        "url",
        "getStudents",
        "url",
        "courseId",
        "pending",
        "debug",
        "pending",
        "pending",
        "pending",
        "$",
        "e",
        "pending",
        "$",
        "text",
        "callback",
        "$",
        "text",
        "$",
        "$",
        "callback",
        "$",
        "callback",
        "$",
        "tmpUrl",
        "score",
        "comment",
        "student",
        "subUrl",
        "debug",
        "tmpUrl",
        "score",
        "comment",
        "score",
        "parseInt",
        "score",
        "$",
        "tmpUrl",
        "udata",
        "status",
        "jqXHR",
        "debug",
        "udata",
        "debug",
        "udata",
        "udata",
        "udata",
        "tmpScore",
        "parseInt",
        "score",
        "tmpToAdd",
        "udata",
        "debug",
        "submissionComments",
        "submissionComments",
        "i",
        "submissionComments",
        "i",
        "submissionComments",
        "i",
        "comment",
        "tmpToAdd",
        "comment",
        "tmpToAdd",
        "tmpToAdd",
        "debug",
        "pending",
        "debug",
        "tmpToAdd",
        "requests",
        "subUrl",
        "comment",
        "score",
        "student",
        "assignmentId",
        "subUrl",
        "debug",
        "requests",
        "pending",
        "debug",
        "doUpdate",
        "tmpToAdd",
        "pending",
        "pending",
        "debug",
        "$",
        "doUpdate",
        "debug",
        "jQuery",
        "$",
        "evt",
        "$",
        "Papa",
        "evt",
        "h",
        "h",
        "results",
        "$",
        "results",
        "debug",
        "data",
        "popUp",
        "referral",
        "$",
        "data",
        "debug",
        "tmpKeys",
        "tmpKeys",
        "tmpKeys",
        "popUp",
        "referral",
        "$",
        "tmpKeys",
        "popUp",
        "referral",
        "$",
        "tmpKeys",
        "popUp",
        "referral",
        "$",
        "data",
        "popUp",
        "referral",
        "$",
        "data",
        "pending",
        "popUp",
        "row",
        "data",
        "debug",
        "tmpKeys",
        "userIdArray",
        "row",
        "student",
        "row",
        "tmpKeys",
        "upiArray",
        "row",
        "tmpUpi",
        "row",
        "tmpKeys",
        "studentIdArray",
        "row",
        "tmpSISid",
        "row",
        "tmpKeys",
        "upiArray",
        "row",
        "tmpUpi",
        "row",
        "comment",
        "row",
        "score",
        "row",
        "score",
        "score",
        "comment",
        "debug",
        "student",
        "score",
        "comment",
        "student",
        "courseId",
        "assignmentId",
        "student",
        "courseId",
        "assignmentId",
        "student",
        "pending",
        "compareSubmission",
        "checkSubmissionUrl",
        "score",
        "comment",
        "student",
        "subUrl",
        "debug",
        "requests",
        "confirm",
        "requests",
        "confirmed",
        "confirmed",
        "debug",
        "i",
        "request",
        "requests",
        "i",
        "i",
        "chunkSize",
        "$",
        "request",
        "jqXHR",
        "textStatus",
        "errorThrown",
        "errors",
        "request",
        "jqXHR",
        "errorThrown",
        "requestSent",
        "showProgress",
        "i",
        "requests",
        "i",
        "chunkSize",
        "requests",
        "setTimeout",
        "sendChunk",
        "i",
        "chunkSize",
        "completed",
        "completed",
        "requests",
        "showProgress",
        "$",
        "errors",
        "popUp",
        "errors",
        "saveText",
        "errors",
        "popUp",
        "resetData",
        "sendChunk",
        "$",
        "resetData",
        "alert",
        "amount",
        "amount",
        "$",
        "$",
        "amount",
        "$",
        "studentsFromExcel",
        "jQuery",
        "jQuery",
        "numbStudents",
        "numbStudents",
        "i",
        "studentsFromExcel",
        "i",
        "tmpId",
        "i",
        "tmpName",
        "studentsFromExcel",
        "i",
        "progressHtml",
        "tmpId",
        "tmpId",
        "tmpName",
        "tmpId",
        "jQuery",
        "progressHtml",
        "userData",
        "userDataUserId",
        "upiDataUserId",
        "studentIdArray",
        "userIdArray",
        "upiArray",
        "pending",
        "fetched",
        "needsFetched",
        "e",
        "$",
        "e",
        "e"
    ],
    "literals": [
        "'use strict'",
        "'^([0-9]+) student'",
        "'0'",
        "'0'",
        "'-'",
        "'-'",
        "'-'",
        "\"a\"",
        "\"display: none\"",
        "\"text\"",
        "'#assignment-commentImport'",
        "'#sidebar_content'",
        "<span><a href=\"javascript:void(0)\" id=\"assignment-commentImport\" class=\"ui-corner-all\" role=\"menuitem\">\n                <i class=\"icon-analytics\"></i> Bulk upload score and comment</a>\n            </span>\n            <form id=\"custom_upload_submissions_form\" style=\"margin-top: 10px; display: none;\" enctype=\"multipart/form-data\" onsubmit=\"return false\">\n                <div style=\"padding-top:10px\">\n                    <label for=\"comments_file\">Import comments file: <a href=\"https://flexiblelearning.auckland.ac.nz/temp/gradecommentsample.csv\" download title=\"with at least 3 columns 'Score', 'Comment' and an identifier column of either ID/UPI/SIS USER ID\">sample csv file</a>\n                    \n                    </label>\n                    <input class=\"btn\" type=\"file\" id=\"comments_file\"/>\n                </div>\n                <!--div>\n                    <button id=\"step4Submit\" type=\"submit\" class=\"btn\">Proceed to import</button> <br><br>\n                </div-->\n            </form>\n            <div id=\"comments_modal\" title=\"Import Comments\"></div>\n            <div id=\"comments_dialog\" title=\"Import Comments\"></div>\n            <div id=\"comments_progress\" title=\"Import Comments\" style=\"display:none;\"><p>Importing scores and comments. Do not navigate from this page.</p><div id=\"comments_bar\"></div></div>",
        "'#assignment-commentImport'",
        "'click'",
        "'beforeSend'",
        "'complete'",
        "'Error configuring AJAX pool'",
        "','",
        "'^<(.*)>; rel=\"next\"$'",
        "\"#comments_dialog\"",
        "\"#comments_progress\"",
        "\"in getCourseId: window.location\"",
        "'/courses/([0-9]+)'",
        "'Unable to detect Course ID'",
        "'/assignments/([0-9]+)'",
        "'Unable to detect Assignment ID'",
        "'in getUsers'",
        "'/api/v1/courses/'",
        "'/sections?include[]=students&include[]=email&per_page=100'",
        "\"#comments_dialog\"",
        "<p>${text}</p>",
        "\"#comments_dialog\"",
        "'open'",
        "'Link'",
        "','",
        "''",
        "''",
        "''",
        "''",
        "''",
        "''",
        "\"next url ?\"",
        "\"pending:\"",
        "'#jj_progress_dialog'",
        "'close'",
        "'Failed to load list of students'",
        "'#jj_progress_dialog'",
        "'close'",
        "'Failed to load list of students'",
        "\"#comments_modal\"",
        "<p>${text}</p>",
        "\"#comments_modal\"",
        "\"Confirm\"",
        "\"close\"",
        "\"Cancel\"",
        "\"close\"",
        "\"#comments_modal\"",
        "'open'",
        "\"compareSubmission:\"",
        "\"graded at:\"",
        "\"score:\"",
        "\"submission comment length:\"",
        "\"\"",
        "\"graded at: empty\"",
        "\"PUT\"",
        "\"comment[text_comment]\"",
        "\"submission[posted_grade]\"",
        "\"json\"",
        "Failed to post comment for student ${student} and assignment ${assignmentId} using endpoint ${subUrl}. Response:",
        "\"do update\"",
        "\"do update\"",
        "\"#comments_dialog\"",
        "'open'",
        "'in showUploadCommentForm'",
        "'#custom_upload_submissions_form'",
        "'#comments_file'",
        "\"#comments_file\"",
        "\"#comments_file\"",
        "''",
        "' Visit <a href=\"https://oit.colorado.edu/services/teaching-learning-applications/canvas/enhancements-integrations/enhancements#oit\" target=\"_blank\">Canvas - Enhancements</a> for formatting guidelines.'",
        "\"ERROR: File should contain a header row and at least one data row.\"",
        "\"#comments_file\"",
        "\"id\"",
        "\"sis user id\"",
        "\"upi\"",
        "\"ERROR: No 'SIS User ID' or 'ID' or 'UPI' column found.\"",
        "\"#comments_file\"",
        "\"score\"",
        "\"ERROR: No 'score' column found.\"",
        "\"#comments_file\"",
        "\"comment\"",
        "\"ERROR: No 'comment' column found.\"",
        "\"#comments_file\"",
        "\"ERROR: Header row should have 3 columns( 1: 'ID' or 'SIS User ID' or 'UPI' column, 2:'Score', 3: 'comment'  )\"",
        "\"#comments_file\"",
        "\"<img src='https://flexiblelearning.auckland.ac.nz/images/spinner.gif'/> Determing what records need to be updated ...\"",
        "''",
        "''",
        "''",
        "''",
        "'id'",
        "''",
        "\"id\"",
        "''",
        "\"id\"",
        "'upi'",
        "''",
        "\"upi\"",
        "''",
        "\"upi\"",
        "'sis user id'",
        "''",
        "\"sis user id\"",
        "''",
        "\"sis user id\"",
        "'sis login id'",
        "''",
        "\"sis login id\"",
        "''",
        "\"sis login id\"",
        "'comment'",
        "'score'",
        "\"\"",
        "\"\"",
        "\"\"",
        "/api/v1/courses/${courseId}/assignments/${assignmentId}/submissions/${student}?include[]=submission_comments",
        "/api/v1/courses/${courseId}/assignments/${assignmentId}/submissions/${student}",
        "'now doing update score call'",
        "You are about to post ${requests.length} new score and comments.  Are you sure you wish to proceed?",
        "\"confirmed\"",
        "${request.error}${jqXHR.status} - ${errorThrown}\\n",
        "\"#comments_file\"",
        "Import complete. WARNING: ${errors.length} comments failed to import. See errors.txt for details.",
        "\"errors.txt\"",
        "\"All comments imported successfully!\"",
        "\"#comments_file\"",
        "'All old record. Nothing to do!'",
        "\"#comments_progress\"",
        "\"close\"",
        "\"#comments_bar\"",
        "\"#comments_progress\"",
        "\"open\"",
        "'#myProgress'",
        "<h3 id=\"progressStatus\" class=\"Button Button--warning\">Please don't close this tab until the upload process finished  <img src=\"https://flexiblelearning.auckland.ac.nz/images/spinner.gif\"/></h3>",
        "'#myProgress'",
        "<br><label for='uploadProgress'><b>Progress:</b> &nbsp;</label>\n    <progress id='uploadProgress' max=\"${numbStudents}\" value=\"1\"></progress>\n    <span id=\"numFinished\" style=\"\"></span> / ${numbStudents} <br>",
        "'progress'",
        "<span class=\"progressStudent\" id=\"container${tmpId}\">\n            <label for=\"${tmpId}\">${tmpName}: &nbsp;&nbsp;</label>\n            <progress id=\"${tmpId}\" max=\"100\" value=\"0\"> </progress></span><br>",
        "'#myProgress'",
        "'#override'",
        "''",
        "': '",
        "\"Upload process still going. Are you sure you want to exit?\""
    ],
    "variables": [
        "studentRegex",
        "pending",
        "fetched",
        "needsFetched",
        "ajaxPool",
        "userData",
        "userDataUserId",
        "upiDataUserId",
        "studentIdArray",
        "userIdArray",
        "upiArray",
        "fileEntries",
        "fileNameArray",
        "courseId",
        "assignmentId",
        "sections",
        "debug",
        "debugCheckStudents",
        "submissionAr",
        "aborted",
        "today",
        "dd",
        "mm",
        "yyyy",
        "uploadType",
        "targetI",
        "doing",
        "useUserId",
        "tmpToAdd",
        "doneChecking",
        "excelExist",
        "zipExist",
        "studentsFromExcel",
        "requests",
        "saveText",
        "a",
        "blob",
        "url",
        "i",
        "i",
        "url",
        "links",
        "nextRegEx",
        "i",
        "matches",
        "courseId",
        "courseRegex",
        "matches",
        "assignmentId",
        "assignmentRegex",
        "matches",
        "chunkSize",
        "chunk",
        "url",
        "i",
        "i",
        "section",
        "j",
        "user",
        "splitname",
        "tmpToAdd",
        "tmpSubmission",
        "udata",
        "tmpScore",
        "submissionComments",
        "i",
        "studentInfo",
        "data",
        "referral",
        "tmpKeys",
        "dataLength",
        "student",
        "tmpUpi",
        "tmpSISid",
        "comment",
        "score",
        "checkSubmissionUrl",
        "subUrl",
        "errors",
        "completed",
        "chunkSize",
        "tmpId",
        "tmpName",
        "progressHtml",
        "numbStudents",
        "i"
    ],
    "comments": [
        "==UserScript==",
        "@name        Canvas assignment score,comment import script",
        "@author      WenChen Hol",
        "@namespace   https://github.com/clearnz/canvas-report-tools/",
        "@description Canvas assignment bulk upload script",
        "@downloadURL https://github.com/clearnz/canvas-report-tools/raw/master/assignment-comment-import.user.js",
        "@include     https://*/courses/*/assignments/*",
        "@require     https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js",
        "@require     https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js",
        "@require     https://flexiblelearning.auckland.ac.nz/javascript/filesaver.js",
        "@require      https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js",
        "@version     0.1",
        "@grant       none",
        "==/UserScript==",
        "Change studentRegex for international support",
        "build requests",
        "progressbar();",
        "courseId = getCourseId();",
        "identifies course ID from URL",
        "identifies course ID from URL",
        "var n = userList.length;",
        "cycles through the student list",
        "login_id === upi",
        "userData[user.id] = user;",
        "sis_user_id ==> auid",
        "end for",
        "end if length>0",
        "if (debug) console.log( \"number ss:\", studentIdAr.length );",
        "showUploadCommentForm( );",
        "if no previous comment, but with comment to input",
        "data: formData,",
        "contentType: false,",
        "processData: false,",
        "to include submission[posted_grade]: score, for the import",
        "dataType: \"text\"",
        "return tmpToAdd;",
        "return 1;",
        "studentInfo to record student name/Auid/fileName",
        "read student file name information from the excel file",
        "parse CSV",
        "tmpKeys = tmpKeys.map(element => {",
        "return element.toLowerCase();",
        "});",
        "if ( !Object.keys(data[0]).includes(\"ID\") || !Object.keys(data[0]).includes(\"SIS User ID\")|| !Object.keys(data[0]).includes(\"UPI\") ) {",
        "to get student id, as teacher could use 'upi' or 'sis user id' as first field",
        "to check if record is the same, then no action required",
        "end for",
        "end papa parse",
        "end comment_file change",
        "confirm before proceeding",
        "send requests in chunks of 3 every second to avoid rate-limiting",
        "when each request finishes...",
        "all finished",
        "actually starts the recursion",
        "confirmation was dismissed",
        "end doUpdate",
        "if ( useUserId ){",
        "use canvas user_id",
        "}"
    ],
    "docstrings": [],
    "functions": [
        "addSubmissionUploadButton",
        "abortAll",
        "setupPool",
        "nextURL",
        "showCommentImportForm",
        "getCourseId",
        "getAssignmentId",
        "getUserSubmissionInfo",
        "popUp",
        "getStudents",
        "confirm",
        "compareSubmission",
        "showUploadCommentForm",
        "doUpdate",
        "sendChunk",
        "requestSent",
        "showProgress",
        "displayStudentProgressList",
        "resetData",
        "errorHandler",
        "confirmExit"
    ],
    "classes": []
}