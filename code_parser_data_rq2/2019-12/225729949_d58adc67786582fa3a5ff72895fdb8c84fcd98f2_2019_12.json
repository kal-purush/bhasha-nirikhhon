{
    "identifiers": [
        "pyspark",
        "sql",
        "SparkSession",
        "pyspark",
        "SparkContext",
        "numpy",
        "np",
        "sys",
        "pyspark",
        "sql",
        "functions",
        "col",
        "expr",
        "when",
        "pyspark",
        "sql",
        "functions",
        "countDistinct",
        "pyspark",
        "ml",
        "feature",
        "OneHotEncoderEstimator",
        "StringIndexer",
        "VectorAssembler",
        "pyspark",
        "ml",
        "Pipeline",
        "pyspark",
        "sql",
        "functions",
        "F",
        "SparkContext",
        "SparkSession",
        "builder",
        "appName",
        "getOrCreate",
        "spark",
        "read",
        "csv",
        "header",
        "inferSchema",
        "df",
        "select",
        "required_features",
        "df_req",
        "dropna",
        "df_req_clean",
        "withColumn",
        "when",
        "col",
        "when",
        "col",
        "data",
        "agg",
        "countDistinct",
        "data",
        "ARRIVAL_DELAY",
        "alias",
        "collect",
        "categoricalCol",
        "categoricalColumns",
        "StringIndexer",
        "inputCol",
        "categoricalCol",
        "outputCol",
        "categoricalCol",
        "OneHotEncoderEstimator",
        "inputCols",
        "stringIndexer",
        "getOutputCol",
        "outputCols",
        "categoricalCol",
        "stages",
        "stringIndexer",
        "encoder",
        "StringIndexer",
        "inputCol",
        "outputCol",
        "stages",
        "label_stringIdx",
        "c",
        "c",
        "categoricalColumns",
        "numericCols",
        "VectorAssembler",
        "inputCols",
        "assemblerInputs",
        "outputCol",
        "stages",
        "assembler",
        "Pipeline",
        "stages",
        "stages",
        "pipeline",
        "fit",
        "data",
        "pipelineModel",
        "transform",
        "data",
        "data",
        "select",
        "selectedCols",
        "data",
        "withColumn",
        "F",
        "monotonically_increasing_id",
        "data",
        "randomSplit",
        "train",
        "select",
        "rdd",
        "x",
        "np",
        "array",
        "x",
        "a",
        "a",
        "np",
        "array",
        "a",
        "test",
        "select",
        "rdd",
        "x",
        "np",
        "array",
        "x",
        "a",
        "a",
        "np",
        "array",
        "a",
        "train",
        "select",
        "rdd",
        "x",
        "np",
        "array",
        "x",
        "a",
        "a",
        "a",
        "test",
        "select",
        "rdd",
        "x",
        "np",
        "array",
        "x",
        "a",
        "a",
        "a",
        "train_X_rdd",
        "join",
        "train_Y_rdd",
        "test_X_rdd",
        "join",
        "test_Y_rdd",
        "x_y",
        "np",
        "dot",
        "x_y",
        "weights",
        "bias",
        "np",
        "exp",
        "linear_model",
        "np",
        "dot",
        "x_y",
        "y_pred",
        "x_y",
        "dw_comp",
        "x_y",
        "np",
        "dot",
        "x_y",
        "weights",
        "bias",
        "np",
        "exp",
        "linear_model",
        "y_pred",
        "x_y",
        "db_comp",
        "train_X_rdd",
        "persist",
        "train_Y_rdd",
        "persist",
        "len",
        "train_X_rdd",
        "collect",
        "train_X_rdd",
        "count",
        "np",
        "zeros",
        "train_features",
        "i",
        "train_xy",
        "x",
        "fun_weights",
        "x",
        "reduceByKey",
        "x",
        "y",
        "x",
        "y",
        "x",
        "x",
        "train_samples",
        "train_xy",
        "x",
        "fun_bias",
        "x",
        "reduceByKey",
        "x",
        "y",
        "x",
        "y",
        "x",
        "x",
        "train_samples",
        "weights",
        "lr",
        "dw",
        "collect",
        "bias",
        "lr",
        "db",
        "collect",
        "test_X_rdd",
        "persist",
        "test_Y_rdd",
        "persist",
        "x_y",
        "np",
        "dot",
        "x_y",
        "weights",
        "bias",
        "np",
        "exp",
        "linear_model",
        "y_pred",
        "test_xy",
        "x",
        "x",
        "predictions",
        "x",
        "test_Y_rdd",
        "join",
        "pred",
        "comparison_rdd",
        "saveAsTextFile",
        "sys",
        "argv",
        "comparison_rdd",
        "c",
        "c",
        "collect",
        "i",
        "len",
        "y_true_pred",
        "test",
        "append",
        "y_true_pred",
        "i",
        "pred",
        "append",
        "y_true_pred",
        "i",
        "pred",
        "test",
        "i",
        "len",
        "test",
        "test",
        "i",
        "pred",
        "i",
        "conf_matrix",
        "test",
        "i",
        "pred",
        "i",
        "conf_matrix",
        "test",
        "i",
        "pred",
        "i",
        "conf_matrix",
        "test",
        "i",
        "pred",
        "i",
        "conf_matrix",
        "conf_matrix",
        "pred",
        "test",
        "matrix",
        "matrix",
        "matrix",
        "matrix",
        "matrix",
        "matrix",
        "matrix",
        "accuracy",
        "pred",
        "test",
        "matrix",
        "matrix",
        "matrix",
        "matrix",
        "precision",
        "pred",
        "test",
        "matrix",
        "matrix",
        "matrix",
        "matrix",
        "recall",
        "pred",
        "test",
        "matrix",
        "get_precision",
        "pred",
        "test",
        "matrix",
        "get_recall",
        "pred",
        "test",
        "matrix",
        "precision",
        "recall",
        "precision",
        "recall",
        "f1_measure",
        "conf_matrix",
        "pred",
        "test",
        "matrix",
        "get_accuracy",
        "pred",
        "test",
        "matrix",
        "get_precision",
        "pred",
        "test",
        "matrix",
        "get_recall",
        "pred",
        "test",
        "matrix",
        "get_f1_measure",
        "pred",
        "test",
        "matrix",
        "data",
        "randomSplit",
        "pyspark",
        "ml",
        "classification",
        "LogisticRegression",
        "LogisticRegression",
        "featuresCol",
        "labelCol",
        "maxIter",
        "lr",
        "fit",
        "train_ML",
        "lrModel",
        "transform",
        "test_ML",
        "pyspark",
        "ml",
        "classification",
        "RandomForestClassifier",
        "RandomForestClassifier",
        "labelCol",
        "featuresCol",
        "numTrees",
        "maxDepth",
        "rf",
        "fit",
        "train_ML",
        "rfModel",
        "transform",
        "test_ML",
        "pyspark",
        "mllib",
        "evaluation",
        "MulticlassMetrics",
        "predictions",
        "select",
        "results",
        "rdd",
        "MulticlassMetrics",
        "predictionAndLabels",
        "metrics",
        "confusionMatrix",
        "toArray",
        "cm",
        "cm",
        "cm",
        "sum",
        "cm",
        "cm",
        "cm",
        "cm",
        "cm",
        "cm",
        "precision",
        "recall",
        "precision",
        "recall",
        "accuracy",
        "precision",
        "recall",
        "f1Score",
        "predictionsrf",
        "select",
        "results_rf",
        "rdd",
        "MulticlassMetrics",
        "predictionAndLabels_rf",
        "metrics",
        "confusionMatrix",
        "toArray",
        "cm",
        "cm",
        "cm",
        "sum",
        "cm",
        "cm",
        "cm",
        "cm",
        "cm",
        "cm",
        "precision",
        "recall",
        "precision",
        "recall",
        "accuracy",
        "precision",
        "recall",
        "f1Score",
        "train_X_rdd",
        "unpersist",
        "train_Y_rdd",
        "unpersist",
        "test_X_rdd",
        "unpersist",
        "test_Y_rdd",
        "unpersist",
        "sc",
        "stop"
    ],
    "literals": [
        "'Flight-Delay'",
        "'raw_sample.csv'",
        "'MONTH'",
        "'DAY_OF_WEEK'",
        "'AIRLINE'",
        "'ORIGIN_AIRPORT'",
        "'DESTINATION_AIRPORT'",
        "'SCHEDULED_DEPARTURE'",
        "'DEPARTURE_TIME'",
        "'DEPARTURE_DELAY'",
        "'TAXI_OUT'",
        "'WHEELS_OFF'",
        "'SCHEDULED_TIME'",
        "'ELAPSED_TIME'",
        "'AIR_TIME'",
        "'WHEELS_ON'",
        "'TAXI_IN'",
        "'DISTANCE'",
        "'SCHEDULED_ARRIVAL'",
        "'ARRIVAL_TIME'",
        "'ARRIVAL_DELAY'",
        "\"ARRIVAL_DELAY\"",
        "\"ARRIVAL_DELAY\"",
        "'YES'",
        "\"ARRIVAL_DELAY\"",
        "'NO'",
        "'c'",
        "'AIRLINE'",
        "'ORIGIN_AIRPORT'",
        "'DESTINATION_AIRPORT'",
        "'Index'",
        "\"classVec\"",
        "'ARRIVAL_DELAY'",
        "'label'",
        "'MONTH'",
        "'DAY_OF_WEEK'",
        "'SCHEDULED_DEPARTURE'",
        "'DEPARTURE_TIME'",
        "'DEPARTURE_DELAY'",
        "'TAXI_OUT'",
        "'WHEELS_OFF'",
        "'SCHEDULED_TIME'",
        "'ELAPSED_TIME'",
        "'AIR_TIME'",
        "'WHEELS_ON'",
        "'TAXI_IN'",
        "'DISTANCE'",
        "'SCHEDULED_ARRIVAL'",
        "'ARRIVAL_TIME'",
        "\"classVec\"",
        "\"features\"",
        "'label'",
        "'features'",
        "\"idx\"",
        "'features'",
        "'idx'",
        "'features'",
        "'idx'",
        "'label'",
        "'idx'",
        "'label'",
        "'idx'",
        "\"key\"",
        "\"key\"",
        "'TP'",
        "'TN'",
        "'FP'",
        "'FN'",
        "'FN'",
        "'TP'",
        "'FP'",
        "'TN'",
        "'TP'",
        "'TN'",
        "'TP'",
        "'TN'",
        "'FN'",
        "'FP'",
        "'TP'",
        "'TP'",
        "'FP'",
        "'TP'",
        "'TP'",
        "'FN'",
        "\"Custom model Stats: Logistic Regression\"",
        "\"-\"",
        "\"Confusion Matrix: \"",
        "\"-\"",
        "\"Accuracy: \"",
        "\"Precision: \"",
        "\"Recall: \"",
        "\"F-measure: \"",
        "'features'",
        "'label'",
        "'label'",
        "'features'",
        "'prediction'",
        "'label'",
        "\"ML LIB model stats: Logistic Regression\"",
        "\"-\"",
        "\"Accuracy = %s\"",
        "\"Precision = %s\"",
        "\"Recall = %s\"",
        "\"F1 Score = %s\"",
        "'prediction'",
        "'label'",
        "\"ML LIB model stats: Random Forest\"",
        "\"-\"",
        "\"Accuracy = %s\"",
        "\"Precision = %s\"",
        "\"Recall = %s\"",
        "\"F1 Score = %s\""
    ],
    "variables": [
        "sc",
        "spark",
        "df",
        "required_features",
        "df_req",
        "df_req_clean",
        "data",
        "categoricalColumns",
        "stages",
        "stringIndexer",
        "encoder",
        "label_stringIdx",
        "numericCols",
        "assemblerInputs",
        "assembler",
        "pipeline",
        "pipelineModel",
        "data",
        "selectedCols",
        "data",
        "data",
        "train",
        "test",
        "train_X_rdd",
        "test_X_rdd",
        "train_Y_rdd",
        "test_Y_rdd",
        "train_xy",
        "test_xy",
        "linear_model",
        "y_pred",
        "dw_comp",
        "linear_model",
        "y_pred",
        "db_comp",
        "train_features",
        "train_samples",
        "weights",
        "bias",
        "lr",
        "dw",
        "db",
        "linear_model",
        "y_pred",
        "pred",
        "comparison_rdd",
        "y_true_pred",
        "test",
        "pred",
        "conf_matrix",
        "accuracy",
        "precision",
        "precision",
        "recall",
        "recall",
        "precision",
        "recall",
        "f1_measure",
        "f1_measure",
        "matrix",
        "train_ML",
        "test_ML",
        "lr",
        "lrModel",
        "predictions",
        "rf",
        "rfModel",
        "predictionsrf",
        "results",
        "predictionAndLabels",
        "metrics",
        "cm",
        "accuracy",
        "precision",
        "recall",
        "f1Score",
        "results_rf",
        "predictionAndLabels_rf",
        "metrics",
        "cm",
        "accuracy",
        "precision",
        "recall",
        "f1Score"
    ],
    "comments": [
        "!/usr/bin/env python",
        "coding: utf-8",
        "### Import necessary libraries",
        "In[1]:",
        "### Create the Spark Context and name the application.",
        "In[2]:",
        "In[3]:",
        "### Read the randomly sampled data file. On AWS this is read as a commandline argument.",
        "- For the sake of this notebook, we have taken only 100 samples. However we have run the algorithm on 100,000 records on AWS.",
        "In[4]:",
        "df = spark.read.csv(sys.argv[1], header = True, inferSchema = True)",
        "### Feature Selection",
        "- We selected the features which have the most impact on the target variable",
        "- Load the data in a pyspark dataframe",
        "- Clean the data by dropping all the null valued rows",
        "- Encode the traget variable with 0 as the flight being on time and 1 as the flight being delayed (+ value)",
        "In[5]:",
        "In[6]:",
        "In[7]:",
        "In[8]:",
        "In[9]:",
        "### Data Pipelining",
        "- A Pipeline is specified as a sequence of stages, and each stage is either a Transformer or an Estimator. These stages are run in order, and the input DataFrame is transformed as it passes through each stage. For Transformer stages, the transform() method is called on the DataFrame. For Estimator stages, the fit() method is called to produce a Transformer (which becomes part of the PipelineModel, or fitted Pipeline), and that Transformer’s transform() method is called on the DataFrame.",
        "In[11]:",
        "In[12]:",
        "In[14]:",
        "In[15]:",
        "In[16]:",
        "selectedCols = ['label', 'features']+required_features",
        "### Create Test and Train sets",
        "- Add an index to each of the input features vector and label pairs.",
        "- Split the dataset randomly into train and test",
        "- Convert the train and test features into a numpy array",
        "- Join the rdds to create an rdd with input vectors and their corressponding labels referenced to a key.",
        "In[17]:",
        "In[18]:",
        "In[19]:",
        "In[20]:",
        "In[21]:",
        "### Logistic Regression model",
        "- We have implemented the Stochastic Gradient Descent version of Logistic Regressio.",
        "- def fun_weights(): This function takes a tuple of input vector and its output label and returns component of the weight to be deducted from the total weights. A summation of all these components is then deducted from the final weight vector.",
        "- def fun_bias(): This function takes a tuple of input vector and it output label and returns a component of the bias that is to be deducted from the total bias. A summation of all these components is then deducted from the final bias value.",
        "In[22]:",
        "Sigmoid function",
        "In[23]:",
        "Sigmoid function",
        "- Persist data RDDs for faster data access.",
        "In[24]:",
        "In[25]:",
        "- Initialize the weights to a zero vector of size train_features. The bias is also initialized to be 0. The learning rate is kept as 0.1. The model is trained for 100 iterations where the weights and bias is updated at every iteration.",
        "In[26]:",
        "In[27]:",
        "- Predictions for the test set.",
        "In[28]:",
        "Sigmoid function",
        "In[29]:",
        "- Compute predictions for the test set and create a comparison RDD with train and test targets to evaluate classification metrics",
        "In[30]:",
        "In[ ]:",
        "In[31]:",
        "In[32]:",
        "### Classification Metrics",
        "In[33]:",
        "In[39]:",
        "### Implementation of ML LIB Classification algorithms",
        "- Logistic Regression",
        "In[34]:",
        "In[35]:",
        "In[36]:",
        "- Random Forest",
        "In[37]:",
        "In[38]:",
        "- Evaluation Metrics",
        "In[40]:",
        "print(\"Confusion matrix =%s\" % metrics.confusionMatrix())",
        "In[41]:",
        "print(\"Confusion matrix =%s\" % metrics.confusionMatrix())",
        "- Unpersist all the RDDs and stop the Spark Context",
        "In[42]:"
    ],
    "docstrings": [],
    "functions": [
        "fun_weights",
        "fun_bias",
        "predictions",
        "conf_matrix",
        "get_accuracy",
        "get_precision",
        "get_recall",
        "get_f1_measure"
    ],
    "classes": []
}