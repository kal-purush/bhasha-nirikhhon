{
    "identifiers": [
        "numpy",
        "np",
        "matplotlib",
        "pyplot",
        "plt",
        "matplotlib",
        "lines",
        "Line2D",
        "audio_dspy",
        "adsp",
        "SchemDraw",
        "SchemDraw",
        "dsp",
        "SchemDraw",
        "elements",
        "e",
        "random",
        "r",
        "scipy",
        "stats",
        "norm",
        "SchemDraw",
        "Drawing",
        "fontsize",
        "color",
        "d",
        "add",
        "e",
        "OPAMP",
        "flip",
        "d",
        "add",
        "e",
        "LINE",
        "d",
        "l",
        "xy",
        "op",
        "in2",
        "d",
        "add",
        "e",
        "RES",
        "d",
        "l",
        "L",
        "label",
        "d",
        "add",
        "e",
        "RES",
        "d",
        "l",
        "L",
        "label",
        "d",
        "add",
        "e",
        "DOT_OPEN",
        "label",
        "d",
        "add",
        "e",
        "DOT",
        "xy",
        "R2",
        "start",
        "d",
        "add",
        "e",
        "CAP",
        "d",
        "l",
        "L",
        "label",
        "d",
        "add",
        "e",
        "GND",
        "d",
        "add",
        "e",
        "DOT",
        "xy",
        "R2",
        "end",
        "d",
        "add",
        "e",
        "LINE",
        "d",
        "l",
        "d",
        "add",
        "e",
        "CAP",
        "d",
        "tox",
        "op",
        "label",
        "d",
        "add",
        "e",
        "LINE",
        "d",
        "toy",
        "op",
        "d",
        "add",
        "e",
        "DOT",
        "d",
        "add",
        "e",
        "LINE",
        "d",
        "l",
        "xy",
        "op",
        "in1",
        "d",
        "add",
        "e",
        "LINE",
        "d",
        "l",
        "d",
        "add",
        "e",
        "DOT",
        "d",
        "add",
        "e",
        "RES",
        "d",
        "l",
        "L",
        "label",
        "d",
        "add",
        "e",
        "GND",
        "d",
        "add",
        "e",
        "RES",
        "xy",
        "vm",
        "start",
        "d",
        "label",
        "tox",
        "op",
        "d",
        "add",
        "e",
        "LINE",
        "d",
        "toy",
        "op",
        "d",
        "add",
        "e",
        "DOT",
        "d",
        "add",
        "e",
        "LINE",
        "d",
        "xy",
        "op",
        "l",
        "d",
        "add",
        "e",
        "DOT_OPEN",
        "label",
        "d",
        "draw",
        "val",
        "tol",
        "tol",
        "val",
        "val",
        "tol",
        "r",
        "gauss",
        "val",
        "stddev",
        "R",
        "C",
        "R1",
        "R2",
        "fs",
        "tol",
        "np",
        "pi",
        "getCompVal",
        "R",
        "tol",
        "getCompVal",
        "C",
        "tol",
        "getCompVal",
        "R2",
        "tol",
        "getCompVal",
        "R1",
        "tol",
        "adsp",
        "design_LPF2",
        "fc",
        "Q",
        "fs",
        "design_SKLPF",
        "fs",
        "adsp",
        "plot_magnitude_response",
        "b",
        "a",
        "fs",
        "fs",
        "plt",
        "ylim",
        "plt",
        "title",
        "n",
        "design_SKLPF",
        "fs",
        "tol",
        "adsp",
        "plot_magnitude_response",
        "b",
        "a",
        "fs",
        "fs",
        "l",
        "set_color",
        "design_SKLPF",
        "fs",
        "adsp",
        "plot_magnitude_response",
        "b",
        "a",
        "fs",
        "fs",
        "la",
        "set_color",
        "la",
        "set_linewidth",
        "Line2D",
        "color",
        "lw",
        "Line2D",
        "color",
        "lw",
        "plt",
        "title",
        "plt",
        "legend",
        "custom_lines",
        "plt",
        "ylim",
        "x",
        "mu",
        "sig",
        "start",
        "end",
        "np",
        "zeros",
        "len",
        "x",
        "np",
        "argwhere",
        "np",
        "logical_and",
        "np",
        "abs",
        "x",
        "mu",
        "end",
        "np",
        "abs",
        "x",
        "mu",
        "start",
        "norm",
        "pdf",
        "x",
        "ind",
        "mu",
        "sig",
        "y",
        "np",
        "arange",
        "R",
        "diff",
        "R",
        "diff",
        "adsp",
        "normalize",
        "trunc_gauss",
        "x",
        "R",
        "R",
        "tol_low",
        "R",
        "tol_high",
        "plt",
        "plot",
        "x",
        "y",
        "plt",
        "xlabel",
        "plt",
        "ylabel",
        "plt",
        "title",
        "val",
        "tol_low",
        "tol_high",
        "tol_high",
        "val",
        "val",
        "np",
        "abs",
        "return_val",
        "val",
        "val",
        "tol_high",
        "np",
        "abs",
        "return_val",
        "val",
        "val",
        "tol_low",
        "r",
        "gauss",
        "val",
        "stddev",
        "return_val",
        "R",
        "C",
        "R1",
        "R2",
        "fs",
        "tol",
        "np",
        "pi",
        "getCompVal2",
        "R",
        "tol",
        "tol",
        "getCompVal2",
        "C",
        "tol",
        "tol",
        "getCompVal2",
        "R2",
        "tol",
        "tol",
        "getCompVal2",
        "R1",
        "tol",
        "tol",
        "adsp",
        "design_LPF2",
        "fc",
        "Q",
        "fs",
        "n",
        "design_SKLPF2",
        "fs",
        "tol",
        "adsp",
        "plot_magnitude_response",
        "b",
        "a",
        "fs",
        "fs",
        "l",
        "set_color",
        "design_SKLPF2",
        "fs",
        "adsp",
        "plot_magnitude_response",
        "b",
        "a",
        "fs",
        "fs",
        "la",
        "set_color",
        "la",
        "set_linewidth",
        "Line2D",
        "color",
        "lw",
        "Line2D",
        "color",
        "lw",
        "plt",
        "title",
        "plt",
        "legend",
        "custom_lines",
        "plt",
        "ylim"
    ],
    "literals": [
        "'white'",
        "'left'",
        "'left'",
        "'R'",
        "'left'",
        "'R'",
        "'Input'",
        "'down'",
        "'C'",
        "'up'",
        "'right'",
        "'C'",
        "'down'",
        "'left'",
        "'down'",
        "'down'",
        "'R1'",
        "'right'",
        "'R2'",
        "'up'",
        "'right'",
        "'Output'",
        "'Sallen-Key LPF'",
        "'cyan'",
        "'cyan'",
        "'Sallen Key LPF with 10% tolerance (Gaussian)'",
        "'Ideal'",
        "r'$\\pm$10%'",
        "'Resistance [Ohms]'",
        "'Probability'",
        "'Probability Distribution of 1 kOhm Resistor with 10% tolerance'",
        "'cyan'",
        "'cyan'",
        "'Sallen Key LPF with 10% tolerance (Trunc. Gaussian)'",
        "'Ideal'",
        "r'$\\pm$10%'"
    ],
    "variables": [
        "L",
        "d",
        "op",
        "R2",
        "R1",
        "vm",
        "stddev",
        "fc",
        "Q",
        "fs",
        "b",
        "a",
        "b",
        "a",
        "l",
        "b",
        "a",
        "la",
        "custom_lines",
        "y",
        "ind",
        "y",
        "ind",
        "R",
        "diff",
        "tol_low",
        "tol_high",
        "x",
        "y",
        "stddev",
        "return_val",
        "return_val",
        "fc",
        "Q",
        "b",
        "a",
        "l",
        "b",
        "a",
        "la",
        "custom_lines"
    ],
    "comments": [
        "%%",
        "%% [markdown]",
        "# Bad Circuit Modelling",
        "",
        "I want to start by addressing something I've heard a few times in the",
        "world of virtual analog modelling for digital audio effects. Let's say",
        "I wanted to make a model of the famous LA-2A optical compressor. So I buy",
        "an actual LA-2A, I take measurements, analyze the circuit diagrams, etc,",
        "and construct a virtual model of the effect. In recent years, modelling",
        "accuracy has reached the point where it is possible to construct a model",
        "that sounds more like my unit than my unit sounds compared to another unit",
        "of the same make.",
        "",
        "In the analog modelling world, this level of precision is often considered",
        "a great success, and without a doubt, achieving that level of precision",
        "is certainly a great feat of engineering, requiring a deep knowledge of",
        "the system being modelled, as well as incredible attention to detail.",
        "However, from an audio perspective, I would consider this result somewhat",
        "of a failure.",
        "",
        "When I buy an LA-2A, I an buying a unique piece of hardware, that sounds",
        "unlike anything else in the world. This uniqueness, particularly when",
        "compounded across the many effects used in a production can give my",
        "sounds an interesting character that is specific to my studio. On the",
        "other hand if I use a software model of an LA-2A, the version on my",
        "computer will sound exactly the same as everyone else's. For some mixing",
        "engineers this uniformity is seen as a good thing: if I go to someone",
        "else's studio and they have the same plugins as I do, I can be assured",
        "they will sound exactly the same as I am accustomed to. That said, in",
        "my experience as a mixing engineer, the variations in hardware effects",
        "can add a ton of positive elements to a mix, including stereo width,",
        "perceptual depth, and once again, a characteristic sound of _my_ studio.",
        "",
        "In this series, I'm planning to explore some of the elements that can",
        "cause variations in analog effects. While I plan to focus mostly on",
        "basic electrical components (resistors, capacitors, etc), similar ideas",
        "can usually be applied to more complex circuit elements, as well as",
        "other analog audio elements including speaker cones, guitar strings,",
        "magnetic tape, and more.",
        "",
        "## Component Tolerances:",
        "",
        "![pic](https://cdn1.byjus.com/wp-content/uploads/2019/07/Resistor-color-codes-Q1.png)",
        "",
        "In this article, we'll be talking about component tolerances, one of the",
        "most fundamental causes of variations in analog circuits. The basic idea",
        "is that no electrical component can be manufactured with perfect",
        "precision. With that in mind, manufacturers label their parts with",
        "a tolerance rating. So if you my a 500 Ohm resistor, the resistor will",
        "also have a tolerance rating, say +/- 5%, or +/- 1%, or something of the",
        "sort. In general, for a more precise overall circuit, it is better to use",
        "parts with lower tolerance ratings, however, such parts are also more",
        "expensive, so circuit designers try to build robust designs that can",
        "handle a little bit of component variation, and will often optimize",
        "their circuit to find a balance between cost and precision.",
        "",
        "## Circuit Analysis",
        "",
        "As an example of this phenomenon, let's analyze and construct a model",
        "of an ideal Sallen-Key second-order lowpass filter.",
        "%%",
        "%% [markdown]",
        "Note that in this idealized model, we will assume that the op-amp",
        "provides perfect, linear gain, as opposed to the more nonlinear",
        "response that might be observed in real life. From this model, we can",
        "can calculate the cutoff frequency and Q value for the filter as",
        "follows:",
        "",
        "$$",
        "f_c = \\frac{1}{2 \\pi R C}",
        "$$",
        "$$",
        "Q = \\frac{1}{2 - \\frac{R_2}{R_1}}",
        "$$",
        "",
        "Now let's design our example filter such that $f_c = 1 \\text{ kHz}$,",
        "and $Q = 2$. In other words, we choose $C = 4.7 \\text{ nF}$,",
        "$R = 33.8 \\text{ kOhms}$, $R_2 = 1.5 \\text{ kOhms}$, and",
        "$R_1 = 1 \\text{ kOhms}$. When we construct a digital model of this filter",
        "we obtain the following frequency response.",
        "%%",
        "%% [markdown]",
        "## Inserting Imperfections",
        "",
        "Now let's see what happens when we make our circuit elements less perfect,",
        "specifically by including component tolerances as part of our model. For",
        "now we'll use a Gaussian distribution for the randomness of our component",
        "values, but we'll discuss more realistic distributions in more detail",
        "later on.",
        "",
        "The following plot demonstrates how the frequency response varies for",
        "different levels of component tolerance:",
        "%%",
        "%% [markdown]",
        "Now I should note that the above plot is a little bit of an exaggeration,",
        "with regards to the actual variations present in analog hardware. First",
        "off, 10% is a pretty large tolerance, and one would expect manufacturers,",
        "particularly those who make high-end gear, to use higher quality parts.",
        "Additionally, most respectable hardware makers have some form of quality",
        "control both in rejecting abnormally bad components before including them",
        "in their circuits, as well as testing their completed products before they",
        "are shipped. So the actual variation in a lowpass filter circuit that",
        "you might buy should never be quite as bad as that shown in the plot above,",
        "but the basic idea that such variation exists definitely still stands.",
        "",
        "## Probability Distributions",
        "",
        "When I first started looking at this idea of introducing component",
        "tolerances into circuit models, I had expected the actual component",
        "values to follow a more or less Gaussian distribution. The reality",
        "turns out to be a bit more complicated. Although there appears to be",
        "a lack of academic writing on the subject, engineers and hackers seem to",
        "agree that actual component values follow something like a",
        "\"truncated Gaussian\" distribution. The interested reader is encouraged",
        "to read this insightful and humorous article on the subject from",
        "Howard Johnson [[link](https://www.edn.com/electronics-blogs/signal-integrity/4363408/7-solution)].",
        "%%",
        "%% [markdown]",
        "Now we can see what our new frequency responses should look like with our",
        "updated component value distribution.",
        "%%",
        "%% [markdown]",
        "## Implementation"
    ],
    "docstrings": [],
    "functions": [
        "getCompVal",
        "design_SKLPF",
        "trunc_gauss",
        "getCompVal2",
        "design_SKLPF2"
    ],
    "classes": []
}