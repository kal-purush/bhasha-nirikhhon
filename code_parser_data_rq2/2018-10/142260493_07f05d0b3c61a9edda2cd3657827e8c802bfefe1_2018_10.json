{
    "identifiers": [
        "torch",
        "numpy",
        "np",
        "sklearn",
        "manifold",
        "t_sne",
        "sigma",
        "b",
        "b",
        "sigma",
        "scaled_distances",
        "axis_for_normalization",
        "TensorAxis",
        "C",
        "scaled_distances",
        "torch",
        "exp",
        "b",
        "scaled_distances",
        "sigma",
        "cs_weights_before_normalization",
        "staticmethod",
        "I_features",
        "T_features",
        "sigma",
        "b",
        "CSFlow",
        "sigma",
        "b",
        "T_features",
        "shape",
        "I_features",
        "shape",
        "torch",
        "reshape",
        "I_features",
        "sI",
        "sI",
        "torch",
        "reshape",
        "T_features",
        "sI",
        "sT",
        "torch",
        "sum",
        "Tvecs",
        "Tvecs",
        "torch",
        "sum",
        "Ivecs",
        "Ivecs",
        "i",
        "sT",
        "Ivecs",
        "i",
        "Tvecs",
        "i",
        "r_Ts",
        "i",
        "r_Is",
        "i",
        "Tvec",
        "torch",
        "transpose",
        "Ivec",
        "A",
        "torch",
        "reshape",
        "r_T",
        "r_T",
        "A",
        "r_I",
        "torch",
        "reshape",
        "torch",
        "transpose",
        "dist",
        "shape",
        "sI",
        "sI",
        "dist",
        "shape",
        "torch",
        "clamp",
        "dist",
        "min",
        "raw_distances_list",
        "dist",
        "torch",
        "cat",
        "raw_distances_list",
        "cs_flow",
        "calc_relative_distances",
        "cs_flow",
        "__calculate_CS",
        "relative_dist",
        "cs_flow",
        "staticmethod",
        "I_features",
        "T_features",
        "sigma",
        "b",
        "CSFlow",
        "sigma",
        "b",
        "T_features",
        "shape",
        "I_features",
        "shape",
        "torch",
        "reshape",
        "I_features",
        "sI",
        "sI",
        "torch",
        "reshape",
        "T_features",
        "sI",
        "sT",
        "i",
        "sT",
        "Ivecs",
        "i",
        "Tvecs",
        "i",
        "torch",
        "abs",
        "torch",
        "sum",
        "Ivec",
        "unsqueeze",
        "Tvec",
        "unsqueeze",
        "dim",
        "torch",
        "reshape",
        "torch",
        "transpose",
        "dist",
        "shape",
        "sI",
        "sI",
        "dist",
        "shape",
        "torch",
        "clamp",
        "dist",
        "min",
        "raw_distances_list",
        "dist",
        "torch",
        "cat",
        "raw_distances_list",
        "cs_flow",
        "calc_relative_distances",
        "cs_flow",
        "__calculate_CS",
        "relative_dist",
        "cs_flow",
        "staticmethod",
        "I_features",
        "T_features",
        "sigma",
        "b",
        "CSFlow",
        "sigma",
        "b",
        "cs_flow",
        "center_by_T",
        "T_features",
        "I_features",
        "CSFlow",
        "l2_normalize_channelwise",
        "T_features",
        "CSFlow",
        "l2_normalize_channelwise",
        "I_features",
        "T_features",
        "size",
        "i",
        "N",
        "T_features",
        "i",
        "unsqueeze_",
        "I_features",
        "i",
        "unsqueeze_",
        "permute",
        "cs_flow",
        "patch_decomposition",
        "T_features_i",
        "torch",
        "nn",
        "functional",
        "conv2d",
        "I_features_i",
        "patches_PC11_i",
        "cosine_dist_i",
        "permute",
        "cosine_dist_l",
        "append",
        "cosine_dist_i",
        "permute",
        "torch",
        "cat",
        "cosine_dist_l",
        "dim",
        "cs_flow",
        "cosine_dist",
        "cs_flow",
        "calc_relative_distances",
        "cs_flow",
        "__calculate_CS",
        "relative_dist",
        "cs_flow",
        "axis",
        "TensorAxis",
        "C",
        "torch",
        "min",
        "raw_distances",
        "dim",
        "axis",
        "keepdim",
        "raw_distances",
        "div",
        "epsilon",
        "relative_dist",
        "staticmethod",
        "cs",
        "axis",
        "TensorAxis",
        "C",
        "torch",
        "sum",
        "cs",
        "dim",
        "axis",
        "keepdim",
        "torch",
        "div",
        "cs",
        "reduce_sum",
        "cs_normalize",
        "T_features",
        "I_features",
        "T_features",
        "mean",
        "keepdim",
        "mean",
        "keepdim",
        "mean",
        "keepdim",
        "T_features",
        "keepdim",
        "keepdim",
        "keepdim",
        "T_features",
        "meanT",
        "I_features",
        "meanT",
        "T_features_centered",
        "I_features_centered",
        "staticmethod",
        "features",
        "features",
        "norm",
        "p",
        "dim",
        "TensorAxis",
        "C",
        "keepdim",
        "features",
        "div",
        "norms",
        "features",
        "T_features",
        "T_features",
        "shape",
        "H",
        "W",
        "T_features",
        "reshape",
        "shape",
        "P",
        "C",
        "permute",
        "dims",
        "patches_PC11",
        "staticmethod",
        "x",
        "keepdim",
        "x",
        "shape",
        "x",
        "reshape",
        "shape",
        "sx",
        "sx",
        "sx",
        "sx",
        "x",
        "unsqueeze",
        "x",
        "unsqueeze",
        "torch",
        "sum",
        "differences",
        "keepdim",
        "distances",
        "reshape",
        "shape",
        "sx",
        "sx",
        "sx",
        "sx",
        "distances",
        "staticmethod",
        "sT",
        "order",
        "deformation_sigma",
        "sT",
        "sT",
        "sT",
        "sT",
        "np",
        "meshgrid",
        "rangeRows",
        "rangeCols",
        "Is",
        "Js",
        "np",
        "repeat",
        "row_diff_from_first_row",
        "np",
        "newaxis",
        "pixel_count",
        "axis",
        "np",
        "repeat",
        "col_diff_from_first_col",
        "np",
        "newaxis",
        "pixel_count",
        "axis",
        "row_diff_from_first_row_3d_repeat",
        "row_diff_from_first_row",
        "flatten",
        "order",
        "reshape",
        "col_diff_from_first_col_3d_repeat",
        "col_diff_from_first_col",
        "flatten",
        "order",
        "reshape",
        "rowDiffs",
        "colDiffs",
        "R",
        "astype",
        "np",
        "float32",
        "np",
        "exp",
        "R",
        "deformation_sigma",
        "R",
        "T_features",
        "I_features",
        "deformation",
        "dis",
        "Tpt",
        "Tpt",
        "permute",
        "Ttf",
        "from_pt2tf",
        "T_features",
        "from_pt2tf",
        "I_features",
        "CSFlow",
        "create_using_L2",
        "I_features_tf",
        "T_features_tf",
        "sigma",
        "cs_flow",
        "cs_NHWC",
        "deformation",
        "T_features_tf",
        "shape",
        "CSFlow",
        "calcR_static",
        "sT",
        "deformation_sigma",
        "deforma_sigma",
        "cs",
        "torch",
        "Tensor",
        "R",
        "unsqueeze",
        "dim",
        "cuda",
        "dis",
        "torch",
        "max",
        "torch",
        "max",
        "cs",
        "dim",
        "dim",
        "k_max_NC",
        "cpu",
        "indices",
        "shape",
        "i",
        "N",
        "CS",
        "append",
        "C",
        "len",
        "torch",
        "unique",
        "indices",
        "i",
        "C",
        "torch",
        "FloatTensor",
        "CS",
        "torch",
        "max",
        "torch",
        "max",
        "cs",
        "dim",
        "dim",
        "torch",
        "mean",
        "k_max_NC",
        "dim",
        "torch",
        "log",
        "CS",
        "torch",
        "mean",
        "score",
        "score",
        "T_features",
        "I_features",
        "CX_loss",
        "T_features",
        "I_features",
        "CX_loss",
        "I_features",
        "T_features",
        "score"
    ],
    "literals": [
        "'C'"
    ],
    "variables": [
        "N",
        "H",
        "W",
        "C",
        "b",
        "sigma",
        "scaled_distances",
        "cs_weights_before_normalization",
        "cs_NHWC",
        "cs_flow",
        "sT",
        "sI",
        "Ivecs",
        "Tvecs",
        "r_Ts",
        "r_Is",
        "raw_distances_list",
        "Ivec",
        "Tvec",
        "r_T",
        "r_I",
        "A",
        "cs_flow",
        "A",
        "r_T",
        "dist",
        "dist",
        "dist",
        "cs_flow",
        "raw_distances",
        "relative_dist",
        "cs_flow",
        "sT",
        "sI",
        "Ivecs",
        "Tvecs",
        "raw_distances_list",
        "Ivec",
        "Tvec",
        "dist",
        "dist",
        "dist",
        "cs_flow",
        "raw_distances",
        "relative_dist",
        "cs_flow",
        "T_features",
        "I_features",
        "T_features",
        "I_features",
        "cosine_dist_l",
        "N",
        "T_features_i",
        "I_features_i",
        "patches_PC11_i",
        "cosine_dist_i",
        "cosine_dist_1HWC",
        "cs_flow",
        "cosine_dist",
        "cs_flow",
        "raw_distances",
        "relative_dist",
        "epsilon",
        "div",
        "relative_dist",
        "reduce_sum",
        "cs_normalize",
        "axes",
        "meanT",
        "varT",
        "T_features_centered",
        "I_features_centered",
        "norms",
        "features",
        "N",
        "H",
        "W",
        "C",
        "P",
        "patches_PC11",
        "sx",
        "x",
        "differences",
        "distances",
        "distances",
        "pixel_count",
        "rangeRows",
        "rangeCols",
        "Js",
        "Is",
        "row_diff_from_first_row",
        "col_diff_from_first_col",
        "row_diff_from_first_row_3d_repeat",
        "col_diff_from_first_col_3d_repeat",
        "rowDiffs",
        "colDiffs",
        "R",
        "R",
        "R",
        "Ttf",
        "T_features_tf",
        "I_features_tf",
        "cs_flow",
        "cs",
        "deforma_sigma",
        "sT",
        "R",
        "CS",
        "k_max_NC",
        "indices",
        "N",
        "C",
        "score",
        "k_max_NC",
        "CS",
        "score",
        "score",
        "score"
    ],
    "comments": [
        "import tensorflow as tf",
        "self.cs_weights_before_normalization = 1 / (1 + scaled_distances)",
        "self.cs_NHWC = CSFlow.sum_normalize(self.cs_weights_before_normalization, axis_for_normalization)",
        "def reversed_direction_CS(self):",
        "cs_flow_opposite = CSFlow(self.sigma, self.b)",
        "cs_flow_opposite.raw_distances = self.raw_distances",
        "work_axis = [TensorAxis.H, TensorAxis.W]",
        "relative_dist = cs_flow_opposite.calc_relative_distances(axis=work_axis)",
        "cs_flow_opposite.__calculate_CS(relative_dist, work_axis)",
        "return cs_flow_opposite",
        "--",
        "(matrix multiplication)",
        "A = tf.matmul(Tvec, tf.transpose(Ivec))",
        "turn to column vector",
        "protecting against numerical problems, dist should be positive",
        "dist = tf.sqrt(dist)",
        "--",
        "protecting against numerical problems, dist should be positive",
        "dist = tf.sqrt(dist)",
        "--",
        "prepare feature before calculating cosine distance",
        "work seperatly for each example in dim 1",
        "1HWC --> 1CHW",
        "1HWC --> PC11, with P=H*W",
        "back to 1HWC",
        "why -",
        "assuming both input are of the same size",
        "calculate stas over [batch, height, width], expecting 1x1xDepth tensor",
        "1HWC --> 11PC --> PC11, with P=H*W",
        "oreder can be C or F (matlab order)",
        "--------------------------------------------------",
        "CX loss",
        "--------------------------------------------------",
        "T_features = tf.convert_to_tensor(T_features, dtype=tf.float32)",
        "I_features = tf.convert_to_tensor(I_features, dtype=tf.float32)",
        "since this is a convertion of tensorflow to pytorch we permute the tensor from",
        "T_features = normalize_tensor(T_features)",
        "I_features = normalize_tensor(I_features)",
        "since this originally Tensorflow implemntation",
        "we modify all tensors to be as TF convention and not as the convention of pytorch.",
        "print(Tpt.size())",
        "N x C x H x W --> N x H x W x C",
        "cs_flow = CSFlow.create_using_dotP(I_features_tf, T_features_tf, sigma=1.0)",
        "sum_normalize:",
        "To:",
        "reduce_max X and Y dims",
        "cs = CSFlow.pdist2(cs,keepdim=True)",
        "reduce mean over C dim",
        "score = 1/CS",
        "score = torch.exp(-CS*10)",
        "reduce mean over N dim",
        "CX_loss = torch.mean(CX_loss)"
    ],
    "docstrings": [],
    "functions": [
        "__calculate_CS",
        "create_using_L2",
        "create_using_L1",
        "create_using_dotP",
        "calc_relative_distances",
        "sum_normalize",
        "center_by_T",
        "l2_normalize_channelwise",
        "patch_decomposition",
        "pdist2",
        "calcR_static",
        "CX_loss",
        "from_pt2tf",
        "symetric_CX_loss"
    ],
    "classes": [
        "TensorAxis",
        "CSFlow"
    ]
}