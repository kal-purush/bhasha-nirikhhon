{
    "identifiers": [
        "org",
        "apache",
        "omid",
        "tso",
        "org",
        "apache",
        "omid",
        "committable",
        "CommitTable",
        "org",
        "apache",
        "omid",
        "metrics",
        "MetricsRegistry",
        "org",
        "apache",
        "omid",
        "metrics",
        "NullMetricsProvider",
        "org",
        "apache",
        "omid",
        "tso",
        "PersistenceProcessorImpl",
        "PersistBatchEvent",
        "org",
        "jboss",
        "netty",
        "channel",
        "Channel",
        "org",
        "mockito",
        "Mock",
        "org",
        "mockito",
        "Mockito",
        "org",
        "mockito",
        "MockitoAnnotations",
        "org",
        "slf4j",
        "Logger",
        "org",
        "slf4j",
        "LoggerFactory",
        "org",
        "testng",
        "annotations",
        "AfterMethod",
        "org",
        "testng",
        "annotations",
        "BeforeMethod",
        "org",
        "testng",
        "annotations",
        "Test",
        "java",
        "io",
        "org",
        "mockito",
        "Matchers",
        "org",
        "mockito",
        "Matchers",
        "anyLong",
        "org",
        "mockito",
        "Matchers",
        "eq",
        "org",
        "mockito",
        "Mockito",
        "doReturn",
        "org",
        "mockito",
        "Mockito",
        "doThrow",
        "org",
        "mockito",
        "Mockito",
        "mock",
        "org",
        "mockito",
        "Mockito",
        "org",
        "mockito",
        "Mockito",
        "spy",
        "org",
        "mockito",
        "Mockito",
        "times",
        "org",
        "mockito",
        "Mockito",
        "verify",
        "org",
        "testng",
        "Assert",
        "assertEquals",
        "org",
        "testng",
        "Assert",
        "assertTrue",
        "org",
        "testng",
        "Assert",
        "fail",
        "LOG",
        "LoggerFactory",
        "getLogger",
        "BATCH_ID",
        "BATCH_SIZE",
        "BATCH_SEQUENCE",
        "FIRST_ST",
        "FIRST_CT",
        "SECOND_ST",
        "SECOND_CT",
        "THIRD_ST",
        "THIRD_CT",
        "FOURTH_ST",
        "FOURTH_CT",
        "FIFTH_ST",
        "FIFTH_CT",
        "SIXTH_ST",
        "Mock",
        "mockWriter",
        "Mock",
        "mockClient",
        "Mock",
        "leaseManager",
        "Mock",
        "replyProcessor",
        "Mock",
        "retryProcessor",
        "Mock",
        "panicker",
        "commitTable",
        "metrics",
        "persistenceHandler",
        "BeforeMethod",
        "alwaysRun",
        "timeOut",
        "MockitoAnnotations",
        "initMocks",
        "metrics",
        "commitTable",
        "Override",
        "mockWriter",
        "Override",
        "mockClient",
        "doReturn",
        "when",
        "leaseManager",
        "stillInLeasePeriod",
        "persistenceHandler",
        "spy",
        "metrics",
        "leaseManager",
        "commitTable",
        "replyProcessor",
        "retryProcessor",
        "panicker",
        "AfterMethod",
        "Mockito",
        "reset",
        "mockWriter",
        "Test",
        "timeOut",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "eq",
        "batch",
        "verify",
        "retryProcessor",
        "disambiguateRetryRequestHeuristically",
        "anyLong",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertTrue",
        "batch",
        "isEmpty",
        "Test",
        "timeOut",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addTimestamp",
        "FIRST_ST",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "eq",
        "batch",
        "verify",
        "retryProcessor",
        "disambiguateRetryRequestHeuristically",
        "anyLong",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "FIRST_ST",
        "Test",
        "timeOut",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addCommit",
        "FIRST_ST",
        "FIRST_CT",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "batch",
        "verify",
        "retryProcessor",
        "disambiguateRetryRequestHeuristically",
        "anyLong",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "FIRST_ST",
        "assertEquals",
        "batch",
        "get",
        "getCommitTimestamp",
        "FIRST_CT",
        "Test",
        "timeOut",
        "IS_RETRY",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addAbort",
        "FIRST_ST",
        "IS_RETRY",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "batch",
        "verify",
        "retryProcessor",
        "disambiguateRetryRequestHeuristically",
        "anyLong",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "FIRST_ST",
        "Test",
        "timeOut",
        "IS_RETRY",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addAbort",
        "FIRST_ST",
        "IS_RETRY",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "batch",
        "verify",
        "retryProcessor",
        "times",
        "disambiguateRetryRequestHeuristically",
        "eq",
        "FIRST_ST",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "Test",
        "timeOut",
        "IS_RETRY",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addCommit",
        "FIRST_ST",
        "FIRST_CT",
        "mock",
        "batch",
        "addAbort",
        "SECOND_ST",
        "IS_RETRY",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "eq",
        "batch",
        "verify",
        "retryProcessor",
        "times",
        "disambiguateRetryRequestHeuristically",
        "eq",
        "SECOND_ST",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "FIRST_ST",
        "assertEquals",
        "batch",
        "get",
        "getCommitTimestamp",
        "FIRST_CT",
        "Test",
        "timeOut",
        "IS_RETRY",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addAbort",
        "FIRST_ST",
        "IS_RETRY",
        "mock",
        "batch",
        "addCommit",
        "SECOND_ST",
        "SECOND_CT",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "eq",
        "batch",
        "verify",
        "retryProcessor",
        "times",
        "disambiguateRetryRequestHeuristically",
        "eq",
        "FIRST_ST",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "SECOND_ST",
        "assertEquals",
        "batch",
        "get",
        "getCommitTimestamp",
        "SECOND_CT",
        "Test",
        "timeOut",
        "IS_RETRY",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addAbort",
        "FIRST_ST",
        "IS_RETRY",
        "mock",
        "batch",
        "addAbort",
        "SECOND_ST",
        "IS_RETRY",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "eq",
        "batch",
        "verify",
        "retryProcessor",
        "times",
        "disambiguateRetryRequestHeuristically",
        "eq",
        "FIRST_ST",
        "verify",
        "retryProcessor",
        "times",
        "disambiguateRetryRequestHeuristically",
        "eq",
        "SECOND_ST",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "Test",
        "timeOut",
        "IS_RETRY",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addAbort",
        "FIRST_ST",
        "IS_RETRY",
        "mock",
        "batch",
        "addAbort",
        "SECOND_ST",
        "IS_RETRY",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "eq",
        "batch",
        "verify",
        "retryProcessor",
        "disambiguateRetryRequestHeuristically",
        "anyLong",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "FIRST_ST",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "SECOND_ST",
        "Test",
        "timeOut",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addTimestamp",
        "FIRST_ST",
        "mock",
        "batch",
        "addAbort",
        "SECOND_ST",
        "mock",
        "batch",
        "addCommit",
        "THIRD_ST",
        "THIRD_CT",
        "mock",
        "batch",
        "addAbort",
        "FOURTH_ST",
        "mock",
        "batch",
        "addCommit",
        "FIFTH_ST",
        "FIFTH_CT",
        "mock",
        "batch",
        "addAbort",
        "SIXTH_ST",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "verify",
        "persistenceHandler",
        "times",
        "filterAndDissambiguateClientRetries",
        "eq",
        "batch",
        "verify",
        "retryProcessor",
        "times",
        "disambiguateRetryRequestHeuristically",
        "eq",
        "SECOND_ST",
        "verify",
        "replyProcessor",
        "times",
        "manageResponsesBatch",
        "eq",
        "BATCH_SEQUENCE",
        "eq",
        "batch",
        "assertEquals",
        "batch",
        "getNumEvents",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "FIRST_ST",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "FIFTH_ST",
        "assertEquals",
        "batch",
        "get",
        "getCommitTimestamp",
        "FIFTH_CT",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "THIRD_ST",
        "assertEquals",
        "batch",
        "get",
        "getCommitTimestamp",
        "THIRD_CT",
        "assertEquals",
        "batch",
        "get",
        "getStartTimestamp",
        "FOURTH_ST",
        "Test",
        "timeOut",
        "panicker",
        "spy",
        "persistenceHandler",
        "spy",
        "metrics",
        "leaseManager",
        "commitTable",
        "replyProcessor",
        "retryProcessor",
        "panicker",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addCommit",
        "FIRST_ST",
        "FIRST_CT",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "doThrow",
        "when",
        "mockWriter",
        "flush",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "fail",
        "re",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "verify",
        "panicker",
        "times",
        "panic",
        "eq",
        "verify",
        "persistenceHandler",
        "filterAndDissambiguateClientRetries",
        "verify",
        "replyProcessor",
        "manageResponsesBatch",
        "anyLong",
        "Test",
        "timeOut",
        "doReturn",
        "when",
        "leaseManager",
        "stillInLeasePeriod",
        "panicker",
        "spy",
        "persistenceHandler",
        "spy",
        "metrics",
        "leaseManager",
        "commitTable",
        "replyProcessor",
        "retryProcessor",
        "panicker",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addCommit",
        "FIRST_ST",
        "FIRST_CT",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "fail",
        "re",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "mockWriter",
        "flush",
        "verify",
        "panicker",
        "times",
        "panic",
        "eq",
        "verify",
        "persistenceHandler",
        "filterAndDissambiguateClientRetries",
        "verify",
        "replyProcessor",
        "manageResponsesBatch",
        "anyLong",
        "doReturn",
        "doReturn",
        "when",
        "leaseManager",
        "stillInLeasePeriod",
        "panicker",
        "spy",
        "persistenceHandler",
        "spy",
        "metrics",
        "leaseManager",
        "commitTable",
        "replyProcessor",
        "retryProcessor",
        "panicker",
        "batch",
        "BATCH_ID",
        "BATCH_SIZE",
        "batch",
        "addCommit",
        "FIRST_ST",
        "FIRST_CT",
        "mock",
        "batchEvent",
        "PersistBatchEvent",
        "makePersistBatch",
        "batchEvent",
        "BATCH_SEQUENCE",
        "batch",
        "persistenceHandler",
        "onEvent",
        "batchEvent",
        "fail",
        "re",
        "verify",
        "persistenceHandler",
        "times",
        "flush",
        "eq",
        "verify",
        "mockWriter",
        "times",
        "flush",
        "verify",
        "panicker",
        "times",
        "panic",
        "eq",
        "verify",
        "persistenceHandler",
        "filterAndDissambiguateClientRetries",
        "verify",
        "replyProcessor",
        "manageResponsesBatch",
        "anyLong"
    ],
    "literals": [
        "\"localhost:1234\"",
        "\"localhost:1234\"",
        "\"Error persisting commit batch\"",
        "\"localhost:1234\"",
        "\"Replica localhost:1234 lost mastership whilst flushing data. Committing suicide\"",
        "\"localhost:1234\"",
        "\"Replica localhost:1234 lost mastership whilst flushing data. Committing suicide\""
    ],
    "variables": [
        "mockWriter",
        "mockClient",
        "leaseManager",
        "replyProcessor",
        "retryProcessor",
        "panicker",
        "commitTable",
        "metrics",
        "persistenceHandler"
    ],
    "comments": [
        "Component under test",
        "Configure null metrics provider",
        "Configure commit table to return the mocked writer and client",
        "Simulate we're master for most of the tests",
        "Prepare test batch",
        "Prepare test batch",
        "Prepare test batch",
        "Prepare test batch",
        "Prepare test batch",
        "Call process method",
        "Prepare test batch",
        "Initial assertion",
        "Call process method",
        "------------------------------------------------------------------------------------------------------------",
        "Same test as testProcessingOfBatchPersistEventWith2EventsCommitAndAbortWithRetry but swapped events",
        "------------------------------------------------------------------------------------------------------------",
        "Prepare test batch",
        "Initial assertion",
        "Call process method",
        "Prepare test batch",
        "Initial assertion",
        "Call process method",
        "Prepare test batch",
        "Initial assertion",
        "Call process method",
        "Prepare test batch",
        "Initial assertion",
        "Call process method",
        "2 commits to flush",
        "User the real panicker",
        "Prepare test batch",
        "Expected",
        "------------------------------------------------------------------------------------------------------------",
        "1) Test panic before flushing",
        "------------------------------------------------------------------------------------------------------------",
        "Simulate we lose mastership BEFORE flushing",
        "User the real panicker",
        "Prepare test batch",
        "Expected",
        "------------------------------------------------------------------------------------------------------------",
        "2) Test panic after flushing",
        "------------------------------------------------------------------------------------------------------------",
        "Simulate we lose mastership AFTER flushing",
        "User the real panicker",
        "Prepare test batch",
        "Expected"
    ],
    "docstrings": [
        "* Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License."
    ],
    "functions": [
        "initMocksAndComponents",
        "Writer",
        "getWriter",
        "Client",
        "getClient",
        "afterMethod",
        "testProcessingOfEmptyBatchPersistEvent",
        "testProcessingOfBatchPersistEventWithASingleTimestampEvent",
        "testProcessingOfBatchPersistEventWithASingleCommitEvent",
        "testProcessingOfBatchPersistEventWithASingleAbortEventNoRetry",
        "testProcessingOfBatchPersistEventWithASingleAbortEventWithRetry",
        "testProcessingOfBatchPersistEventWith2EventsCommitAndAbortWithRetry",
        "testProcessingOfBatchPersistEventWith2EventsAbortWithRetryAndCommit",
        "testProcessingOfBatchPersistEventWith2AbortWithRetryEvents",
        "testProcessingOfBatchPersistEventWith2NonRetryAbortEvents",
        "testProcessingOfBatchPersistEventWithMultipleRetryAndNonRetryEvents",
        "testPanicPersistingEvents",
        "testPanicBecauseMasterLosesMastership"
    ],
    "classes": [
        "TestPersistenceProcessorHandler"
    ]
}